<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
    <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "FoxAnime",
    "alternateName": ["Fox Anime", "FoxAnime Vietsub"],
    "url": "https://foxanime.vercel.app/"
  }
  </script>
  <meta property="og:site_name" content="FoxAnime" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="dns-prefetch" href="https://www.gstatic.com">
    <link rel="icon" type="image/png" href="https://uploads.onecompiler.io/43u4wb3ft/44d7fqhzv/tet2005_n.png">
    <title>FOXANIME - Xem Anime Mi·ªÖn Ph√≠ (T·∫øt 2026)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        const RELOAD_INTERVAL = 15000;
        function checkTailwindLoadAndShowFallback() {
            let isTailwindLoaded = false;
            try {
                const testEl = document.createElement('div');
                testEl.className = 'opacity-100'; 
                testEl.style.display = 'none';
                document.body.appendChild(testEl);
                const computedStyle = window.getComputedStyle(testEl);
                isTailwindLoaded = computedStyle.opacity === '1'; 
                document.body.removeChild(testEl);
            } catch (e) {console.error("L·ªói khi ki·ªÉm tra Tailwind:", e);}
            if (!isTailwindLoaded) {
                const overlay = document.getElementById('cdn-failure-overlay');
                if (overlay) overlay.style.display = 'flex';
                const mainApp = document.getElementById('app');
                if (mainApp) mainApp.style.display = 'none'; 
                const header = document.querySelector('header');
                if (header) header.style.display = 'none'; 
                console.warn(`[CDN ERROR] Tailwind failed to load. Initiating self-healing reload loop in ${RELOAD_INTERVAL/1000}s.`);
                setTimeout(() => {location.reload();}, RELOAD_INTERVAL);
            }
        }
        window.addEventListener('load', () => {setTimeout(checkTailwindLoadAndShowFallback, 300);});
    </script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet"> <!-- Font T·∫øt -->
    
    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup, setPersistence, browserLocalPersistence, signInAnonymously, updateProfile } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, Timestamp, serverTimestamp, writeBatch, increment, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const FIREBASE_DEFAULT_CONFIG = {"apiKey": "AIzaSyDvI4bfJXh08biyFORz6X2xwBc19TERWEc", "authDomain": "foxanime-e77d4.firebaseapp.com","projectId": "foxanime-e77d4", "storageBucket": "foxanime-e77d4.firebasestorage.app", "messagingSenderId": "1025177423292", "appId": "1:1025177423292:web:14c200fbc905e79b3c6fb9"};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfigFromCanvas = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null; 
        const finalConfig = firebaseConfigFromCanvas?.projectId ? firebaseConfigFromCanvas : FIREBASE_DEFAULT_CONFIG;
        let app, db, auth;
        let userId = null; let userEmail = null; let dataCollectionPath, userLikesCollectionPath, userRoleCollectionPath; 
        let isAuthInitialised = false; let globalMovieCache = []; let unsubscribeCommentsListener = null; 
        let currentUserLikeDocIds = {}; let setupError = null; let isGlobalCacheLoaded = false; 
        let resolveResumeModal; let unsubscribeMovieListener = null; let currentUserReviewCache = null; 
        let unsubscribeReviewListener = null; let unsubscribePublicReviewsListener = null; 
        const COMMENT_LIMIT = 20; const COMMENT_DISPLAY_LIMIT = 20; const REVIEW_DISPLAY_LIMIT = 10;
        
        const ALL_GENRES = ["Action", "Adventure", "Boys Love", "Cartoon", "Comedy", "Dementia", "Demons", "Drama", "Ecchi", "Fantasy", "Game", "Harem", "Historical", "Horror", "Josei", "Kids", "Live Action", "Magic", "Martial Arts", "Mecha", "Military", "Music", "Mystery", "Parody", "Police", "Psychological", "Romance", "Samurai", "School", "Sci-Fi", "Seinen", "Shoujo", "Shoujo Ai", "Shounen", "Shounen Ai", "Slice of Life", "Space", "Sports", "Super Power", "Supernatural", "Suspense", "Thriller", "Tokusatsu", "Vampire", "Yaoi", "Yuri"];

        const GENRE_TRANSLATIONS = {
            "Action": "H√†nh ƒë·ªông", "Adventure": "Phi√™u l∆∞u", "Boys Love": "ƒêam m·ªπ", "Cartoon": "Ho·∫°t h√¨nh", "Comedy": "H√†i h∆∞·ªõc",
            "Dementia": "ƒêi√™n lo·∫°n", "Demons": "√Åc qu·ª∑", "Drama": "K·ªãch t√≠nh", "Ecchi": "Ecchi", "Fantasy": "Gi·∫£ t∆∞·ªüng",
            "Game": "Tr√≤ ch∆°i", "Harem": "Harem", "Historical": "L·ªãch s·ª≠", "Horror": "Kinh d·ªã", "Josei": "Josei",
            "Kids": "Tr·∫ª em", "Live Action": "Ng∆∞·ªùi ƒë√≥ng", "Magic": "Ma thu·∫≠t", "Martial Arts": "V√µ thu·∫≠t", "Mecha": "Robot",
            "Military": "Qu√¢n s·ª±", "Music": "√Çm nh·∫°c", "Mystery": "B√≠ ·∫©n", "Parody": "H√†i nh√°i", "Police": "C·∫£nh s√°t",
            "Psychological": "T√¢m l√Ω", "Romance": "L√£ng m·∫°n", "Samurai": "Samurai", "School": "H·ªçc ƒë∆∞·ªùng", "Sci-Fi": "Vi·ªÖn t∆∞·ªüng",
            "Seinen": "Seinen", "Shoujo": "Thi·∫øu n·ªØ", "Shoujo Ai": "B√°ch h·ª£p (Nh·∫π)", "Shounen": "Thi·∫øu ni√™n",
            "Shounen Ai": "ƒêam m·ªπ (Nh·∫π)", "Slice of Life": "ƒê·ªùi th∆∞·ªùng", "Space": "V≈© tr·ª•", "Sports": "Th·ªÉ thao",
            "Super Power": "Si√™u nƒÉng l·ª±c", "Supernatural": "Si√™u nhi√™n", "Suspense": "H·ªìi h·ªôp", "Thriller": "Gi·∫≠t g√¢n",
            "Tokusatsu": "Tokusatsu", "Vampire": "Ma c√† r·ªìng", "Yaoi": "ƒêam m·ªπ (M·∫°nh)", "Yuri": "B√°ch h·ª£p (M·∫°nh)"
        };
        
        const renderGenreLinkWithSub = (genre) => {
            const slug = createSlug(genre);
            const sub = GENRE_TRANSLATIONS[genre] ? ` (${GENRE_TRANSLATIONS[genre]})` : '';
            return {
                text: `${genre}${sub}`,
                slug: slug,
                isPopular: ["Action", "Romance", "Comedy"].includes(genre)
            };
        };

        const getEl = (selector) => document.querySelector(selector);
        const getAllEl = (selector) => document.querySelectorAll(selector);

        const updatePaths = (currentUserId) => {
            if (!appId && appId !== '') {console.error("FATAL: appId is not defined. Path creation failed.");setupError = new Error("L·ªói C·∫•u h√¨nh: appId kh√¥ng h·ª£p l·ªá.");return;}
            const safeUserId = currentUserId || 'guest';
            dataCollectionPath = `artifacts/${appId}/public/data/movies`; 
            userLikesCollectionPath = `artifacts/${appId}/users/${safeUserId}/likes`;
            userRoleCollectionPath = `artifacts/${appId}/users`; 
        };
        updatePaths(null);
        
        const isGoogleAuth = (userFromCallback = null) => {
           const user = userFromCallback || auth?.currentUser; 
           return user && user.providerData.some(p => p.providerId === 'google.com');
       };
       const BANNED_WORDS = ["ƒë·ª•", "c·∫∑c", "l·ªìn", "bu·ªìi", "ƒë·ªãt", "m·∫π m√†y", "ƒëm", "dcm", "cc", "ch√≥ ch·∫øt", "s√∫c v·∫≠t", "ph·∫£n ƒë·ªông", "k√≠ch war", "xuy√™n t·∫°c", "t·ª± t·ª≠", "ch·∫øt ƒëi", "ƒë√°nh nhau", "chia r·∫Ω", "ph√° ho·∫°i", "v√¥ h·ªçc", "th·∫±ng ngu", "con ƒëi√™n", "ch·ª≠i", "b·ªë l√°o", "c√∫t", "bi·∫øn", "ƒë·ªì kh·ªën", "kh·ªën n·∫°n", "s·∫£n", "ngu xu·∫©n", "√≥c ch√≥", "thi·∫øu vƒÉn minh", "fuck", "shit"];

       const isCommentProfane = (content) => {
        const normalizedContent = content.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/ƒë/g, 'd').replace(/ƒê/g, 'd').replace(/[^a-z0-9\s]/g, ""); 
        for (const word of BANNED_WORDS) {
            const normalizedBannedWord = word.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/ƒë/g, 'd').replace(/ƒê/g, 'd');
            if (normalizedContent.includes(normalizedBannedWord.replace(/\s+/g, '')) || content.toLowerCase().includes(word.toLowerCase())) return true;
        }
        return false;
    };

    const createSlug = (text) => {
        if (!text) return '';
        return text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/ƒë/g, 'd').replace(/ƒê/g, 'D').replace(/[^a-z0-9\s-]/g, "").trim().replace(/\s+/g, '-').replace(/-+/g, '-'); 
    };

    const formatCommentDate = (dateObj) => {
        if (!dateObj) return 'V·ª´a xong';
        let date;
        if (typeof dateObj.toDate === 'function') date = dateObj.toDate(); 
        else if (dateObj instanceof Date) date = dateObj;
        else if (typeof dateObj === 'number') date = new Date(dateObj);
        else if (typeof dateObj === 'string') date = new Date(dateObj);
        else return 'Kh√¥ng x√°c ƒë·ªãnh';
        if (isNaN(date.getTime())) return 'L·ªói ng√†y th√°ng';
        return date.toLocaleString('vi-VN');
    };

    window.showResumeModal = (movieTitle, time) => {
        const modal = getEl('#resume-modal');
        const minutes = Math.floor(time / 60);
        const seconds = Math.floor(time % 60);
        getEl('#resume-modal-text').textContent = `B·∫°n ƒë√£ xem "${movieTitle}" ƒë·∫øn ${minutes} ph√∫t ${seconds} gi√¢y. B·∫°n c√≥ mu·ªën xem ti·∫øp kh√¥ng?`;
        modal.classList.remove('hidden'); modal.classList.add('flex');
        return new Promise(resolve => { resolveResumeModal = resolve; });
    };
    window.hideResumeModal = () => {
        const modal = getEl('#resume-modal');
        modal.classList.add('hidden'); modal.classList.remove('flex'); resolveResumeModal = null;
    };

    const saveWatchTime = (episodeId, time) => {
        if (episodeId && time >= 5 && (Date.now() - parseInt(localStorage.getItem(`_lastSave_${episodeId}`) || '0') > 30000)) {
            localStorage.setItem(`_watchTime_${episodeId}`, time);
            localStorage.setItem(`_lastSave_${episodeId}`, Date.now());
        }
    };

    const deleteOldestComments = async (movieId, comments) => {
        if (comments.length > COMMENT_LIMIT) {
            comments.sort((a, b) => {
               const timeA = a.createdAt?.toDate ? a.createdAt.toDate() : new Date(a.createdAt || 0);
               const timeB = b.createdAt?.toDate ? b.createdAt.toDate() : new Date(b.createdAt || 0);
               return timeA - timeB;
           });
            const commentsToDelete = comments.slice(0, comments.length - COMMENT_LIMIT);
            const batch = writeBatch(db);
            const commentsColRef = collection(db, dataCollectionPath, movieId, 'comments');
            commentsToDelete.forEach(comment => {batch.delete(doc(commentsColRef, comment.id));});
            try {
                await batch.commit();
                console.log(`ƒê√£ x√≥a ${commentsToDelete.length} b√¨nh lu·∫≠n c≈© nh·∫•t cho phim ${movieId}.`);
            } catch (e) {console.error("L·ªói khi x√≥a b√¨nh lu·∫≠n c≈©:", e);}
        }
    };

    const setupCommentsListener = (movieId) => {
        if (unsubscribeCommentsListener) { unsubscribeCommentsListener(); unsubscribeCommentsListener = null; }
        const commentsColRef = collection(db, dataCollectionPath, movieId, 'comments');
        const commentsQuery = query(commentsColRef); 
        unsubscribeCommentsListener = onSnapshot(commentsQuery, (snapshot) => {
            const updatedComments = [];
            snapshot.forEach(doc => {updatedComments.push({ id: doc.id, ...doc.data() });});
            updatedComments.sort((a, b) => {
                const timeA = a.createdAt?.toDate ? a.createdAt.toDate() : new Date(a.createdAt || 0);
                const timeB = b.createdAt?.toDate ? b.createdAt.toDate() : new Date(b.createdAt || 0);
                return timeB - timeA;
            });
            //deleteOldestComments(movieId, updatedComments); 
            const displayedComments = updatedComments.slice(0, COMMENT_DISPLAY_LIMIT);
            const commentsListElement = getEl('#comments-list');
            const commentCountElement = getEl('#comment-count-display');
            if (commentCountElement) commentCountElement.textContent = updatedComments.length;
            if (commentsListElement) {
                commentsListElement.innerHTML = `
                        <div class="max-h-96 overflow-y-auto comments-scroll-area">
                            ${displayedComments.length > 0
                                ? displayedComments.map(CommentTemplate).join('')
                                : '<p class="text-gray-500 text-center">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>'
                            }
                                ${updatedComments.length > COMMENT_DISPLAY_LIMIT ? `<p class="text-gray-500 text-center pt-2 text-sm italic">...ƒê√£ ·∫©n ${updatedComments.length - COMMENT_DISPLAY_LIMIT} b√¨nh lu·∫≠n c≈© h∆°n ƒë·ªÉ t·ªëi ∆∞u hi·ªáu su·∫•t.</p>` : ''}
                        </div>
                            `;
                        }
                    }, (error) => {
                        console.error("L·ªói listener b√¨nh lu·∫≠n:", error);
                        const commentsListElement = getEl('#comments-list');
                        if (commentsListElement) {commentsListElement.innerHTML = '<p class="text-red-400 text-center">L·ªói t·∫£i b√¨nh lu·∫≠n. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi/quy·ªÅn.</p>';}
                    });
    };

    const incrementViewCount = async (movieId) => {
        const viewedKey = `viewed_${movieId}`;
        if (!sessionStorage.getItem(viewedKey)) {
            try {
                if (db && dataCollectionPath) { 
                   const movieDocRef = doc(db, dataCollectionPath, movieId);
                   await updateDoc(movieDocRef, { viewCount: increment(1) });
                   sessionStorage.setItem(viewedKey, 'true');
               }
           } catch (e) { console.error("L·ªói khi tƒÉng l∆∞·ª£t xem:", e); }
       }
   };

   const getYoutubeEmbedUrl = (url) => {
    const OFFICIAL_ORIGIN = 'https://foxanime.vercel.app'; 
    try {
        const urlObj = new URL(url);
        const videoId = urlObj.searchParams.get('v') || (urlObj.hostname === 'youtu.be' ? urlObj.pathname.substring(1) : null);
        if (videoId) { return `https://www.youtube.com/embed/${videoId}?rel=0&enablejsapi=1&origin=${OFFICIAL_ORIGIN}&modestbranding=1&autoplay=1`; }
    } catch (e) {}
    return null;
};

const getGoogleDriveEmbedUrl = (url) => {
   try {
    const urlObj = new URL(url);
    let fileId = '';
    if (urlObj.pathname.startsWith('/file/d/')) { fileId = urlObj.pathname.split('/')[3]; } 
    else if (urlObj.pathname.startsWith('/uc')) { fileId = urlObj.searchParams.get('id'); }
    if (fileId) { return `https://drive.google.com/file/d/${fileId}/preview`; }
} catch (e) {}
return null; 
};

const getStreamEmbedUrl = (url) => {
   try {
    const urlObj = new URL(url);
    if (urlObj.hostname.includes('streamc.xyz')) {
        let finalUrl = url.includes('?') ? `${url}&autoplay=1&auto=1&allowautoplay=1` : `${url}?autoplay=1&auto=1&allowautoplay=1`;
        return finalUrl; 
    }
} catch (e) {}
return null; 
};

const getVideoPlayer = (videoUrl, posterUrl) => {
    const youtubeEmbedUrl = getYoutubeEmbedUrl(videoUrl);
    const googleDriveEmbedUrl = getGoogleDriveEmbedUrl(videoUrl);
    const streamEmbedUrl = getStreamEmbedUrl(videoUrl);
    let html = ''; let isHtml5Video = false; let finalSrc = ''; let isYoutube = false; let isStreamEmbed = false; 

    if (youtubeEmbedUrl) {
       finalSrc = youtubeEmbedUrl; isYoutube = true;
   } else if (googleDriveEmbedUrl) {
    finalSrc = googleDriveEmbedUrl;
} else if (streamEmbedUrl) {
   finalSrc = streamEmbedUrl; isStreamEmbed = true; 
} else {
   html = `<video id="video-player-element" controls class="w-full h-full" src="${videoUrl}" poster="${posterUrl}" playsinline disablepictureinpicture controlsList="nodownload nofullscreen">Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª video.</video>`;
   isHtml5Video = true;
}

if (finalSrc) {
   const srcAttr = isStreamEmbed ? '' : `src="${finalSrc}"`; 
   const dataSrcAttr = isStreamEmbed ? `data-stream-src="${finalSrc}"` : '';
   const sandboxAttr = isStreamEmbed ? `sandbox="allow-scripts allow-same-origin allow-popups"` : `allow="autoplay; fullscreen"`; 
   const allowAttr = isStreamEmbed ? `allow="autoplay"` : `allow="autoplay; fullscreen"`;

   html = `<iframe id="video-player-iframe" class="w-full h-full" ${srcAttr} title="Video player" frameborder="0" ${allowAttr} allowfullscreen disablepictureinpicture ${isYoutube ? 'data-is-youtube="true"' : ''} ${dataSrcAttr} ${isStreamEmbed ? sandboxAttr : ''}></iframe>`;
}
return {html, isHtml5Video};
};

const handlePlayVideo = (e) => {
    e.preventDefault();
    const overlay = getEl('#video-overlay');
    if (!overlay) return;
    overlay.classList.add('fade-out');
    const videoElement = getEl('#video-player-element');
    const iframeElement = getEl('#video-player-iframe');

    if (videoElement) {
        videoElement.play().catch(e => console.error("L·ªói t·ª± ƒë·ªông ph√°t video HTML5:", e));
    } else if (iframeElement) {
        // FIX: ƒê·ªïi 'iframecElement' th√†nh 'iframeElement'
        const streamSrc = iframeElement.dataset.streamSrc;
        if (streamSrc && !iframeElement.src) {
           iframeElement.src = streamSrc;
           console.log("[STREAMC] K√≠ch ho·∫°t t·∫£i video b·∫±ng user gesture.");
       }
       const frameSrc = iframeElement.src;
       if (frameSrc.includes('youtube.com/embed')) {
        setTimeout(() => {
            const message = JSON.stringify({'event': 'command', 'func': 'playVideo'});
            try {iframeElement.contentWindow.postMessage(message, '*');} catch (e) {console.error("L·ªói g·ª≠i postMessage t·ªõi YouTube:", e);}
        }, 100);
    }
}
setTimeout(() => { overlay.remove(); }, 500); 
};

const handleGoogleLogin = async () => {
    if (!auth) return;
    const errorElement = getEl('#auth-error');
    try {
        await setPersistence(auth, browserLocalPersistence);
        await signInWithPopup(auth, new GoogleAuthProvider()); 
        window.location.hash = '#home'; 
    } catch (error) {
        console.error("L·ªói ƒëƒÉng nh·∫≠p Google:", error);
        if (errorElement) errorElement.textContent = `L·ªói Google: ${error.message}`;
    }
};

const handleLogout = (e) => { 
   e.preventDefault();
   if (!auth) return;
   signOut(auth).catch(error => console.error("L·ªói ƒëƒÉng xu·∫•t:", error));
};

const fetchUserLikes = async (shouldRerender = false) => { 
    if (!auth?.currentUser || !db || userId === 'guest' || !userId) { 
        currentUserLikeDocIds = {}; 
        return; 
    }
    try {
        const q = query(collection(db, userLikesCollectionPath)); 
        onSnapshot(q, (snapshot) => {
            const likes = {};
            snapshot.forEach(doc => { likes[doc.data().movieId] = doc.id; });
            currentUserLikeDocIds = likes;
            const hash = window.location.hash;
            if (hash.startsWith('#library')) router(false); 
        }, (error) => { console.error("L·ªói khi theo d√µi danh s√°ch likes:", error); });
    } catch (e) { console.error("L·ªói khi t·∫£i danh s√°ch likes:", e); }
};

const handleLike = async (e) => { 
   if (!db || !auth?.currentUser) { window.location.hash = '#login'; return; } 
   const button = e.currentTarget;
   const movieId = button.dataset.movieId;
   button.disabled = true;
   const isLiked = !!currentUserLikeDocIds[movieId];
   const movieDocRef = doc(db, dataCollectionPath, movieId);
   try {
    const batch = writeBatch(db);
    const userLikesColRef = collection(db, `artifacts/${appId}/users/${userId}/likes`);
    let newLikeDocRef = null;

    if (isLiked) {
        const likeDocId = currentUserLikeDocIds[movieId];
        if (!likeDocId) throw new Error("Kh√¥ng t√¨m th·∫•y Like ID trong cache.");
        batch.delete(doc(userLikesColRef, likeDocId));
        batch.update(movieDocRef, { likeCount: increment(-1) });
    } else {
        newLikeDocRef = doc(userLikesColRef);
        batch.set(newLikeDocRef, { movieId: movieId, userId: auth.currentUser.uid, createdAt: serverTimestamp() });
        batch.update(movieDocRef, { likeCount: increment(1) });
    }
    await batch.commit();
    if (isLiked) {delete currentUserLikeDocIds[movieId];} else {currentUserLikeDocIds[movieId] = newLikeDocRef.id;}
} catch (e) {
    console.error("[LIKE ERROR] Thao t√°c Firebase th·∫•t b·∫°i:", e);
} finally {
    button.disabled = false;
}
};

const handleCommentSubmit = async (e) => { 
   e.preventDefault();

   const user = auth.currentUser;
   if (!db || !user || user.isAnonymous || !isGoogleAuth(user)) { 
       console.error("Ng∆∞·ªùi d√πng ch∆∞a ƒëƒÉng nh·∫≠p h·ª£p l·ªá (ch·ªâ ch·∫•p nh·∫≠n Google Auth) ƒë·ªÉ b√¨nh lu·∫≠n."); 
       window.location.hash = '#login'; 
       return; 
   }

   const input = getEl('#comment-input');
   const errorEl = getEl('#comment-error');
   const content = input.value.trim();

   errorEl.classList.add('hidden');
   if (!content) return;

   if (isCommentProfane(content)) {
    errorEl.textContent = "N·ªôi dung b√¨nh lu·∫≠n ch·ª©a t·ª´ ng·ªØ th√¥ t·ª•c/k√≠ch war. Vui l√≤ng ch·ªânh s·ª≠a.";
    errorEl.classList.remove('hidden'); return; 
}

const [path, slugIdParam] = window.location.hash.substring(1).split('/');
const movieIdMatch = slugIdParam?.match(/-([a-zA-Z0-9]+)$/);
const movieId = movieIdMatch ? movieIdMatch[1] : null;
if (!movieId) return;

const commentsColRef = collection(db, dataCollectionPath, movieId, 'comments'); 

try {
    await addDoc(commentsColRef, {
        content: content,
        userId: user.uid,
        email: user.email,
        displayName: user.displayName || user.email.split('@')[0], 
        photoURL: user.photoURL, 
        createdAt: serverTimestamp()
    });
    input.value = '';
} catch (e) {
    console.error("L·ªói khi g·ª≠i b√¨nh lu·∫≠n:", e);
    errorEl.textContent = "L·ªói khi g·ª≠i b√¨nh lu·∫≠n. Vui l√≤ng ki·ªÉm tra Rules ho·∫∑c ƒëƒÉng nh·∫≠p l·∫°i.";
    errorEl.classList.remove('hidden');
}
};

const globalCommentSubmitHandler = (e) => {
    if (e.target && e.target.id === 'comment-form') { handleCommentSubmit(e); }
};

const ensureUserProfile = async (user) => {
    if (!user.uid || !user.email) return;
    const userDocRef = doc(db, userRoleCollectionPath, user.uid);
    try {
        const docSnap = await getDoc(userDocRef);
        if (!docSnap.exists()) {
            await setDoc(userDocRef, {
                email: user.email,
                displayName: user.displayName || user.email.split('@')[0],
                photoURL: user.photoURL,
                role: 'user',
                createdAt: serverTimestamp()
            }, { merge: true });
        }
    } catch (e) { console.error("L·ªói t·∫°o user profile l·∫ßn ƒë·∫ßu:", e); }
};


const handleProfileUpdate = async (e) => {
    e.preventDefault();
    const user = auth.currentUser;
    if (!user || !db || user.isAnonymous || !isGoogleAuth(user)) { 
        getEl('#profile-error').textContent = "B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p b·∫±ng Google ƒë·ªÉ c·∫≠p nh·∫≠t h·ªì s∆°.";
        getEl('#profile-error').classList.remove('hidden');
        return;
    }

    const newName = getEl('#profile-name-input').value.trim();
    const errorEl = getEl('#profile-error');
    errorEl.classList.add('hidden');

    if (!newName || newName.length < 3) {
        errorEl.textContent = "T√™n hi·ªÉn th·ªã ph·∫£i d√†i √≠t nh·∫•t 3 k√Ω t·ª±.";
        errorEl.classList.remove('hidden');
        return;
    }

    try {

        await updateProfile(user, { displayName: newName });
        const userDocRef = doc(db, userRoleCollectionPath, user.uid);
        await updateDoc(userDocRef, { displayName: newName, updatedAt: serverTimestamp() });

        getEl('#profile-success').textContent = "C·∫≠p nh·∫≠t h·ªì s∆° th√†nh c√¥ng!";
        getEl('#profile-success').classList.remove('hidden');
        getEl('#profile-success').classList.add('bg-yellow-900/50'); // TET THEME COLOR

                // Force UI update
        updateAuthStateUI(auth.currentUser);
        setTimeout(() => { getEl('#profile-success').classList.add('hidden'); getEl('#profile-success').classList.remove('bg-yellow-900/50'); }, 3000);

    } catch (e) {
        console.error("L·ªói khi c·∫≠p nh·∫≠t h·ªì s∆°:", e);
        errorEl.textContent = `L·ªói c·∫≠p nh·∫≠t: ${e.message}`;
        errorEl.classList.remove('hidden');
    }
};

const handleReviewSubmit = async (e) => {
    e.preventDefault();
    const form = e.currentTarget;
    const movieId = form.dataset.movieId;
    const user = auth.currentUser;
    const rating = parseInt(getEl('input[name="rating"]:checked')?.value);
    const content = getEl('#review-content')?.value.trim() || '';
    const reviewErrorEl = getEl('#review-error');

    reviewErrorEl.classList.add('hidden');
    if (!rating) {reviewErrorEl.textContent = "Vui l√≤ng ch·ªçn s·ªë sao ƒë√°nh gi√°.";reviewErrorEl.classList.remove('hidden');return;}
    if (!db || !user || user.isAnonymous || !isGoogleAuth(user)) {reviewErrorEl.textContent = "B·∫°n c·∫ßn ƒêƒÉng nh·∫≠p b·∫±ng Google ƒë·ªÉ ƒë√°nh gi√°.";reviewErrorEl.classList.remove('hidden');return;}

    const movieDocRef = doc(db, dataCollectionPath, movieId);
    const reviewDocRef = doc(db, dataCollectionPath, movieId, 'reviews', user.uid);

    try {
        const batch = writeBatch(db);
        let oldRating = 0; let isUpdate = !!currentUserReviewCache;
        if (isUpdate) oldRating = currentUserReviewCache.rating || 0;
        const ratingDifference = rating - oldRating;

        if (isUpdate) {
            batch.update(reviewDocRef, {rating: rating, content: content, updatedAt: serverTimestamp()});
        } else {
            batch.set(reviewDocRef, {
                userId: user.uid, rating: rating, content: content,
                displayName: user.displayName || user.email.split('@')[0], photoURL: user.photoURL, 
                createdAt: serverTimestamp(), updatedAt: serverTimestamp()
            });
        }

        if (isUpdate) {
            batch.update(movieDocRef, {reviewTotal: increment(ratingDifference)});
        } else {
            batch.update(movieDocRef, {reviewTotal: increment(rating), reviewCount: increment(1)});
        }

        await batch.commit();
    } catch (e) {
        console.error("[REVIEW ERROR] L·ªói khi g·ª≠i ƒë√°nh gi√°:", e);
        reviewErrorEl.textContent = "L·ªói h·ªá th·ªëng khi g·ª≠i ƒë√°nh gi√°. Vui l√≤ng th·ª≠ l·∫°i.";
        reviewErrorEl.classList.remove('hidden');
    }
};

const renderPublicReviewItem = (review) => {
    const displayName = review.displayName || '·∫®n danh';
    const photoURL = review.photoURL || `https://placehold.co/40x40/374151/e2e8f0?text=${displayName.charAt(0).toUpperCase()}`;
    const rating = review.rating || 0;
    const dateStr = formatCommentDate(review.updatedAt || review.createdAt);

    return `
                <div class="bg-gray-800 p-4 rounded-lg border border-yellow-700/30 mb-3">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center space-x-3">
                            <img src="${photoURL}" alt="Avatar" class="w-10 h-10 rounded-full object-cover border border-yellow-500" loading="lazy" onerror="this.src='https://placehold.co/40x40/374151/e2e8f0'">
                            <div>
                                <p class="text-white font-bold text-sm">${displayName}</p>
                                <div class="flex text-yellow-400 text-xs">
                                    ${renderStars(rating)}
                                </div>
                            </div>
                        </div>
                        <span class="text-xs text-gray-400">${dateStr}</span>
                    </div>
        ${review.content ? `<p class="text-gray-300 text-sm mt-3 border-t border-gray-700 pt-2">${review.content}</p>` : ''}
                </div>
    `;
};

const setupPublicReviewsListener = (movieId) => {
    if (unsubscribePublicReviewsListener) { unsubscribePublicReviewsListener(); unsubscribePublicReviewsListener = null; }
    const reviewsColRef = collection(db, dataCollectionPath, movieId, 'reviews');
    const q = query(reviewsColRef, orderBy('updatedAt', 'desc'), limit(COMMENT_LIMIT)); 

    unsubscribePublicReviewsListener = onSnapshot(q, (snapshot) => {
        const publicReviewsContainer = getEl('#public-reviews-list');
        if (!publicReviewsContainer) return;
        const reviews = [];
        snapshot.forEach(doc => {reviews.push({ id: doc.id, ...doc.data() });});
        const displayedReviews = reviews.slice(0, REVIEW_DISPLAY_LIMIT); 

        if (reviews.length > 0) {
            publicReviewsContainer.innerHTML = `
                        <h4 class="text-lg font-bold text-yellow-400 mb-4 border-b border-red-800 pb-2">ƒê√°nh gi√° g·∫ßn ƒë√¢y (${reviews.length})</h4>
                        <div class="max-h-96 overflow-y-auto review-scroll-area space-y-3">
                            ${displayedReviews.map(renderPublicReviewItem).join('')}
               ${reviews.length > REVIEW_DISPLAY_LIMIT ? `<p class="text-gray-500 text-center pt-2 text-sm italic">...ƒê√£ ·∫©n ${reviews.length - REVIEW_DISPLAY_LIMIT} ƒë√°nh gi√° c≈© h∆°n ƒë·ªÉ t·ªëi ∆∞u hi·ªáu su·∫•t.</p>` : ''}
                        </div>
           `;
       } else {
        publicReviewsContainer.innerHTML = `<p class="text-gray-500 text-sm italic">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>`;
    }
}, (error) => {
   console.error("L·ªói t·∫£i danh s√°ch ƒë√°nh gi√°:", error);
   if (error.code !== 'failed-precondition') {
       const publicReviewsContainer = getEl('#public-reviews-list');
       if(publicReviewsContainer) publicReviewsContainer.innerHTML = `<p class="text-gray-500 text-sm">Kh√¥ng th·ªÉ t·∫£i ƒë√°nh gi√° l√∫c n√†y.</p>`;
   }
});
};

const setupUserReviewListener = (movieId) => {
    if (unsubscribeReviewListener) { unsubscribeReviewListener(); unsubscribeReviewListener = null; }
    if (!auth?.currentUser || auth.currentUser.isAnonymous) return;

    const user = auth.currentUser;
    const reviewDocRef = doc(db, dataCollectionPath, movieId, 'reviews', user.uid);

    unsubscribeReviewListener = onSnapshot(reviewDocRef, (docSnap) => {
        if (docSnap.exists()) {
            currentUserReviewCache = { id: docSnap.id, ...docSnap.data() };
        } else {
            currentUserReviewCache = null;
        }
        const movie = globalMovieCache.find(m => m.id === movieId);
        if (movie) {setupReviewSection(movie, currentUserReviewCache);}
    }, (error) => {
        console.error("L·ªói listener review ng∆∞·ªùi d√πng:", error);
        currentUserReviewCache = null;
        const movie = globalMovieCache.find(m => m.id === movieId);
        if (movie) setupReviewSection(movie, null); 
    });
};

const renderStars = (rating) => {
    const score = parseFloat(rating) || 0;
    const fullStars = Math.floor(score);
    const halfStar = score % 1 >= 0.5 ? 1 : 0;
    const emptyStars = 5 - fullStars - halfStar;

    let starsHtml = '';
    for (let i = 0; i < fullStars; i++) starsHtml += `<ion-icon name="star" class="text-yellow-400"></ion-icon>`;
        if (halfStar === 1) starsHtml += `<ion-icon name="star-half" class="text-yellow-400"></ion-icon>`;
    for (let i = 0; i < emptyStars; i++) starsHtml += `<ion-icon name="star-outline" class="text-gray-600"></ion-icon>`;
        return starsHtml;
};


const renderSubtleRatingHtml = (movie) => {
    const reviewCount = movie.reviewCount || 0;
    const reviewTotal = movie.reviewTotal || 0;
    const averageRating = reviewCount > 0 ? (reviewTotal / reviewCount) : 0;

    const ratingDisplay = averageRating.toFixed(1);

    if (reviewCount === 0) {

       return `<div class="absolute top-2 left-2 z-10 bg-black/70 rounded-full px-2 py-1 shadow-md text-gray-400 text-xs">--/5</div>`;
   }

   return `
                <div class="absolute top-2 left-2 z-10 bg-black/70 rounded-full px-2 py-1 shadow-md flex items-center space-x-1 border border-yellow-500/50">
                    <ion-icon name="star" class="text-yellow-400 text-xs"></ion-icon>
                    <span class="text-white text-xs font-bold">${ratingDisplay}</span>
                </div>
   `;
};

const renderFormStars = (currentRating) => {
    let html = '';
    for (let i = 5; i >= 1; i--) {
        html += `<input type="radio" id="rating-${i}" name="rating" value="${i}" class="hidden peer" ${currentRating === i ? 'checked' : ''}>
                    <label for="rating-${i}" class="cursor-pointer text-4xl text-gray-600 peer-hover:text-yellow-400 hover:text-yellow-400 transition-colors duration-200">
                        <ion-icon name="${currentRating >= i ? 'star' : 'star-outline'}" class="rating-star-icon" data-rating="${i}"></ion-icon>
    </label>`;
}
return `<div id="rating-input-area" class="flex flex-row-reverse justify-end space-x-1 space-x-reverse">${html}</div>`;
};

const setupReviewSection = (movie, userReview) => {
    const formContainer = getEl('#user-review-form-container');
    if (!formContainer) return;
    const isCommentAllowed = !!auth?.currentUser && !auth.currentUser.isAnonymous && isGoogleAuth(auth.currentUser);
    const user = auth?.currentUser;

    if (userReview) {
        formContainer.innerHTML = `
                    <div class="p-6 bg-gray-800 rounded-lg shadow-inner border border-yellow-500/50">
                        <h3 class="text-xl font-bold text-yellow-400 mb-4">${userReview.rating} Sao - ƒê√°nh gi√° c·ªßa b·∫°n</h3>
                        <p class="text-sm text-gray-400 mb-4">ƒê√°nh gi√° g·∫ßn nh·∫•t v√†o: ${formatCommentDate(userReview.updatedAt || userReview.createdAt)}</p>
                        <form id="review-form" data-movie-id="${movie.id}">
                            ${renderFormStars(userReview.rating)}
                            <textarea id="review-content" class="w-full h-24 px-4 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-600 my-4" placeholder="Chia s·∫ª th√™m c·∫£m nh·∫≠n c·ªßa b·∫°n (t√πy ch·ªçn)...">${userReview.content || ''}</textarea>
                            <p id="review-error" class="text-red-400 text-sm mb-2 hidden"></p>
                            <button type="submit" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors shadow-lg shadow-red-900/50">C·∫≠p nh·∫≠t ƒê√°nh gi√°</button>
                        </form>
                    </div>
        `;
    } else if (isCommentAllowed) {
        formContainer.innerHTML = `
                    <div class="p-6 bg-gray-800 rounded-lg shadow-xl border border-gray-700">
                        <h3 class="text-2xl font-bold text-yellow-400 mb-4">ƒê√°nh Gi√° C·ªßa B·∫°n</h3>
                        <p class="text-gray-400 mb-4">H√£y chia s·∫ª c·∫£m nh·∫≠n c·ªßa b·∫°n v·ªÅ b·ªô phim n√†y:</p>
                        <form id="review-form" data-movie-id="${movie.id}">
                            ${renderFormStars(0)}
                            <textarea id="review-content" class="w-full h-24 px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-600 my-4" placeholder="Chia s·∫ª th√™m c·∫£m nh·∫≠n c·ªßa b·∫°n (t√πy ch·ªçn)..."></textarea>
                            <p id="review-error" class="text-red-400 text-sm mb-2 hidden"></p>
                            <button type="submit" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors shadow-lg shadow-red-900/50">G·ª≠i ƒê√°nh gi√°</button>
                        </form>
                    </div>
        `;
    } else {
        formContainer.innerHTML = `
                    <div class="p-6 bg-gray-800 rounded-lg shadow-xl text-center border border-gray-700">
                        <h3 class="text-2xl font-bold text-white mb-4">ƒê√°nh Gi√°</h3>
                        <p class="text-gray-400">B·∫°n c·∫ßn <a href="#login" class="text-yellow-400 hover:underline font-medium">ƒêƒÉng Nh·∫≠p b·∫±ng Google</a> ƒë·ªÉ g·ª≠i ƒë√°nh gi√° phim.</p>
                    </div>
        `;
    }
    getEl('#review-form')?.addEventListener('submit', handleReviewSubmit);
    const ratingArea = getEl('#rating-input-area');
    if (ratingArea) {
        ratingArea.addEventListener('click', (e) => {
            const target = e.target.closest('label');
            if (target) {
                const rating = parseInt(target.getAttribute('for').replace('rating-', ''));
                const allLabels = ratingArea.querySelectorAll('label');
                allLabels.forEach(label => {
                    const labelRating = parseInt(label.getAttribute('for').replace('rating-', ''));
                    const icon = label.querySelector('ion-icon');
                    if (icon) icon.setAttribute('name', labelRating <= rating ? 'star' : 'star-outline');
                });
            }
        });
    }
};

const MovieCardTemplate = (movie) => {
    const infoUrl = `#phim/${createSlug(movie.title)}-${movie.id}`; 
    const statusText = movie.status || 'N/A';
    const epCount = movie.episodes ? movie.episodes.length : 0;
    const genres = movie.genre ? movie.genre.split(',').map(g => g.trim()).join(', ') : '';

    const ratingHtml = renderSubtleRatingHtml(movie); 

    return `
                <a href="${infoUrl}" class="group block relative overflow-hidden rounded-lg shadow-lg bg-gray-800 transition-transform duration-300 ease-in-out hover:-translate-y-2 hover-tet-effect tet-card-border">
                    <div class="absolute top-2 right-2 z-10 flex flex-col space-y-1 items-end">
                        <span class="inline-block bg-black/70 text-yellow-400 text-xs font-bold px-2 py-1 rounded-md uppercase border border-yellow-600/50">
                            ${statusText === 'sap-chieu' ? 'S·∫Øp chi·∫øu' : (statusText === 'dang-chieu' ? 'ƒêang Chi·∫øu' : 'Full')}
                        </span>
                        <span class="inline-block bg-black/70 text-white text-xs font-bold px-2 py-1 rounded-md">HD</span>
                        <span class="inline-block bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-md">
        ${epCount > 0 ? `T·∫≠p ${epCount}` : 'Ch∆∞a c√≥ t·∫≠p'}
                        </span>
                    </div>
                    ${ratingHtml}
                    <div class="absolute inset-0 z-10">
                        <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex flex-col items-center justify-center p-4">
                            <p class="text-yellow-400 text-lg font-bold mb-2 text-center">XEM NGAY</p>
                            <div class="flex items-center text-sm text-gray-300">
                                <ion-icon name="eye-outline" class="mr-1"></ion-icon> ${(movie.viewCount || 0).toLocaleString('vi-VN')}
                                <ion-icon name="thumbs-up-outline" class="ml-3 mr-1"></ion-icon> ${(movie.likeCount || 0).toLocaleString('vi-VN')}
                            </div>
                        </div>
                    </div>
                    <img src="${movie.posterUrl}" alt="${movie.title}" loading="lazy" class="w-full h-64 object-cover transition-transform duration-300 group-hover:scale-105" onerror="this.src='https://placehold.co/400x600/1a202c/e2e8f0?text=${movie.title.replace(/\s/g, '+')}'">
                    <div class="p-4 bg-gradient-to-t from-red-900/20 to-transparent">
                        <h3 class="text-lg font-bold text-white truncate group-hover:text-yellow-400 transition-colors z-20 relative">${movie.title}</h3>
                        <p class="text-sm text-gray-400 truncate">${genres}</p>
                    </div>
                </a>
    `;
};

const SearchPageTemplate = (movieList, title) => `
            <section>
                <h2 class="text-3xl font-bold text-yellow-400 mb-6 uppercase tracking-wider">${title}</h2>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 md:gap-4">
                    ${movieList.length > 0 ? movieList.map(MovieCardTemplate).join('') : '<p class="text-gray-400 col-span-full">Kh√¥ng t√¨m th·∫•y b·ªô anime n√†o ph√π h·ª£p.</p>'}
                </div>
            </section>
`;

const HeroSectionTemplate = (movie) => {
    if (!movie) return '';
    const movieSlug = createSlug(movie.title);
    const infoUrl = `#phim/${movieSlug}-${movie.id}`; 
    const imageUrl = movie.bannerUrl || movie.posterUrl; 
    const genres = movie.genre ? movie.genre.split(',').slice(0, 2).map(genre => `<span class="bg-red-900/80 border border-yellow-600/30 backdrop-blur-sm text-yellow-200 text-xs font-medium px-3 py-1 rounded-full">${genre.trim()}</span>`).join('') : '';
    return `
                <section class="relative h-[65vh] md:h-[80vh] rounded-xl overflow-hidden mb-12 -mt-8 md:-mt-12 -mx-4 md:-mx-12 border-b-4 border-red-800">
                    <img src="${imageUrl}" alt="${movie.title} backdrop" class="w-full h-full object-cover opacity-70"onerror="this.src='https://placehold.co/1200x600/1a202c/e2e8f0?text=Hero'">
                    <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/80 to-transparent"></div>
                    <div class="absolute inset-0 bg-gradient-to-r from-gray-900 via-gray-900/50 to-transparent"></div>

                    <div class="absolute bottom-0 left-0 p-6 md:p-12 max-w-2xl text-white">
                        <span class="inline-block bg-yellow-500 text-red-900 text-sm font-bold px-3 py-1 rounded-md uppercase mb-4 shadow-lg shadow-yellow-500/20">üî• M·ªõi C·∫≠p Nh·∫≠t T·∫øt</span>
                        <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-2 leading-tight drop-shadow-lg">${movie.title}</h1>
        ${movie.titleOriginal ? `<h4 class="text-xl md:text-2xl font-semibold text-gray-300 mb-2">${movie.titleOriginal}</h4>` : ''}
                        <p class="text-gray-300 text-lg mb-6 line-clamp-3">${movie.summary || 'Kh√¥ng c√≥ t√≥m t·∫Øt.'}</p>
                        <div class="flex items-center space-x-4">
                            <a href="${infoUrl}" class="inline-flex items-center justify-center px-8 py-3 bg-red-600 text-white text-lg font-bold rounded-lg shadow-lg hover:bg-red-700 transition-colors border border-red-500">
                                <ion-icon name="play-circle" class="text-2xl mr-2"></ion-icon>
                                Xem Ngay
                            </a>
                            <div class="flex space-x-2">${genres}</div>
                        </div>
                    </div>

                    <div class="absolute bottom-0 right-0 p-6 md:p-12 z-10 hidden md:block">
                         <div class="flex space-x-2 md:space-x-4 text-sm text-gray-400">
                             <a href="#" class="hover:text-yellow-400 border-b-2 border-red-600 text-white pb-1">T·∫•t c·∫£</a>
                             <a href="#season/mua-he-2024" class="hover:text-yellow-400">M√πa H√® 2024</a>
                             <a href="#top/thang" class="hover:text-yellow-400">Top Th√°ng</a>
                         </div>
                    </div>
                </section>
    `;
};

const MovieSectionTemplate = (title, movieList, xemThemLink = "#") => {
    if (movieList.length === 0) return '';
    return `
                <section class="mb-12 relative">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-6 border-b border-red-800 pb-2">
                        <h2 class="text-3xl font-bold text-yellow-400 uppercase drop-shadow-md flex items-center">
                            <span class="mr-2 text-red-500">üå∏</span> ${title}
                        </h2>
                    </div>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-x-2 gap-y-4 md:gap-4">
                        ${movieList.map(MovieCardTemplate).join('')}
                    </div>
                    <div class="text-center mt-8">
                        <a href="${xemThemLink}" class="bg-gray-800 border border-gray-600 text-gray-300 font-medium px-6 py-3 rounded-lg hover:bg-red-700 hover:text-white hover:border-red-500 transition-all">XEM TH√äM</a>
                    </div>
                </section>
    `;
};

const AuthPageTemplate = () => {
    return `
                <div class="min-h-[70vh] flex items-center justify-center">
                    <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-md text-center border border-red-900">
                        <h2 class="text-3xl font-bold text-yellow-400 text-center mb-6">ƒêƒÉng Nh·∫≠p</h2>
                        <p class="text-gray-400 text-center mb-8">S·ª≠ d·ª•ng t√†i kho·∫£n Google ƒë·ªÉ b√¨nh lu·∫≠n v√† l∆∞u phim y√™u th√≠ch d·ªãp T·∫øt n√†y.</p>
                        <div class="space-y-4">
                            <button id="google-login-btn" class="w-full bg-white text-gray-800 font-bold py-3 px-4 rounded-lg hover:bg-gray-200 transition-colors flex items-center justify-center">
                                <ion-icon name="logo-google" class="text-xl mr-3 text-red-500"></ion-icon>
                                ƒêƒÉng nh·∫≠p v·ªõi Google
                            </button>
                        </div>
                        <p id="auth-error" class="text-red-400 text-sm text-center mt-6"></p>
                    </div>
                </div>
    `;
};

const CommentTemplate = (comment) => {
    const displayName = comment.displayName || comment.email || 'Ng∆∞·ªùi d√πng ·∫©n danh'; 
    const photoURL = comment.photoURL || `https://placehold.co/40x40/374151/e2e8f0?text=${displayName.charAt(0).toUpperCase()}`; 
    return `
            <div class="flex space-x-3 mb-4">
                <div class="flex-shrink-0">
                    <img class="w-10 h-10 rounded-full object-cover border border-yellow-600" src="${photoURL}" alt="Avatar" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/40x40/374151/e2e8f0?text=${displayName.charAt(0).toUpperCase()}';">
                </div>
                <div>
                    <div class="bg-gray-700 p-3 rounded-lg border border-gray-600">
                        <p class="font-semibold text-yellow-200 text-sm">${displayName}</p>
                        <p class="text-gray-300 text-sm">${comment.content}</p>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">${formatCommentDate(comment.createdAt)}</p>
                </div>
            </div>
    `;
};

const renderProfilePage = (user) => {
    const displayName = user.displayName || user.email.split('@')[0];
    const photoURL = user.photoURL || `https://placehold.co/128x128/dc2626/111827?text=${displayName.charAt(0).toUpperCase()}`;
    const email = user.email || 'Kh√¥ng c√≥';
    const provider = isGoogleAuth(user) ? 'Google' : 'Admin Custom Token';

    return `
                <div class="min-h-[70vh] flex items-center justify-center">
                    <div class="bg-gray-800 p-8 rounded-lg shadow-2xl w-full max-w-lg border border-red-800">
                        <h2 class="text-3xl font-bold text-yellow-400 text-center mb-8">H·ªì S∆° C√° Nh√¢n</h2>

                        <div class="flex flex-col items-center mb-8">
                            <img src="${photoURL}" alt="Avatar" class="w-32 h-32 rounded-full object-cover mb-4 border-4 border-yellow-500" onerror="this.onerror=null;this.src='https://placehold.co/128x128/dc2626/111827?text=${displayName.charAt(0).toUpperCase()}'">
                            <p class="text-xl font-bold text-white">${displayName}</p>
                            <p class="text-gray-400 text-sm">${email}</p>
                            <p class="text-gray-500 text-xs mt-1">ƒêƒÉng nh·∫≠p qua: ${provider}</p>
                        </div>

                        <form id="profile-update-form" class="space-y-4">
                            <div class="space-y-1">
                                <label for="profile-name-input" class="block text-sm font-medium text-gray-300">T√™n Hi·ªÉn Th·ªã M·ªõi</label>
                                <input type="text" id="profile-name-input" value="${displayName}" required minlength="3"
                                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-red-600">
                            </div>

                            <div id="profile-success" class="p-3 rounded-lg text-sm text-green-300 hidden transition-all"></div>
                            <p id="profile-error" class="text-red-400 text-sm hidden"></p>

                            <button type="submit" class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors shadow-lg shadow-red-900/40">
                                C·∫≠p Nh·∫≠t
                            </button>
                        </form>

                    </div>
                </div>
    `;
};

const InfoPageTemplate = (movie, episodes, isLiked) => {
    const firstEpisode = episodes.length > 0 ? episodes[0] : null;
    const movieSlug = createSlug(movie.title);
    const firstEpUrl = firstEpisode ? `#phim/${movieSlug}-${movie.id}/tap-${firstEpisode.episodeNumber}-${firstEpisode.id}.html` : '#';
    const imageUrl = movie.bannerUrl || movie.posterUrl; 

    const reviewCount = movie.reviewCount || 0;
    const reviewTotal = movie.reviewTotal || 0;
    const averageRating = reviewCount > 0 ? (reviewTotal / reviewCount) : 0;
    const requiresSignInLink = !!auth?.currentUser && auth.currentUser.isAnonymous;

    return `
                <section class="text-white">
                    <div class="relative rounded-lg overflow-hidden h-64 md:h-96 -mt-8 md:-mt-12 -mx-4 md:-mx-12 border-b-2 border-red-800">
                        <img src="${imageUrl}" alt="${movie.title} backdrop" class="w-full h-full object-cover opacity-70" loading="lazy" onerror="this.src='https://placehold.co/1200x400/1a202c/e2e8f0?text=Backdrop'">
                        <div class="absolute inset-0 bg-gradient-to-t from-gray-900 via-gray-900/80 to-transparent"></div>
                        <div class="absolute inset-0 bg-gradient-to-r from-gray-900 via-gray-900/50 to-transparent"></div>
                    </div>
                    <div class="container mx-auto px-4 relative -mt-32 md:-mt-48 pb-12">
                        <div class="md:flex md:space-x-8">
                            <div class="flex-shrink-0 w-48 md:w-64 mx-auto md:mx-0 md:mt-4">
                                <a href="${firstEpUrl}" class="group block relative rounded-lg shadow-2xl overflow-hidden border-2 border-gray-700 hover:border-yellow-500 transition-colors">
                                    <div class="absolute inset-0 z-10 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
                                        <ion-icon name="play-circle-outline" class="text-7xl text-white opacity-90"></ion-icon>
                                    </div>
                                    <img src="${movie.posterUrl}" alt="${movie.title} poster" class="w-full rounded-lg transition-transform duration-300 group-hover:scale-110" loading="lazy" onerror="this.src='https://placehold.co/400x600/1a202c/e2e8f0?text=${movie.title.replace(/\s/g, '+')}'">
                                </a>
                            </div>
                            <div class="flex-1 mt-6 md:mt-4 text-center md:text-left">
                                <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-0 drop-shadow-lg">${movie.title}</h1>
        ${movie.titleOriginal ? `<h4 class="text-2xl md:text-3xl font-semibold text-gray-400 mb-2">${movie.titleOriginal}</h4>` : ''}

                                <div class="flex flex-wrap justify-center md:justify-start items-center space-x-4 text-gray-400 mb-4">
                                    <div class="flex items-center space-x-1"><ion-icon name="eye-outline" class="text-xl"></ion-icon><span id="view-count">${(movie.viewCount || 0).toLocaleString('vi-VN')} L∆∞·ª£t xem</span></div>
                                    <div class="flex items-center space-x-1"><ion-icon name="thumbs-up-outline" class="text-xl"></ion-icon><span id="like-count">${(movie.likeCount || 0).toLocaleString('vi-VN')} L∆∞·ª£t th√≠ch</span></div>
                                </div>

                                <div class="flex justify-center md:justify-start items-center space-x-2 text-yellow-400 mb-4">
                                    <span class="text-3xl font-bold">${averageRating.toFixed(1)}</span>
                                    <div class="flex text-2xl">${renderStars(averageRating)}</div>
                                    <span class="text-gray-400 text-sm ml-2">(${reviewCount.toLocaleString('vi-VN')} ƒê√°nh gi√°)</span>
                                </div>

                                <div class="flex justify-center md:justify-start space-x-2 mb-4">
        ${movie.genre ? movie.genre.split(',').map(genre => `<span class="bg-gray-800 border border-gray-600 text-gray-300 text-xs font-medium px-3 py-1 rounded-full">${genre.trim()}</span>`).join('') : ''}
                                </div>
                                <p class="text-gray-300 text-lg mb-6">${movie.summary || 'Kh√¥ng c√≥ t√≥m t·∫Øt.'}</p>
                                <div class="flex flex-col space-y-4 md:flex-row md:space-x-4 md:space-y-0">
                                    <a href="${firstEpUrl}" class="inline-flex items-center justify-center px-6 py-3 bg-red-600 text-white text-lg font-bold rounded-lg shadow-lg hover:bg-red-700 transition-colors w-full md:w-auto shadow-red-900/50">
                                        <ion-icon name="play-circle" class="text-2xl mr-2"></ion-icon>Xem Phim
                                    </a>

                                    <button id="like-button" data-movie-id="${movie.id}" class="
                                        inline-flex items-center justify-center px-6 py-3 rounded-lg shadow-lg transition-colors w-full md:w-auto
                                        ${isLiked ? 'bg-yellow-600 text-white font-bold' : 'bg-gray-700 text-gray-300 font-medium hover:bg-gray-600'}
                                    ">
                                        <ion-icon name="${isLiked ? 'thumbs-up' : 'thumbs-up-outline'}" class="text-2xl mr-2"></ion-icon>
                                        <span id="like-button-text">${isLiked ? 'ƒê√£ th√≠ch' : 'Th√≠ch'}</span>
                                    </button>

        ${requiresSignInLink ? `
                                        <a href="#login" class="inline-flex items-center justify-center px-6 py-3 bg-gray-700 text-gray-400 font-medium rounded-lg shadow-lg hover:bg-gray-600 transition-colors w-full md:w-auto">
                                            <ion-icon name="log-in-outline" class="text-2xl mr-2"></ion-icon>ƒêƒÉng nh·∫≠p ƒë·ªÉ gi·ªØ Likes
                                        </a>
            ` : ''}
                                    <span class="inline-block bg-gray-700 text-yellow-400 border border-yellow-600/30 text-sm font-bold px-4 py-2 rounded-full uppercase self-center w-full md:w-auto text-center md:text-left">${movie.status || 'N/A'}</span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-12">
                            <div id="user-review-form-container"></div> 
                            <div id="public-reviews-list" class="mt-8"></div> 
                        </div>

                        <div class="mt-12 bg-gray-800 rounded-lg shadow-lg p-6 border border-gray-700">
                            <h2 class="text-2xl font-bold text-yellow-400 mb-6 flex items-center"><span class="mr-2">üßß</span>Danh S√°ch T·∫≠p</h2>
                            ${episodes.length > 0
                                ? `<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 episode-list-grid">
                                ${episodes.map(ep => `
                                        <a href="#phim/${movieSlug}-${movie.id}/tap-${ep.episodeNumber}-${ep.id}.html" 
                                            class="block py-3 px-4 rounded-lg text-center font-medium transition-colors duration-200 border border-transparent
                                            ${'bg-gray-700 text-white hover:bg-red-700 hover:text-white hover:border-yellow-400'}">
                                            T·∫≠p ${ep.episodeNumber}
                                        </a>
                                    `).join('')}
                                </div>`
                                : `<p class="text-gray-400">${movie.status === 'sap-chieu' ? 'Phim s·∫Øp chi·∫øu, ch∆∞a c√≥ t·∫≠p.' : 'Ch∆∞a c√≥ t·∫≠p phim n√†o cho b·ªô n√†y.'}</p>`
                            }
                        </div>
                    </div>
                </section>
                            `;
                        };

                        const WatchPageTemplate = (movie, episode, comments, allEpisodes, currentEpNumber, nextEpisodeLink) => {
                            const { html: videoPlayerHtml } = getVideoPlayer(episode.videoUrl, movie.posterUrl);
                            const movieSlug = createSlug(movie.title);
                            const user = auth?.currentUser;
                            const canComment = !!user && !user.isAnonymous && isGoogleAuth(user);
                            const displayedComments = comments.slice(0, COMMENT_DISPLAY_LIMIT);

                            const previousEpisode = allEpisodes.find(ep => ep.episodeNumber === currentEpNumber - 1);
                            let previousEpisodeLink = null;
                            if (previousEpisode) {
                                const prevEpId = previousEpisode.id;
                                previousEpisodeLink = `#phim/${movieSlug}-${movie.id}/tap-${previousEpisode.episodeNumber}-${prevEpId}.html`;
                            }

                            const previousButton = previousEpisodeLink ? `
                <a href="${previousEpisodeLink}" class="inline-flex items-center justify-center px-4 py-2 bg-gray-700 text-gray-300 text-sm font-medium rounded-lg hover:bg-gray-600 transition-colors flex-grow md:flex-grow-0 md:w-auto">
                    <ion-icon name="arrow-back-circle-outline" class="text-xl mr-2"></ion-icon> T·∫≠p ${currentEpNumber - 1}
                </a>
                                ` : `
                <button disabled class="inline-flex items-center justify-center px-4 py-2 bg-gray-800 text-gray-500 text-sm font-medium rounded-lg cursor-not-allowed flex-grow md:flex-grow-0 md:w-auto opacity-50">
                    <ion-icon name="arrow-back-circle-outline" class="text-xl mr-2"></ion-icon> T·∫≠p Tr∆∞·ªõc
                </button>
                            `;

                            const nextButton = nextEpisodeLink ? `
                <a href="${nextEpisodeLink}" class="bg-red-600 text-white text-sm font-bold px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center flex-grow md:flex-grow-0 md:w-auto ml-2">
                    T·∫≠p ${currentEpNumber + 1} <ion-icon name="arrow-forward-circle" class="text-xl ml-2"></ion-icon>
                </a>
                                ` : `
                 <button disabled class="bg-red-900 text-red-300 text-sm font-medium px-4 py-2 rounded-lg flex items-center justify-center flex-grow md:flex-grow-0 md:w-auto ml-2 opacity-50">
                    T·∫≠p Cu·ªëi <ion-icon name="lock-closed" class="text-xl ml-2"></ion-icon>
                </button>
                            `;


                            return `
                <section class="text-white">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div id="video-player-container" class="relative w-full aspect-video rounded-xl overflow-hidden shadow-2xl bg-black border-2 border-gray-800">
                                ${videoPlayerHtml}
                                <div id="video-overlay" 
                                    class="overlay-style absolute inset-0 flex items-center justify-center p-4 z-10" 
                                    style="background-image: url('https://uploads.onecompiler.io/43u4wb3ft/43u4y39cc/bannerphim.jpeg'); 
                                        background-size: cover; background-position: center; background-color: rgba(0, 0, 0, 0.4); background-blend-mode: darken;">
                                    <div class="text-center p-4 sm:p-8 rounded-xl max-w-xs sm:max-w-md mx-auto">
                                        <button id="play-video-button" 
                                            class="play-button-overlay text-white font-extrabold text-xl sm:text-2xl px-10 py-5 sm:py-6 rounded-full flex items-center justify-center space-x-3 transform transition-all duration-300 shadow-xl hover:scale-105 border-2 border-yellow-400">
                                            <ion-icon name="play-circle" class="text-3xl sm:text-4xl"></ion-icon>
                                            <span>XEM PHIM</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-6 p-4 bg-gray-800 rounded-lg shadow-lg border-l-4 border-red-600">
                                <h1 class="text-3xl font-extrabold text-white mb-1">${movie.title}</h1>
                                ${movie.titleOriginal ? `<h4 class="text-lg font-semibold text-gray-400 mb-2">${movie.titleOriginal}</h4>` : ''}
                                <h2 class="text-xl font-bold text-yellow-400">T·∫≠p ${currentEpNumber}: ${episode.title || 'ƒêang c·∫≠p nh·∫≠t'}</h2>
                                <p class="text-gray-400 text-sm mt-2">${movie.genre}</p>
                                <div class="flex flex-col space-y-3 mt-4 pt-3 border-t border-gray-700">
                                    <div class="flex flex-wrap items-center justify-start space-x-3">
                                        ${previousButton}
                                        ${nextButton}
                                    </div>
                                    <a href="#phim/${movieSlug}-${movie.id}" class="bg-gray-700 text-gray-300 text-sm font-medium px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors flex items-center justify-center md:w-1/2 lg:w-1/3">
                                        <ion-icon name="information-circle-outline" class="mr-1"></ion-icon> Th√¥ng tin Phim
                                    </a>
                                </div>
                            </div>

                            <div class="mt-8 p-6 bg-gray-800 rounded-lg shadow-lg border border-gray-700">
                                <h3 class="text-2xl font-bold text-yellow-400 mb-4">B√¨nh Lu·∫≠n (<span id="comment-count-display">${comments.length}</span>)</h3>
                                ${canComment ? `
                                    <form id="comment-form" class="mb-6">
                                        <textarea id="comment-input" class="w-full h-20 p-3 mb-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-red-600" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n t·∫°i ƒë√¢y..." required></textarea>
                                        <p id="comment-error" class="text-red-400 text-sm mb-2 hidden"></p>
                                        <button type="submit" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">G·ª≠i B√¨nh Lu·∫≠n</button>
                                    </form>
                                    ` : `
                                    <div class="p-4 bg-gray-700 rounded-lg text-center mb-6">
                                        <p class="text-gray-300">B·∫°n c·∫ßn <a href="#login" class="text-yellow-400 hover:underline font-medium">ƒêƒÉng Nh·∫≠p b·∫±ng Google</a> ƒë·ªÉ b√¨nh lu·∫≠n.</p>
                                    </div>
                                    `}

                                <div id="comments-list">
                                    <div class="max-h-96 overflow-y-auto comments-scroll-area">
                                        ${displayedComments.length > 0
                                            ? displayedComments.map(CommentTemplate).join('')
                                            : '<p class="text-gray-500 text-center">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>'
                                        }
                                            ${comments.length > COMMENT_DISPLAY_LIMIT ? `<p class="text-gray-500 text-center pt-2 text-sm italic">...ƒê√£ ·∫©n ${comments.length - COMMENT_DISPLAY_LIMIT} b√¨nh lu·∫≠n c≈© h∆°n ƒë·ªÉ t·ªëi ∆∞u hi·ªáu su·∫•t.</p>` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-1">
                            <div class="bg-gray-800 p-6 rounded-lg shadow-xl sticky top-[100px] border border-gray-700">
                                <h3 class="text-2xl font-bold text-yellow-400 mb-4 border-b border-red-800 pb-2">Danh S√°ch T·∫≠p (${movie.episodes.length} T·∫≠p)</h3>

                                <div class="space-y-2 max-h-[80vh] overflow-y-auto schedule-scroll-area">
                                    ${allEpisodes.map(ep => {
                                        const epLink = `#phim/${movieSlug}-${movie.id}/tap-${ep.episodeNumber}-${ep.id}.html`;
                                        const isActive = ep.episodeNumber === currentEpNumber;
                                        return `
                                            <a href="${epLink}" 
                                                class="block py-2 px-3 rounded-lg text-sm font-medium transition-colors duration-200 
                                                ${isActive 
                                                    ? 'bg-red-600 text-white font-bold shadow-md hover:bg-red-700 border border-yellow-400' 
                                                    : 'bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white'
                                                    }">
                                                T·∫≠p ${ep.episodeNumber} - ${ep.title || 'ƒêang c·∫≠p nh·∫≠t'}
                                            </a>
                                                    `;
                                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                                                `;
                                            };

                                            const renderScheduleMovieCard = (movie) => {
                                                const infoUrl = `#phim/${createSlug(movie.title)}-${movie.id}`;
                                                const episodeCount = movie.episodes ? movie.episodes.length : 0;
                                                const totalEpisodes = movie.totalEpisodes || '??';
                                                const statusColor = movie.status === 'sap-chieu' ? 'text-yellow-500' : 'text-green-400';
                                                const statusText = movie.status === 'sap-chieu' ? 'S·∫Øp Chi·∫øu' : `T·∫≠p ${episodeCount}/${totalEpisodes}`;


                                                return `
                <a href="${infoUrl}" class="group block bg-gray-700 p-2 rounded-lg flex items-center space-x-2 transition duration-200 hover:bg-red-900/40 border border-gray-600 hover:border-yellow-500/50">
                    <img src="${movie.posterUrl}" alt="${movie.title}" class="w-8 h-12 object-cover rounded flex-shrink-0" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/40x56/1f2937/d1d5db?text=...'">
                    <div class="flex-grow overflow-hidden">
                        <p class="text-white font-semibold text-sm truncate group-hover:text-yellow-400">${movie.title}</p>
                        <p class="text-xs ${statusColor}">${statusText}</p>
                    </div>
                </a>
                                                `;
                                            };

                                            const SchedulePageTemplate = (moviesByDay) => {
                                                const daysOfWeek = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "Ch·ªß Nh·∫≠t"];

                                                return `
                <section class="min-h-[70vh]">
                    <h2 class="text-3xl font-bold text-yellow-400 mb-6 border-b border-red-600 pb-3 flex items-center"><span class="mr-2">üìÖ</span> L·ªäCH CHI·∫æU ANIME TRONG TU·∫¶N</h2>

                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-7 gap-3 md:gap-4">
                                                    ${daysOfWeek.map(day => `
                            <div class="bg-gray-800 p-3 rounded-xl shadow-xl border border-gray-700 hover:border-red-500 transition min-h-[250px] flex flex-col">
                                <h3 class="text-xl font-extrabold text-red-400 mb-3 text-center border-b border-gray-700 pb-2">${day}</h3>
                                <div class="flex-grow space-y-2 max-h-[60vh] overflow-y-auto schedule-scroll-area">
                                    ${(moviesByDay[day] && moviesByDay[day].length > 0)
                                        ? moviesByDay[day].map(renderScheduleMovieCard).join('')
                                        : '<p class="text-gray-500 text-xs italic text-center py-4">Kh√¥ng c√≥ phim chi·∫øu.</p>'
                                    }
                                </div>
                            </div>
                                        `).join('')}
                    </div>

                                                    ${(moviesByDay["Kh√¥ng c√≥"] && moviesByDay["Kh√¥ng c√≥"].length > 0) ? `
                        <div class="mt-12">
                            <h3 class="text-2xl font-bold text-gray-400 mb-4 border-b border-gray-700 pb-2">PHIM CH∆ØA G√ÅN L·ªäCH HO·∫∂C S·∫ÆP CHI·∫æU KH√ÅC</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
                                ${(moviesByDay["Kh√¥ng c√≥"]).map(MovieCardTemplate).join('')}
                            </div>
                        </div>
                                                        ` : ''}
                </section>
                                                    `;
                                                };

                                                const renderSchedulePage = () => { 
                                                    const moviesByDay = { "Th·ª© 2": [], "Th·ª© 3": [], "Th·ª© 4": [], "Th·ª© 5": [], "Th·ª© 6": [], "Th·ª© 7": [], "Ch·ªß Nh·∫≠t": [], "Kh√¥ng c√≥": [] };
                                                    const airingMovies = globalMovieCache.filter(m => m.status === 'dang-chieu' || m.status === 'sap-chieu');
                                                    airingMovies.forEach(movie => {
                                                        const day = movie.airingDay || "Kh√¥ng c√≥";
                                                        moviesByDay.hasOwnProperty(day) ? moviesByDay[day].push(movie) : moviesByDay["Kh√¥ng c√≥"].push(movie); 
                                                    });
                                                    getEl('#app').innerHTML = SchedulePageTemplate(moviesByDay);
                                                };

                                                const showError = (message, details = '') => {
                                                    console.error(message, details);
                                                    const appEl = getEl('#app');
                                                    if (appEl) {
                                                        appEl.innerHTML = `
                    <div class="bg-red-900 border border-red-700 text-red-200 p-6 rounded-lg shadow-lg">
                        <h3 class="text-2xl font-bold mb-3">ƒê√£ x·∫£y ra l·ªói h·ªá th·ªëng</h3>
                        <p class="text-lg mb-2">${message}</p>
                                                            ${details ? `<pre class="bg-gray-800 p-3 rounded-md text-sm text-red-300 overflow-auto">${details}</pre>` : ''}
                        <button onclick="window.location.hash = '#home'" class="mt-4 px-4 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition-colors">V·ªÅ Trang Ch·ªß</button>
                    </div>
                                                        `;
                                                    }
                                                };

                                                const showLoading = () => {
                                                    const appEl = getEl('#app');
                                                    if (appEl) {
                                                        appEl.innerHTML = `
                    <div class="flex justify-center items-center h-[50vh]">
                        <svg class="animate-spin h-10 w-10 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                                                        `;
                                                    }
                                                };

                                                window.renderInfoPage = async (movieId) => { 
                                                   if (!db) { showLoading(); return; }
                                                   if (unsubscribeMovieListener) { unsubscribeMovieListener(); unsubscribeMovieListener = null; }
                                                   if (unsubscribeReviewListener) { unsubscribeReviewListener(); unsubscribeReviewListener = null; }
                                                   if (unsubscribePublicReviewsListener) { unsubscribePublicReviewsListener(); unsubscribePublicReviewsListener = null; }

                                                   const movieDocRef = doc(db, dataCollectionPath, movieId);
                                                   let hasRenderedFullPage = false;

                                                   unsubscribeMovieListener = onSnapshot(movieDocRef, (movieDocSnap) => {
                                                    if (!movieDocSnap.exists()) { 
                                                        showError("Kh√¥ng t√¨m th·∫•y b·ªô phim n√†y.");
                                                        return; 
                                                    }

                                                    const updatedMovieData = { id: movieDocSnap.id, ...movieDocSnap.data() };
                                                    const isLiked = !!currentUserLikeDocIds[movieId]; 

                                                    if (!hasRenderedFullPage) {
                                                        const episodesList = updatedMovieData.episodes || [];
                                                        const episodesWithId = episodesList.map((ep, index) => ({ 
                                                            ...ep, 
                                                            id: `${movieId}_${ep.episodeNumber}_${index}` 
                                                        }));

                                                        const movieSlug = createSlug(updatedMovieData.title);
                                                        const firstEpUrl = `#phim/${movieSlug}-${updatedMovieData.id}/tap-${episodesWithId[0]?.episodeNumber}-${episodesWithId[0]?.id}.html`;

                                                        const resumeTime = localStorage.getItem(`_watchTime_${episodesWithId[0]?.id}`);
                                                        const hasWatchTime = resumeTime && parseInt(resumeTime) > 0;

                                                        getEl('#app').innerHTML = InfoPageTemplate(updatedMovieData, episodesWithId, isLiked);

                                                        if (hasWatchTime) {
                                                           window.showResumeModal(updatedMovieData.title, parseInt(resumeTime)).then(shouldResume => {
                                                            let finalUrl = firstEpUrl;
                                                            if (shouldResume) {
                                                                finalUrl += `?time=${resumeTime}`;
                                                            } else {
                                                                localStorage.removeItem(`_watchTime_${episodesWithId[0]?.id}`);
                                                            }
                                                            window.location.hash = finalUrl;
                                                        });
                                                       }

                                                       getEl('#like-button')?.addEventListener('click', handleLike);
                                                       setupPublicReviewsListener(movieId);

                                                       if (auth?.currentUser && !auth.currentUser.isAnonymous && isGoogleAuth(auth.currentUser)) {
                                                        setupUserReviewListener(movieId);
                                                    } else {
                                                        setupReviewSection(updatedMovieData, null);
                                                    }

                                                    hasRenderedFullPage = true;
                                                } 

                                                incrementViewCount(movieId);

                                                const likeCountEl = getEl('#like-count');
                                                const viewCountEl = getEl('#view-count');
                                                const avgRatingContainer = getEl('.text-yellow-400.mb-4');

                                                if (viewCountEl) viewCountEl.textContent = (updatedMovieData.viewCount || 0).toLocaleString('vi-VN') + " L∆∞·ª£t xem";
                                                if (likeCountEl) likeCountEl.textContent = (updatedMovieData.likeCount || 0).toLocaleString('vi-VN') + " L∆∞·ª£t th√≠ch";

                                                if (avgRatingContainer) {
                                                    const reviewCount = updatedMovieData.reviewCount || 0;
                                                    const reviewTotal = updatedMovieData.reviewTotal || 0;
                                                    const averageRating = reviewCount > 0 ? (reviewTotal / reviewCount) : 0;

                                                    avgRatingContainer.innerHTML = `
                        <span class="text-3xl font-bold">${averageRating.toFixed(1)}</span>
                        <div class="flex text-2xl">${renderStars(averageRating)}</div>
                        <span class="text-gray-400 text-sm ml-2">(${reviewCount.toLocaleString('vi-VN')} ƒê√°nh gi√°)</span>
                                                    `;
                                                }

                                                const button = getEl('#like-button');
                                                const likeButtonText = getEl('#like-button-text');
                                                const likeButtonIcon = button?.querySelector('ion-icon');

                                                if(button) {
                                                    button.classList.toggle('bg-yellow-600', isLiked);
                                                    button.classList.toggle('text-white', isLiked);
                                                    button.classList.toggle('font-bold', isLiked);
                                                    button.classList.toggle('bg-gray-700', !isLiked);
                                                    button.classList.toggle('text-gray-300', !isLiked);
                                                    button.classList.toggle('font-medium', !isLiked);
                                                    if (likeButtonText) likeButtonText.textContent = isLiked ? 'ƒê√£ th√≠ch' : 'Th√≠ch';
                                                    if (likeButtonIcon) likeButtonIcon.setAttribute('name', isLiked ? 'thumbs-up' : 'thumbs-up-outline');
                                                }

                                            }, (error) => {
                                                console.error("L·ªói listener phim:", error);
                                                showError("L·ªói khi t·∫£i d·ªØ li·ªáu phim th·ªùi gian th·ª±c.", error.message);
                                            });
};

window.renderWatchPage = async (movieId, episodeUniqueId) => { 
   if (!db) { showLoading(); return; }
   if (unsubscribeCommentsListener) { unsubscribeCommentsListener(); unsubscribeCommentsListener = null; }
   if (unsubscribeMovieListener) { unsubscribeMovieListener(); unsubscribeMovieListener = null; }
   if (unsubscribeReviewListener) { unsubscribeReviewListener(); unsubscribeReviewListener = null; }
   if (unsubscribePublicReviewsListener) { unsubscribePublicReviewsListener(); unsubscribePublicReviewsListener = null; }

   try {
    let movieData = globalMovieCache.find(a => a.id === movieId);
    if (!movieData) {
        const movieDocSnap = await getDoc(doc(db, dataCollectionPath, movieId));
        if (movieDocSnap.exists()) { 
            movieData = { id: movieDocSnap.id, ...movieDocSnap.data() }; 
        } else { showError("Kh√¥ng t√¨m th·∫•y b·ªô phim n√†y."); return; }
    }

    const episodesList = movieData.episodes || [];
    const episodeMatch = episodeUniqueId.match(/_(\d+)_(\d+)$/);
    const episodeNumber = episodeMatch ? parseInt(episodeMatch[1]) : NaN;

    if (isNaN(episodeNumber)) { showError("L·ªói: Kh√¥ng t√¨m th·∫•y s·ªë t·∫≠p phim."); return; }

    const episodeData = episodesList.find(ep => ep.episodeNumber === episodeNumber);
    if (!episodeData) { showError("Kh√¥ng t√¨m th·∫•y t·∫≠p phim n√†y trong m·∫£ng."); return; }

    const commentsColRef = collection(db, dataCollectionPath, movieId, 'comments');
    let commentsList = [];
    let commentsSnapshot;
    try {
        commentsSnapshot = await getDocs(query(commentsColRef));
        commentsSnapshot.forEach(doc => commentsList.push({ id: doc.id, ...doc.data() }));
        commentsList.sort((a, b) => (b.createdAt?.toDate() || 0) - (a.createdAt?.toDate() || 0));
        commentsList = commentsList.slice(0, COMMENT_LIMIT);
    } catch (e) { console.error("L·ªói khi t·∫£i b√¨nh lu·∫≠n:", e); }

    const nextEpisode = episodesList.find(ep => ep.episodeNumber === episodeNumber + 1);
    let nextEpisodeLink = null;
    if (nextEpisode) {
        const nextEpId = `${movieId}_${nextEpisode.episodeNumber}_${episodesList.indexOf(nextEpisode)}`;
        nextEpisodeLink = `#phim/${createSlug(movieData.title)}-${movieId}/tap-${nextEpisode.episodeNumber}-${nextEpId}.html`;
    }

    const allEpisodesWithId = episodesList.map((ep, index) => ({ ...ep, id: `${movieId}_${ep.episodeNumber}_${index}` }));

    getEl('#app').innerHTML = WatchPageTemplate(movieData, episodeData, commentsList, allEpisodesWithId, episodeNumber, nextEpisodeLink);

    const videoElement = getEl('#video-player-element');

    const urlParams = new URLSearchParams(window.location.hash.split('?')[1]);
    const startTime = parseInt(urlParams.get('time') || localStorage.getItem(`_watchTime_${episodeUniqueId}`) || '0');

    if (videoElement && startTime > 0) {
        videoElement.currentTime = startTime;
    }

    if (videoElement) {
        videoElement.addEventListener('timeupdate', () => {saveWatchTime(episodeUniqueId, videoElement.currentTime);});
        videoElement.addEventListener('ended', () => {localStorage.removeItem(`_watchTime_${episodeUniqueId}`);});
    }

    getEl('#play-video-button')?.addEventListener('click', handlePlayVideo);

    if (commentsSnapshot) getEl('#comment-count-display').textContent = commentsSnapshot.size;

    setupCommentsListener(movieId);

} catch (e) { showError("L·ªói khi t·∫£i trang xem phim.", e.message); }
};

const renderPage = (pageType, param) => {
    if (setupError) {showError(setupError.message, setupError.stack || '');return;}
    if (!db || !isGlobalCacheLoaded) {showLoading();return;}

    const cache = globalMovieCache; let results = []; let title = '';
    const HOME_PAGE_LIMIT = 12;

    switch (pageType) {
    case '#home':
        const moiCapNhatList = cache.filter(a => a.status === 'dang-chieu').slice(0, HOME_PAGE_LIMIT);
        const sapChieuList = cache.filter(a => a.status === 'sap-chieu').slice(0, HOME_PAGE_LIMIT);
        const deCuList = cache.filter(a => a.status === 'tron-bo').slice(0, HOME_PAGE_LIMIT);
        const heroMovie = moiCapNhatList.length > 0 ? moiCapNhatList[0] : (cache.length > 0 ? cache[0] : null);
        getEl('#app').innerHTML = HeroSectionTemplate(heroMovie) + MovieSectionTemplate('M·ªõi C·∫≠p Nh·∫≠t', moiCapNhatList, '#genre/dang-chieu') + MovieSectionTemplate('S·∫Øp Chi·∫øu', sapChieuList, '#genre/sap-chieu') + MovieSectionTemplate('ƒê·ªÅ C·ª≠', deCuList, '#genre/tron-bo');
        return;
    case '#login':
        getEl('#app').innerHTML = AuthPageTemplate();
        getEl('#google-login-btn')?.addEventListener('click', handleGoogleLogin);
        return;
    case '#profile':
        const user = auth?.currentUser;
        if (!user || user.isAnonymous || !isGoogleAuth(user)) {
            getEl('#app').innerHTML = `<div class="text-center text-gray-400"><h2 class="text-3xl font-bold text-yellow-400 mb-6">H·ªì S∆°</h2><p>B·∫°n c·∫ßn <a href="#login" class="text-yellow-400 hover:underline">ƒêƒÉng Nh·∫≠p b·∫±ng Google</a> ƒë·ªÉ xem h·ªì s∆° c√° nh√¢n.</p></div>`; // TET ACCENT
            return;
        }
        getEl('#app').innerHTML = renderProfilePage(user);
        getEl('#profile-update-form')?.addEventListener('submit', handleProfileUpdate);
        return;
    case '#search':
        if (!param) return;
        title = `K·∫øt qu·∫£ t√¨m ki·∫øm cho: "${param}"`;
        const lowerCaseTerm = param.toLowerCase();
        results = cache.filter(m => m.title.toLowerCase().includes(lowerCaseTerm) || (m.titleOriginal && m.titleOriginal.toLowerCase().includes(lowerCaseTerm)));
        break;
    case '#genre':
        if (!param) return;
        const filterSlug = param.toLowerCase(); 
        const filterName = GENRE_TRANSLATIONS[param.split('-').map(p => p.charAt(0).toUpperCase() + p.slice(1)).join(' ')] || filterSlug.replace(/-/g, ' '); 
        title = `Th·ªÉ lo·∫°i: ${filterName}`;
        results = cache.filter(m => {
            if ((m.formatType && m.formatType.toLowerCase() === filterSlug) || (m.status && m.status.toLowerCase() === filterSlug)) {
                return true;
            }


            const movieGenreSlugs = (m.genre || '').split(',').map(g => createSlug(g.trim()));
            return movieGenreSlugs.includes(filterSlug);
        });
        break;
    case '#top':
        if (!param) param = 'thang'
        title = `Top ${param ? param.replace(/-/g, ' ') : 'Anime'} (S·∫Øp x·∫øp theo L∆∞·ª£t xem)`;
        results = [...cache].sort((a, b) => (b.viewCount || 0) - (a.viewCount || 0));
        break;
    case '#season':
        if (!param) param = 'mua-he-2024';
        title = `Anime ${param ? decodeURIComponent(param).replace(/-/g, ' ') : 'M√πa (M·ªõi nh·∫•t)'}`;
        results = cache.filter(m => m.season && m.season.toLowerCase() === param.toLowerCase());
        break;
    case '#library':
        if (!auth?.currentUser || auth.currentUser.isAnonymous) {
            getEl('#app').innerHTML = `<div class="text-center text-gray-400"><h2 class="text-3xl font-bold text-yellow-400 mb-6">Th∆∞ Vi·ªán</h2><p>B·∫°n c·∫ßn <a href="#login" class="text-yellow-400 hover:underline">ƒêƒÉng Nh·∫≠p b·∫±ng Google</a> ƒë·ªÉ xem th∆∞ vi·ªán c√° nh√¢n.</p></div>`; // TET ACCENT
            return;
        }
        title = "Th∆∞ Vi·ªán (Phim ƒë√£ th√≠ch)";
        const likedMovieIds = Object.keys(currentUserLikeDocIds);
        results = cache.filter(m => likedMovieIds.includes(m.id));
        break;
    case '#schedule':
        return renderSchedulePage();
    default:
        window.location.hash = '#home';
        return;
    }
    getEl('#app').innerHTML = SearchPageTemplate(results, title);
};

const router = (shouldUpdateHash = true) => {
    if (setupError) {showError(setupError.message, setupError.stack || '');return;}
    if (!isAuthInitialised) return;

    const activeHash = window.location.hash || '#home';
    const pathSegments = activeHash.substring(1).split('/');
    const primaryHash = '#' + pathSegments[0];

    getAllEl('.nav-active, .mobile-nav-active').forEach(el => el.classList.remove('nav-active', 'mobile-nav-active'));

    const navMap = { '#home': '#home', '#login': '#login', '#library': '#library', '#schedule': '#schedule', '#profile': '#profile' };
    const groupMap = { '#phim': '#home', '#search': '#home', '#genre': '#genre', '#top': '#top', '#season': '#season' };
    const targetHash = navMap[primaryHash] || groupMap[primaryHash];

    if (targetHash) {
        const selector = `.nav-link[href="${targetHash}"], .nav-link[data-hash-group="${targetHash}"], .mobile-nav-link[href="${targetHash}"], .mobile-nav-link[data-hash-group="${targetHash}"]`;
        getAllEl(selector).forEach(el => el.classList.add(el.classList.contains('nav-link') ? 'nav-active' : 'mobile-nav-active'));
    }

    if (primaryHash !== '#phim') {
        if (unsubscribeMovieListener) { unsubscribeMovieListener(); unsubscribeMovieListener = null; }
        if (unsubscribeReviewListener) { unsubscribeReviewListener(); unsubscribeReviewListener = null; }
        if (unsubscribePublicReviewsListener) { unsubscribePublicReviewsListener(); unsubscribePublicReviewsListener = null; }
    }

    if (primaryHash !== '#phim' && unsubscribeCommentsListener) { unsubscribeCommentsListener(); unsubscribeCommentsListener = null; }

    if (primaryHash === '#phim' && pathSegments.length >= 2) {
        const movieIdMatch = pathSegments[1].match(/-([a-zA-Z0-9]+)$/);
        const mId = movieIdMatch ? movieIdMatch[1] : null; 
        if (!mId) return showError("L·ªói URL.", "Kh√¥ng t√¨m th·∫•y ID phim h·ª£p l·ªá.");

        if (pathSegments.length === 2) {

            window.renderInfoPage(mId);
        } else if (pathSegments.length === 3 && pathSegments[2].endsWith('.html')) {
            const episodeMatch = pathSegments[2].match(/-([a-zA-Z0-9_]+)\.html$/); 
            const episodeUniqueId = episodeMatch ? episodeMatch[1] : null;
            if (episodeUniqueId) window.renderWatchPage(mId, episodeUniqueId);
        }
        return;
    }

    renderPage(primaryHash, pathSegments[1]);
};

const setupFirebase = async () => {
    if (!finalConfig.projectId) { setupError = new Error("L·ªói C·∫•u h√¨nh: 'projectId' kh√¥ng ƒë∆∞·ª£c cung c·∫•p."); router(); return; }

    try {
        app = initializeApp(finalConfig);
        db = getFirestore(app);
        auth = getAuth(app);

        await setPersistence(auth, browserLocalPersistence);

        if (initialAuthToken) {
            await signInWithCustomToken(auth, initialAuthToken).catch(e => console.error("L·ªói ƒëƒÉng nh·∫≠p b·∫±ng Custom Token:", e));
        } 

        onAuthStateChanged(auth, async (user) => {
            let needsRerender = false;

            if (user) {
                const oldUserId = userId;
                userId = user.uid;
                updatePaths(userId);

                if (user.isAnonymous) {
                    userEmail = null; 
                    updateAuthStateUI(user);
                } else if (isGoogleAuth(user)) {
                    userEmail = user.email;
                    await ensureUserProfile(user); 
                    updateAuthStateUI(user);
                } else {
                    userEmail = user.email || 'Admin User'; 
                    updateAuthStateUI(user);
                }

                if (oldUserId !== userId) {
                    await fetchUserLikes(true); 
                    needsRerender = true;
                }

            } else { 
                if (userId !== null) {
                    userId = null; userEmail = null; updatePaths(null); currentUserLikeDocIds = {}; needsRerender = true;
                }
                updateAuthStateUI(null);
            }

            if(!isAuthInitialised) {
               isAuthInitialised = true;
               loadInitialMovieCache(); 
           } else if(needsRerender) {
            router();
        }
    });

        if (!auth.currentUser) {
            try {
                signInAnonymously(auth).catch(e => console.error("L·ªói ƒëƒÉng nh·∫≠p ·∫©n danh:", e)); 
            } catch (e) {
                console.error("L·ªói ƒëƒÉng nh·∫≠p ·∫©n danh:", e);
                updatePaths(null); 
            }
        }

    } catch (error) {
        console.error("L·ªói nghi√™m tr·ªçng khi kh·ªüi t·∫°o Firebase SDK:", error);
        setupError = new Error("L·ªói Kh·ªüi t·∫°o Firebase SDK. Chi ti·∫øt: " + error.message);
        router();
    }
};

const loadInitialMovieCache = () => {
   if (!db || isGlobalCacheLoaded) return;

   try {
    const q = query(collection(db, dataCollectionPath));

    onSnapshot(q, (snapshot) => {
        const movieList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        movieList.sort((a, b) => {
            const timeA = b.lastEpisodeUpdate?.toMillis() || b.createdAt?.toMillis() || 0;
            const timeB = a.lastEpisodeUpdate?.toMillis() || a.createdAt?.toMillis() || 0;
            return timeA - timeB; 
        });

        globalMovieCache = movieList;
        const wasCacheLoaded = isGlobalCacheLoaded;
        isGlobalCacheLoaded = true;

        if (!wasCacheLoaded || window.location.hash.startsWith('#home') || window.location.hash === '' || window.location.hash.startsWith('#schedule')) {
            router(false);
        }
    }, (error) => {
        console.error("L·ªói khi t·∫£i danh s√°ch phim (onSnapshot):", error);
        isGlobalCacheLoaded = true;
        showError("L·ªói t·∫£i d·ªØ li·ªáu phim.", error.message);
    });
} catch (e) {
   console.error("L·ªói nghi√™m tr·ªçng khi g·ªçi collection() (Ki·ªÉm tra dataCollectionPath):", e);
   setupError = e;
   router();
}
};

const updateAuthStateUI = (user) => {
    const authButtonDesktop = getEl('#auth-button-desktop');
    const authButtonMobile = getEl('#auth-button-mobile');
    if (!authButtonDesktop || !authButtonMobile) return;

    if (!user || user.isAnonymous) {
        authButtonDesktop.innerHTML = `<a href="#login" class="text-white bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md text-sm font-bold transition-colors shadow-md">ƒêƒÉng Nh·∫≠p</a>`;
        authButtonMobile.innerHTML = `<a href="#login" class="block w-full text-center text-white bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md text-sm font-bold transition-colors">ƒêƒÉng Nh·∫≠p</a>`;
        return;
    }

    if (isGoogleAuth(user)) {
        const displayName = user.displayName || user.email.split('@')[0];
        const photoURL = user.photoURL || `https://placehold.co/32x32/dc2626/111827?text=${displayName.charAt(0).toUpperCase()}`; // TET ACCENT

        authButtonDesktop.innerHTML = `
                    <div class="user-profile-dropdown">
                        <button id="profile-avatar-btn" class="flex items-center p-1 rounded-full bg-gray-700 hover:ring-2 hover:ring-yellow-400 transition-shadow">
                            <img src="${photoURL}" alt="Avatar" class="w-10 h-10 rounded-full object-cover border border-yellow-500" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/40x40/dc2626/111827?text=${displayName.charAt(0).toUpperCase()}'">
                        </button>
                        <div id="user-dropdown-menu" class="user-dropdown-content border border-red-800">
                            <div class="p-4 border-b border-gray-600">
                                <p class="text-white font-bold">${displayName}</p>
                                <p class="text-gray-400 text-sm truncate">${user.email}</p>
                            </div>
                            <a href="#profile" id="profile-link-desktop" class="w-full text-left flex items-center px-4 py-2 text-yellow-400 hover:bg-gray-700 hover:text-yellow-300 transition-colors">
                                <ion-icon name="person-circle-outline" class="text-xl mr-2"></ion-icon>
                                H·ªì S∆°
                            </a>
                            <button id="logout-button-desktop" class="w-full text-left flex items-center px-4 py-2 text-red-400 hover:bg-gray-700 hover:text-red-300 transition-colors">
                                <ion-icon name="log-out-outline" class="text-xl mr-2"></ion-icon>
                                ƒêƒÉng Xu·∫•t
                            </button>
                        </div>
                    </div>
        `;

        authButtonMobile.innerHTML = `
                        <div class="flex items-center mb-3">
                            <img src="${photoURL}" alt="Avatar" class="w-10 h-10 rounded-full mr-3 object-cover border border-yellow-500" loading="lazy" onerror="this.onerror=null;this.src='https://placehold.co/40x40/dc2626/111827?text=${displayName.charAt(0).toUpperCase()}'">
                            <p class="text-sm font-medium text-gray-300 truncate">Xin ch√†o, <span class="text-yellow-400">${displayName}</span></p>
                        </div>
                        <a href="#profile" class="block w-full text-center text-white bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md text-sm font-bold transition-colors mb-3">
                            H·ªì S∆°
                        </a>
            <button id="logout-button-mobile" class="block w-full text-center text-red-300 hover:text-white bg-gray-700 hover:bg-red-800 px-4 py-2 rounded-md text-sm font-medium transition-colors border border-red-800">ƒêƒÉng Xu·∫•t</button>`; // TET ACCENT

            getEl('#profile-avatar-btn')?.addEventListener('click', function() {getEl('#user-dropdown-menu')?.classList.toggle('active');});
            getEl('#logout-button-desktop')?.addEventListener('click', handleLogout);
            getEl('#logout-button-mobile')?.addEventListener('click', (e) => {handleLogout(e);getEl('#mobile-menu')?.classList.add('hidden');});
            getEl('#profile-link-desktop')?.addEventListener('click', () => {getEl('#user-dropdown-menu')?.classList.remove('active');});
        }
    };


    window.addEventListener('hashchange', router);

    document.addEventListener('DOMContentLoaded', async () => {
        // --- ADVANCED CANVAS FLOWER PETAL IMPLEMENTATION (Tet Theme) ---
        (function() {
            const canvas = document.getElementById('snowCanvas'); // Reusing ID but for Flowers
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            let width = window.innerWidth;
            let height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;

            const petals = [];
            const numberOfPetals = 80; 
            
            function createPetal() {
                return {
                    x: Math.random() * width,
                    y: Math.random() * height - height,
                    size: Math.random() * 5 + 3,
                    speed: Math.random() * 1 + 0.5,
                    color: Math.random() > 0.5 ? "#FCD34D" : "#F472B6", // V√†ng (Mai) ho·∫∑c H·ªìng (ƒê√†o)
                    rotation: Math.random() * 360,
                    rotationSpeed: Math.random() * 2 - 1,
                    sway: Math.random() * 2
                };
            }

            for (let i = 0; i < numberOfPetals; i++) { 
                petals.push(createPetal());
            }

            function drawFlowers() {
                ctx.clearRect(0, 0, width, height);

                for (let i = 0; i < petals.length; i++) {
                    let p = petals[i];
                    
                    ctx.save();
                    ctx.translate(p.x, p.y);
                    ctx.rotate(p.rotation * Math.PI / 180);
                    ctx.fillStyle = p.color;
                    
                    // V·∫Ω h√¨nh c√°nh hoa ƒë∆°n gi·∫£n (Elip)
                    ctx.beginPath();
                    ctx.ellipse(0, 0, p.size, p.size / 2, 0, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();

                    // C·∫≠p nh·∫≠t v·ªã tr√≠
                    p.y += p.speed;
                    p.x += Math.sin(p.y / 100) * p.sway;
                    p.rotation += p.rotationSpeed;

                    if (p.y > height) {
                        p.y = -20;
                        p.x = Math.random() * width;
                    }
                }

                requestAnimationFrame(drawFlowers);
            }

            window.addEventListener('resize', () => {
                width = window.innerWidth;
                height = window.innerHeight;
                canvas.width = width;
                canvas.height = height;
            });

            drawFlowers();
        })();

        // End of Canvas Flowers

        await setupFirebase();
        const mobileGenreContainer = getEl('#genre-mobile-list');
        if (mobileGenreContainer) {
            mobileGenreContainer.innerHTML = ALL_GENRES.map(g => {
                const linkData = renderGenreLinkWithSub(g);
                const accentClass = linkData.isPopular ? 'text-yellow-400' : 'text-gray-400';
                return `<a href="#genre/${linkData.slug}" class="genre-item block ${accentClass} hover:text-white px-2 py-1 rounded-md text-sm">${linkData.text}</a>`;
            }).join('');
        }

        getEl('#resume-modal-yes')?.addEventListener('click', () => { window.hideResumeModal(); resolveResumeModal(true); });
        getEl('#resume-modal-no')?.addEventListener('click', () => { window.hideResumeModal(); resolveResumeModal(false); });
        getEl('#mobile-menu-button')?.addEventListener('click', () => getEl('#mobile-menu')?.classList.toggle('hidden'));

        getEl('#search-form-desktop')?.addEventListener('submit', (e) => {
            e.preventDefault();
            const searchTerm = getEl('#search-input-desktop').value.trim();
            if (searchTerm) window.location.hash = `#search/${encodeURIComponent(searchTerm)}`;
        });
        getEl('#search-form-mobile')?.addEventListener('submit', (e) => {
            e.preventDefault();
            const searchTerm = getEl('#search-input-mobile').value.trim();
            if (searchTerm) window.location.hash = `#search/${encodeURIComponent(searchTerm)}`;
            getEl('#mobile-menu')?.classList.add('hidden');
        });

        getAllEl('.mobile-dropdown-toggle').forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                const target = e.currentTarget.nextElementSibling;
                target.classList.toggle('hidden');
                target.classList.toggle('grid');
                e.currentTarget.querySelector('.dropdown-icon')?.classList.toggle('rotate-180');
            });
        });

        getAllEl('#mobile-menu a').forEach(link => {
            link.addEventListener('click', function() {
               if (!this.classList.contains('mobile-dropdown-toggle')) {getEl('#mobile-menu')?.classList.add('hidden');}
           });
        });

        document.body.addEventListener('submit', globalCommentSubmitHandler);

        document.addEventListener('click', function(e) {
            const userDropdown = getEl('.user-profile-dropdown');
            const userDropdownMenu = getEl('#user-dropdown-menu');
            if (userDropdown && userDropdownMenu && !userDropdown.contains(e.target)) {
                userDropdownMenu.classList.remove('active');
            }
        });
    });
</script>

<style>
    /* --- TET SCROLLBAR (Red & Gold) --- */
    ::-webkit-scrollbar {width: 12px;background-color: #1a202c;}
    ::-webkit-scrollbar-thumb {background-color: #dc2626;border-radius: 6px;border: 3px solid #facc15;} /* Red w/ Gold border */
    ::-webkit-scrollbar-thumb:hover {background-color: #b91c1c;}
    .comments-scroll-area, .schedule-scroll-area, .review-scroll-area {scrollbar-width: thin;scrollbar-color: #dc2626 #1a202c;} 

    body {font-family: 'Inter', sans-serif;background-color: #111827; overflow-x: hidden;}
    #app {transition: opacity 0.3s ease-in-out;}
    .dropdown { position: relative; }
    .dropdown-content {display: none;position: absolute;top: 100%;left: 0;background-color: #374151;box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);z-index: 10;border-radius: 0 0 0.5rem 0.5rem; border-top: 2px solid #dc2626;}
    .dropdown-content.mega-menu-3-cols-scroll {grid-template-columns: repeat(3, 1fr);gap: 0.5rem 1rem;padding: 1.5rem;min-width: 600px;max-height: 400px;overflow-y: auto;}
    .dropdown-content.mega-menu-3-cols-season {grid-template-columns: repeat(3, 1fr);gap: 1rem 1.5rem;padding: 1rem 1.5rem;min-width: 550px;max-height: 400px;overflow-y: auto;}
    @media (max-width: 768px) {.dropdown-content.mega-menu-3-cols-scroll, .dropdown-content.mega-menu-3-cols-season {min-width: unset;width: 100vw;left: -1rem;}}
    .dropdown:hover .dropdown-content { display: grid; }
    .dropdown-content a {color: #d1d5db;padding: 0.5rem 0;display: block;white-space: nowrap;}
    .dropdown-content.mega-menu-1-col {min-width: 250px;grid-template-columns: repeat(1, 1fr);padding: 1rem;gap: 0;}
    .dropdown-content.mega-menu-1-col a:hover { background-color: #4b5563; }

    /* --- TET ACCENT --- */
    .nav-link.nav-active {color: #facc15; position: relative;} /* Yellow Text Accent */
    .nav-link.nav-active::after {content: '';position: absolute;bottom: -2px;left: 0;width: 100%;height: 4px;background-color: #dc2626;border-radius: 2px;} /* Red Underline */

    .mobile-nav-link.mobile-nav-active {background-color: #374151;color: #facc15;font-weight: 700;} /* Yellow Mobile Accent */
    
    .dropdown-icon { transition: transform 0.2s ease-in-out; }
    #like-button:disabled { opacity: 0.5; cursor: not-allowed; }
    .line-clamp-3 {overflow: hidden;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 3;}
    .user-profile-dropdown {position: relative;display: inline-block;cursor: pointer;align-self: center; }
    .user-dropdown-content {display: none;position: absolute;right: 0;top: 100%;margin-top: 0.75rem;background-color: #1f2937;min-width: 250px;box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.5);z-index: 100;border-radius: 0.5rem;border: 1px solid #7f1d1d;opacity: 0;transform: translateY(-10px);transition: opacity 0.2s ease-out, transform 0.2s ease-out;pointer-events: none;}
    .user-dropdown-content.active {display: block;opacity: 1;transform: translateY(0);pointer-events: auto;}
    .header-right-desktop {display: flex;align-items: center;height: 100%;}
    #search-form-desktop {flex-grow: 1;max-width: 600px;margin-right: 0.5rem;display: flex;align-items: center;}
    #search-input-desktop {width: 100%;padding-top: 0.5rem;padding-bottom: 0.5rem;}
    .h-20 .container > div {padding-top: 10px;padding-bottom: 10px;}
    .nav-link.header-nav-link {flex-shrink: 0;padding-top: 0;padding-bottom: 0;height: 100%;display: flex;align-items: center;}
    .overlay-style {transition: opacity 0.5s ease-in-out;cursor: pointer;}
    .overlay-style.fade-out {opacity: 0;pointer-events: none;}
    #video-player-container > * {width: 100%;height: 100%;}

    /* --- TET PLAY BUTTON PULSE (RED & GOLD) --- */
    .play-button-overlay {background-color: rgba(220, 38, 38, 0.8); border: 2px solid #facc15; transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;animation: pulse-button-new 3s infinite;}
    .play-button-overlay:hover {background-color: rgba(220, 38, 38, 1);animation: none;transform: scale(1.05);}
    @keyframes pulse-button-new {0% { box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.3); }50% { box-shadow: 0 0 0 10px rgba(250, 204, 21, 0); }100% { box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.3); }}

    #mobile-menu {position: fixed;top: 80px;left: 0;right: 0;bottom: 0;background-color: #1f2937;overflow-y: auto;padding: 1rem;z-index: 40;}
    .mobile-dropdown-content {display: grid;grid-template-columns: repeat(2, 1fr);gap: 0.5rem;padding: 0.5rem 0;}
    @media (min-width: 640px) {.mobile-dropdown-content {grid-template-columns: repeat(3, 1fr);}}
    .mobile-dropdown-content a {background-color: #374151;border-radius: 0.375rem;font-weight: 400;padding: 0.5rem 0.75rem;}
    #cdn-failure-overlay {position: fixed;top: 0;left: 0;width: 100%;height: 100%;background-color: #111827;color: #f3f4f6;display: none;flex-direction: column;align-items: center;justify-content: center;text-align: center;z-index: 10000;padding: 20px;font-family: 'Inter', sans-serif, Arial;margin: 0;}
    .error-container {width: 100%;max-width: 750px;margin: 0 auto;padding: 20px;box-sizing: border-box;background: #1f2937;border-radius: 12px;box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);}
    .error-content-grid {display: grid;grid-template-columns: 1fr;gap: 20px;padding-bottom: 20px;}
    @media (min-width: 600px) {.error-content-grid {grid-template-columns: 2fr 1fr;}}
    .error-header {text-align: center;padding-bottom: 15px;border-bottom: 1px solid #374151;margin-bottom: 20px;grid-column: 1 / -1;}
    .error-header h1 {color: #f59e0b;font-size: 1.8rem;font-weight: 800;margin: 0;}
    .error-header p {font-size: 1rem;color: #9ca3af;margin-top: 5px;}
    .error-card {background: #374151;padding: 15px;border-radius: 8px;margin-bottom: 15px;box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);text-align: left;}
    .error-card h3 {color: #10b981;font-size: 1.1rem;font-weight: 600;margin-top: 0;margin-bottom: 10px;border-bottom: 2px solid #10b981;padding-bottom: 5px;} /* Green Header */
    .error-card ul {list-style: none;padding: 0;margin: 0;}
    .error-card ul li {font-size: 0.95rem;color: #d1d5db;margin-bottom: 5px;position: relative;padding-left: 15px;}
    .error-card ul li::before {content: "‚Ä¢";color: #f59e0b;font-weight: bold;display: inline-block;width: 1em;margin-left: -1em;}
    .action-card {text-align: center;padding-top: 5px;grid-column: 1 / -1;}
    .action-link {display: inline-block;background-color: #dc2626;color: #fff;padding: 10px 20px;border-radius: 8px;text-decoration: none;font-weight: bold;transition: background-color 0.3s ease;box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);font-size: 1rem;} /* Red Action Link */
    .action-link:hover {background-color: #b91c1c;}
    .right-column {display: flex;flex-direction: column;align-items: center;justify-content: flex-start;gap: 15px;padding: 10px;background: #1f2937;border-radius: 8px;border: 1px dashed #374151;}
    @media (max-width: 599px) {.right-column {display: none;}}
    .komiko-logo {width: 100px;height: 100px;border-radius: 50%;margin: 0 auto;border: 3px solid #dc2626;} /* Red Border */
    .apology-text {color: #f59e0b;font-size: 1.1rem;font-weight: 600;margin-top: 20px;grid-column: 1 / -1;}
    .contact-info {display: flex;align-items: center;justify-content: center;margin-top: 15px;}
    .contact-info a {color: #facc15;text-decoration: none;font-size: 0.95rem;display: flex;align-items: center;transition: color 0.3s;}
    .contact-info a:hover {color: #eab308;text-decoration: underline;}
    #rating-input-area .rating-star-icon {transition: color 0.2s;cursor: pointer;}

    /* --- CANVAS SNOWFALL CSS --- */
    #snow-canvas-container {
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        z-index: 9999;
        pointer-events: none;
    }
    #snowCanvas {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
    }
    
    /* --- TET HEADER EFFECTS --- */
    .tet-logo-text {
        text-shadow: 2px 2px #991b1b, 
        -1px -1px #fef08a, 
        0 0 10px rgba(220, 38, 38, 0.5);
    }
    .tet-greeting {
        color: #facc15;
        font-family: 'Dancing Script', cursive;
        font-size: 1.8rem;
        font-weight: 700;
        margin-left: 1rem;
        text-shadow: 0 0 5px #b45309;
        display: flex;
        align-items: center;
    }
    .tet-icon {
        margin-right: 0.5rem;
        font-size: 1.5rem;
        animation: swing 2s infinite ease-in-out;
    }
    @keyframes swing {
        0%, 100% { transform: rotate(-10deg); }
        50% { transform: rotate(10deg); }
    }

    /* --- TET CARD HOVER EFFECT --- */
    .hover-tet-effect {
        position: relative;
        z-index: 1;
    }
    .hover-tet-effect:hover::before {
        content: 'üå∏ üßß üå∏ üß® üå∏ üßß';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 50%;
        background: linear-gradient(to bottom, rgba(220, 38, 38, 0.9), rgba(220, 38, 38, 0.6) 50%, rgba(255,255,255,0));
        color: #fef08a; /* Gold text */
        font-size: 24px;
        text-align: center;
        padding-top: 10px;
        opacity: 1;
        transition: all 0.3s ease-in-out;
        pointer-events: none;
        overflow: hidden;
        border-radius: 0.5rem 0.5rem 0 0;
        text-shadow: 1px 1px 0px #7f1d1d;
    }

    /* --- CARD BORDER BLINKING LIGHTS (Red/Gold) --- */
    .tet-card-border {
        box-shadow: 0 0 0 1px #374151;
        transition: box-shadow 0.3s ease-in-out;
    }
    .tet-card-border:hover {
        animation: tet-blink 1.5s infinite alternate;
        border-color: #facc15;
    }
    @keyframes tet-blink {
        0% { box-shadow: 0 0 5px #dc2626; } /* Red glow */
        100% { box-shadow: 0 0 15px #facc15; } /* Gold glow */
    }

    #foxanime_bottom_left {  position: fixed; z-index: 50; } 
    #foxanime_bottom_left { bottom: 60px; left: -30px; }

    #genre-mobile-list { grid-template-columns: repeat(2, 1fr); gap: 0.5rem; max-height: 40vh; overflow-y: auto; padding-right: 0.5rem; }
    @media (min-width: 640px) {#genre-mobile-list { grid-template-columns: repeat(3, 1fr);}}
    .mobile-dropdown-content a.genre-item { background-color: #1f2937; border: 1px solid #374151; }
    .mobile-dropdown-content a.genre-item:hover { background-color: #4b5563; }

</style>
</head>
<body class="bg-gray-900 text-gray-100">


    <div id="xmas-popup" class="fixed inset-0 z-[9999] flex items-center justify-center bg-black/90 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-500" onclick="if(event.target === this) closeXmasPopup()">
    
    <div id="xmas-popup-content" class="relative bg-red-950 w-full max-w-md mx-4 rounded-3xl border-4 border-yellow-500 shadow-[0_0_50px_rgba(220,38,38,0.5)] transform scale-90 transition-all duration-500 overflow-hidden">
        
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-1/2 bg-gradient-to-b from-yellow-500/20 to-transparent opacity-50 blur-3xl pointer-events-none"></div>
        <div class="absolute inset-0 opacity-10" style="background-image: url('https://www.transparenttextures.com/patterns/oriental-tiles.png'); pointer-events: none;"></div>

        <button onclick="closeXmasPopup()" class="absolute top-4 right-4 text-yellow-500 hover:text-white hover:bg-red-600 rounded-full p-2 transition-colors z-20 group">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:rotate-90 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <div class="relative z-10 p-8 text-center">
            
            <div class="mb-4 animate-bounce">
                <!-- Using placeholder for Tet Logo, user can replace -->
                 <div class="text-5xl">üå∏üßßüå∏</div>
            </div>
            <h2 class="text-2xl sm:text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-300 via-yellow-100 to-yellow-300 mb-2 uppercase tracking-wider font-[Dancing Script]">
                CH√öC M·ª™NG NƒÇM M·ªöI 2026
            </h2>
            <p class="text-yellow-100 text-sm mb-6 leading-relaxed">
                NƒÉm m·ªõi B√≠nh Ng·ªç, ch√∫c b·∫°n An Khang Th·ªãnh V∆∞·ª£ng - V·∫°n S·ª± Nh∆∞ √ù.<br>
                C√πng c√†y Anime th·∫£ ga nh√©! üéÜ
            </p>

            <div class="bg-red-900/50 rounded-2xl p-4 border border-yellow-500/50 mb-6 backdrop-blur-md">
                <p class="text-[10px] text-yellow-300 uppercase font-bold mb-3 tracking-[0.2em] text-center">ƒê·∫øm ng∆∞·ª£c t·ªõi Giao Th·ª´a</p>
                <div class="flex justify-center items-center gap-2 sm:gap-4 text-white">
                    <div class="flex flex-col items-center w-12 sm:w-14">
                        <span id="pop-days" class="text-xl sm:text-2xl font-bold text-yellow-400 font-mono tabular-nums">00</span>
                        <span class="text-[8px] text-gray-300 font-medium mt-1">NG√ÄY</span>
                    </div>
                    <span class="text-yellow-600 font-bold text-lg sm:text-xl mb-4">:</span>
                    <div class="flex flex-col items-center w-12 sm:w-14">
                        <span id="pop-hours" class="text-xl sm:text-2xl font-bold font-mono tabular-nums">00</span>
                        <span class="text-[8px] text-gray-300 font-medium mt-1">GI·ªú</span>
                    </div>
                    <span class="text-yellow-600 font-bold text-lg sm:text-xl mb-4">:</span>
                    <div class="flex flex-col items-center w-12 sm:w-14">
                        <span id="pop-minutes" class="text-xl sm:text-2xl font-bold font-mono tabular-nums">00</span>
                        <span class="text-[8px] text-gray-300 font-medium mt-1">PH√öT</span>
                    </div>
                    <span class="text-yellow-600 font-bold text-lg sm:text-xl mb-4">:</span>
                    <div class="flex flex-col items-center w-12 sm:w-14">
                        <span id="pop-seconds" class="text-xl sm:text-2xl font-bold text-red-500 font-mono tabular-nums">00</span>
                        <span class="text-[8px] text-gray-300 font-medium mt-1">GI√ÇY</span>
                    </div>
                </div>
            </div>

            <button onclick="closeXmasPopup()" class="w-full py-3.5 rounded-xl bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-red-900 font-bold text-sm sm:text-base shadow-lg shadow-yellow-900/30 transform transition hover:scale-[1.02] active:scale-95 border border-yellow-300">
                üßß NH·∫¨N L√å X√å & XEM PHIM NGAY
            </button>
        </div>
    </div>
</div>

<script>
    // 1. H√†m hi·ªán Popup (T·ª± ƒë·ªông sau 0.8s)
    window.addEventListener('load', () => {
        if (!sessionStorage.getItem('hideXmasPopup')) {
            setTimeout(() => {
                const popup = document.getElementById('xmas-popup');
                const content = document.getElementById('xmas-popup-content');
                if (popup && content) {
                    popup.classList.remove('opacity-0', 'pointer-events-none');
                    content.classList.remove('scale-90');
                    content.classList.add('scale-100');
                }
            }, 800);
        }
    });

    // 2. H√†m ƒë√≥ng Popup
    window.closeXmasPopup = function() {
        const popup = document.getElementById('xmas-popup');
        const content = document.getElementById('xmas-popup-content');
        if (popup && content) {
            popup.classList.add('opacity-0', 'pointer-events-none');
            content.classList.remove('scale-100');
            content.classList.add('scale-90');
            sessionStorage.setItem('hideXmasPopup', 'true');
        }
    };

    // 3. Logic ƒê·∫øm ng∆∞·ª£c (T·ªõi T·∫øt √Çm L·ªãch 2026 - M√πng 1 l√† 17/02/2026)
    const popupEndDate = new Date(2026, 1, 17, 0, 0, 0).getTime(); // Th√°ng 1 l√† th√°ng 2 (0-indexed)
    const popupInterval = setInterval(function() {
        const now = new Date().getTime();
        const distance = popupEndDate - now;
        
        const d = Math.floor(distance / (1000 * 60 * 60 * 24));
        const h = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((distance % (1000 * 60)) / 1000);

        const elD = document.getElementById("pop-days"); if(elD) elD.innerText = d<10?"0"+d:d;
        const elH = document.getElementById("pop-hours"); if(elH) elH.innerText = h<10?"0"+h:h;
        const elM = document.getElementById("pop-minutes"); if(elM) elM.innerText = m<10?"0"+m:m;
        const elS = document.getElementById("pop-seconds"); if(elS) elS.innerText = s<10?"0"+s:s;

        if (distance < 0) { clearInterval(popupInterval); closeXmasPopup(); }
    }, 1000);
</script>

<!-- NEW CANVAS FOR TET FLOWER PETALS -->
<div id="snow-canvas-container" class="fixed inset-0 z-[9999] pointer-events-none"> 
    <canvas id="snowCanvas"></canvas>
</div>

<div id="cdn-failure-overlay">
    <div class="error-container">
        <div class="error-header">
            <h1>L·ªói H·ªá Th·ªëng FOXANIME 5xx!</h1>
            <p>M√°y ch·ªß ƒëang g·∫∑p s·ª± c·ªë v√† kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu y√™u c·∫ßu.</p>
        </div>
        <div class="error-content-grid">
            <div class="left-column">
                <div class="error-card">
                    <h3>Chi ti·∫øt S·ª± c·ªë</h3>
                    <p style="font-size:0.95rem; color:#d1d5db; margin-bottom: 10px;">**CDN/Network Failure**</p>
                    <p style="font-size:0.9rem; color:#9ca3af; margin:0;">Trang web kh√¥ng th·ªÉ t·∫£i ƒë∆∞·ª£c c√°c t√†i nguy√™n b√™n ngo√†i (CSS, fonts, icons) c·∫ßn thi·∫øt ƒë·ªÉ hi·ªÉn th·ªã giao di·ªán ch√≠nh.</p>
                </div>
                <div class="error-card" style="margin-bottom: 0;">
                    <h3>Nguy√™n nh√¢n c√≥ th·ªÉ</h3>
                    <ul>
                        <li>L·ªói m·∫°ng c·ªßa Qu√Ω kh√°ch</li>
                        <li>S·ª± c·ªë nh√† cung c·∫•p d·ªãch v·ª• (v√≠ d·ª•: Cloudflare CDN)</li>
                        <li>L·ªói k·∫øt n·ªëi t·ª´ m√°y ch·ªß FOXANIME</li>
                        <li>V·∫•n ƒë·ªÅ b·∫£o tr√¨ kh√¥ng b√°o tr∆∞·ªõc</li>
                    </ul>
                </div>
            </div>
            <div class="right-column">
                <img src="https://uploads.onecompiler.io/43u4wb3ft/4452bnsfd/KomikoAI.jpg" alt="KomikoAI Logo" class="komiko-logo" onerror="this.onerror=null;this.src='https://placehold.co/100x100/1f2937/d1d5db?text=KOMIKO'">
                <div class="error-card" style="margin-bottom: 0; width: 100%; text-align: center;">
                    <h3>Kh√¥i ph·ª•c T·ª± ƒë·ªông</h3>
                    <p style="font-size:0.95rem; color:#d1d5db; margin-bottom: 10px;">H·ªá th·ªëng s·∫Ω th·ª≠ l·∫°i t·ª± ƒë·ªông sau 15 gi√¢y.</p>
                    <a href="javascript:location.reload()" class="action-link" style="font-size: 0.9rem; padding: 8px 15px;">T·∫£i l·∫°i trang ngay</a>
                </div>
                <div class="contact-info" style="margin-top: 0;">
                   <a href="mailto:haistrem6792@gmail.com">
                    <ion-icon name="mail-outline" style="font-size: 1.2rem; margin-right: 5px;"></ion-icon>
                    Li√™n h·ªá ngay
                </a>
            </div>
        </div>
    </div>
    <p class="apology-text">Th√†nh th·∫≠t xin l·ªói v√¨ s·ª± b·∫•t ti·ªán n√†y!</p>
</div>
</div>

<div id="browser-warning-modal" class="fixed inset-0 bg-black/80 items-center justify-center z-[9999] backdrop-blur-sm font-sans" style="display: none;">
    <div class="relative p-8 rounded-xl w-full max-w-lg mx-4 text-center bg-gray-800 border-2 border-red-500 shadow-[0_0_30px_rgba(239,68,68,0.6)]">

        <!-- Logo Ch√≠nh (Hi·ªáu ·ª©ng khung v√†ng) -->
        <img src="https://uploads.onecompiler.io/43u4wb3ft/445etdc2s/KomikoAI%20(1)c%E1%BA%A3nhbao.jpg" 
        alt="C·∫£nh b√°o Komiko AI" 
        class="mx-auto mb-6 w-40 h-40 object-cover rounded-full border-4 border-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.6)]" 
        onerror="this.onerror=null;this.src='https://placehold.co/160x160/f59e0b/111827?text=Warning';" />

        <h3 class="text-3xl font-extrabold text-white mb-4"> ‚ö†Ô∏èCH√ö √ù QUAN TR·ªåNG!‚ö†Ô∏è</h3>
        <p class="text-xl text-yellow-400 mb-6 font-semibold">
            B·∫°n ƒëang d√πng Edge v√† g·∫∑p l·ªói video?
        </p>

        <p class="text-gray-300 mb-6 text-lg">
            ƒê·ªÉ c√≥ tr·∫£i nghi·ªám xem phim m∆∞·ª£t m√† v√† ·ªïn ƒë·ªãnh nh·∫•t FoxAnime khuy·∫øn ngh·ªã:
        </p>

        <div class="flex justify-center items-center space-x-6 mb-2 text-white">
           <div class="text-center">
            <img src="https://static.vecteezy.com/system/resources/previews/022/484/505/original/google-chrome-icon-logo-symbol-free-png.png" 
            alt="Chrome" class="w-12 h-12 object-contain mx-auto rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/48x48/4285F4/ffffff?text=C'" />
            <p class="text-sm font-semibold mt-1">Chrome</p>
        </div>
        <div class="text-center">
            <img src="https://images-eds-ssl.xboxlive.com/image?url=4rt9.lXDC4H_93laV1_eHHFT949fUipzkiFOBH3fAiZZUCdYojwUyX2aTonS1aIwMrx6NUIsHfUHSLzjGJFxxtj3WMWEcdizFJ_lWFKualPWxv8XgjhnjQcY4q6p8oU2bIsTOD2JpDRIDQ2oI6DDRNllQJi9sB9jOaxLSd5Fix8-&format=source" 
            alt="C·ªëc C·ªëc" class="w-12 h-12 object-contain mx-auto rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/48x48/009688/ffffff?text=CC'">
            <p class="text-sm font-semibold mt-1">C·ªëc C·ªëc</p>
        </div>
        <div class="text-center">
            <img src="https://th.bing.com/th/id/OSAAS.CAEDCF679CE094D1FA12A2EFD5427542?w=72&h=72&c=17&rs=1&o=6&dpr=1.3&pid=TechQna" 
            alt="Firefox" class="w-12 h-12 object-contain mx-auto rounded-full" onerror="this.onerror=null;this.src='https://placehold.co/48x48/FF7100/ffffff?text=F'" />
            <p class="text-sm font-semibold mt-1">Firefox</p>
        </div>
    </div>

    <p class="text-sm text-gray-500 mb-6 italic">v√† c√≤n nhi·ªÅu tr√¨nh duy·ªát kh√°c</p>

    <p class="text-gray-300 mb-6 italic">
        FoxAnime ch√¢n th√†nh xin l·ªói v√¨ s·ª± b·∫•t ti·ªán n√†y!üòì
    </p>

    <button onclick="closeWarningModal()" 
    class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors text-lg shadow-xl cursor-pointer">
    T√îI ƒê√É HI·ªÇU (ƒê√≥ng)
</button>
</div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var isEdge = /Edg/.test(navigator.userAgent);
        var hasClosed = sessionStorage.getItem('hideEdgeWarning') === 'true';

        if (isEdge && !hasClosed) {
            document.getElementById('browser-warning-modal').style.display = 'flex';
        }
    });

    function closeWarningModal() {
        document.getElementById('browser-warning-modal').style.display = 'none';
        sessionStorage.setItem('hideEdgeWarning', 'true');
    }
</script>


<div id="resume-modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50">
    <div class="bg-gray-800 p-8 rounded-xl w-full max-w-sm mx-4 shadow-2xl text-center border border-red-600">
        <h3 class="text-xl font-bold text-yellow-400 mb-4">Xem Ti·∫øp Phim</h3>
        <p id="resume-modal-text" class="text-gray-300 mb-6"></p>
        <div class="flex justify-center space-x-4">
            <button id="resume-modal-yes" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Xem ti·∫øp</button>
            <button id="resume-modal-no" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Xem t·ª´ ƒë·∫ßu</button>
        </div>
    </div>
</div>

<header class="bg-gray-800 shadow-lg sticky top-0 z-50 border-b border-red-900">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
            <div class="flex items-center h-full space-x-8">
                <a href="#home" class="flex-shrink-0 flex items-center space-x-2 h-full">
                    <img src="https://uploads.onecompiler.io/43u4wb3ft/44d7fqhzv/tet2005_n.png" alt="FOXANIME Logo" class="w-14 h-14 object-contain">
                    <div class="flex items-center flex-col md:flex-row md:items-baseline">
                        <div class="flex items-center">
                            <span class="text-4xl font-extrabold text-white tet-logo-text">FOX</span>
                            <span class="text-4xl font-extrabold text-red-600 tet-logo-text">ANIME</span>
                        </div>
                        <span class="tet-greeting hidden md:flex"><span class="tet-icon">üå∏</span>Ch√∫c M·ª´ng NƒÉm M·ªõi 2026</span> 
                    </div>
                </a>
            </div>

            <div class="hidden lg:flex items-center space-x-4 header-right-desktop h-full">
                <form id="search-form-desktop" class="relative flex-grow flex items-center">
                    <input id="search-input-desktop" type="text" placeholder="T√¨m ki·∫øm anime ng√†y T·∫øt..." 
                    class="bg-gray-700 text-white px-4 py-2 rounded-full w-full focus:outline-none focus:ring-2 focus:ring-red-600 focus:bg-gray-600 transition-all border border-transparent focus:border-yellow-500" autocomplete="off">
                    <button type="submit" class="absolute right-0 top-0 h-full px-3 text-gray-400 hover:text-yellow-400 flex items-center justify-center">
                        <ion-icon name="search-outline"></ion-icon>
                    </button>
                </form>

                <div id="auth-button-desktop" class="flex items-center h-full flex-shrink-0">
                    <a href="#login" class="text-white bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md text-sm font-bold transition-colors">ƒêƒÉng Nh·∫≠p</a>
                </div>
            </div>

            <div class="lg:hidden flex items-center">
                <button id="mobile-menu-button" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-red-600" aria-controls="mobile-menu" aria-expanded="false">
                    <span class="sr-only">M·ªü menu</span>
                    <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                    <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
        </div>

        <nav class="hidden lg:flex py-3 border-t border-gray-700/50">
            <div class="flex space-x-6 items-center">
                <a href="#home" class="nav-link text-gray-300 hover:text-yellow-400 text-sm font-medium uppercase tracking-wider transition-colors">Trang Ch·ªß</a>

                <div class="dropdown">
                    <a href="#genre" data-hash-group="#genre" class="nav-link flex items-center text-gray-300 hover:text-yellow-400 text-sm font-medium uppercase tracking-wider transition-colors">
                        D·∫°ng Anime
                        <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </a>
                    <div class="dropdown-content mega-menu-1-col">
                        <a href="#genre/tv-series">TV/Series</a>
                        <a href="#genre/movie-ova">Movie/OVA</a>
                        <a href="#genre/hh-trung-quoc">HH Trung Qu·ªëc</a>
                        <a href="#genre/anime-tron-bo">Anime Tr·ªçn B·ªô</a>
                    </div>
                </div>

                <div class="dropdown">
                    <a href="#top" data-hash-group="#top" class="nav-link flex items-center text-gray-300 hover:text-yellow-400 text-sm font-medium uppercase tracking-wider transition-colors">
                        Top Anime
                        <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </a>
                    <div class="dropdown-content mega-menu-1-col">
                        <a href="#top/ngay">Top Ng√†y</a>
                        <a href="#top/tuan">Top Tu·∫ßn</a>
                        <a href="#top/thang">Top Th√°ng</a>
                        <a href="#top/nam">Top NƒÉm</a>
                    </div>
                </div>

                <div class="dropdown">
                    <a href="#genre" data-hash-group="#genre" class="nav-link flex items-center text-gray-300 hover:text-yellow-400 text-sm font-medium uppercase tracking-wider transition-colors">
                        Th·ªÉ Lo·∫°i
                        <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                    </a>
                    <div class="dropdown-content mega-menu-3-cols-scroll">
                        <div class="col-span-full mb-2 border-b border-gray-600 pb-1">
                            <span class="text-yellow-400 font-bold text-xs uppercase block mb-1">Ph·ªï Bi·∫øn</span>
                            <div class="grid grid-cols-3 gap-x-4">
                                <a href="#genre/action" class="font-bold text-yellow-200 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Action (H√†nh ƒë·ªông)</a>
                                <a href="#genre/romance" class="font-bold text-yellow-200 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Romance (L√£ng m·∫°n)</a>
                                <a href="#genre/comedy" class="font-bold text-yellow-200 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Comedy (H√†i h∆∞·ªõc)</a>
                            </div>
                        </div>

                        <a href="#genre/adventure" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Adventure (Phi√™u l∆∞u)</a>
                        <a href="#genre/boys-love" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Boys Love (ƒêam m·ªπ)</a>
                        <a href="#genre/cartoon" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Cartoon (Ho·∫°t h√¨nh)</a>
                        <a href="#genre/dementia" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Dementia (ƒêi√™n lo·∫°n)</a>
                        <a href="#genre/demons" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Demons (√Åc qu·ª∑)</a>
                        <a href="#genre/drama" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Drama (K·ªãch t√≠nh)</a>
                        <a href="#genre/ecchi" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Ecchi (Ecchi)</a>
                        <a href="#genre/fantasy" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Fantasy (Gi·∫£ t∆∞·ªüng)</a>
                        <a href="#genre/game" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Game (Tr√≤ ch∆°i)</a>
                        <a href="#genre/harem" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Harem (Harem)</a>
                        <a href="#genre/historical" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Historical (L·ªãch s·ª≠)</a>
                        <a href="#genre/horror" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Horror (Kinh d·ªã)</a>
                        <a href="#genre/josei" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Josei (Josei)</a>
                        <a href="#genre/kids" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Kids (Tr·∫ª em)</a>
                        <a href="#genre/live-action" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Live Action (Ng∆∞·ªùi ƒë√≥ng)</a>
                        <a href="#genre/magic" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Magic (Ma thu·∫≠t)</a>
                        <a href="#genre/martial-arts" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Martial Arts (V√µ thu·∫≠t)</a>
                        <a href="#genre/mecha" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Mecha (Robot)</a>
                        <a href="#genre/military" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Military (Qu√¢n s·ª±)</a>
                        <a href="#genre/music" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Music (√Çm nh·∫°c)</a>
                        <a href="#genre/mystery" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Mystery (B√≠ ·∫©n)</a>
                        <a href="#genre/parody" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Parody (H√†i nh√°i)</a>
                        <a href="#genre/police" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Police (C·∫£nh s√°t)</a>
                        <a href="#genre/psychological" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Psychological (T√¢m l√Ω)</a>
                        <a href="#genre/samurai" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Samurai (Samurai)</a>
                        <a href="#genre/school" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">School (H·ªçc ƒë∆∞·ªùng)</a>
                        <a href="#genre/sci-fi" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Sci-Fi (Vi·ªÖn t∆∞·ªüng)</a>
                        <a href="#genre/seinen" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Seinen (Seinen)</a>
                        <a href="#genre/shoujo" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Shoujo (Thi·∫øu n·ªØ)</a>
                        <a href="#genre/shoujo-ai" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Shoujo Ai (B√°ch h·ª£p (Nh·∫π))</a>
                        <a href="#genre/shounen" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Shounen (Thi·∫øu ni√™n)</a>
                        <a href="#genre/shounen-ai" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Shounen Ai (ƒêam m·ªπ (Nh·∫π))</a>
                        <a href="#genre/slice-of-life" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Slice of Life (ƒê·ªùi th∆∞·ªùng)</a>
                        <a href="#genre/space" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Space (V≈© tr·ª•)</a>
                        <a href="#genre/sports" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Sports (Th·ªÉ thao)</a>
                        <a href="#genre/super-power" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Super Power (Si√™u nƒÉng l·ª±c)</a>
                        <a href="#genre/supernatural" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Supernatural (Si√™u nhi√™n)</a>
                        <a href="#genre/suspense" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Suspense (H·ªìi h·ªôp)</a>
                        <a href="#genre/thriller" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Thriller (Gi·∫≠t g√¢n)</a>
                        <a href="#genre/tokusatsu" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Tokusatsu (Tokusatsu)</a>
                        <a href="#genre/vampire" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Vampire (Ma c√† r·ªìng)</a>
                        <a href="#genre/yaoi" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Yaoi (ƒêam m·ªπ (M·∫°nh))</a>
                        <a href="#genre/yuri" class="text-gray-300 hover:bg-gray-600 hover:text-yellow-400 rounded-md block px-2 py-1 transition-colors duration-200">Yuri (B√°ch h·ª£p (M·∫°nh))</a>
                    </div>
                </div>

                <div class="dropdown">
                   <a href="#season" data-hash-group="#season" class="nav-link flex items-center text-gray-300 hover:text-yellow-400 text-sm font-medium uppercase tracking-wider transition-colors">
                    Season
                    <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </a>
                <div class="dropdown-content mega-menu-3-cols-season">

                    <div>
                        <span class="text-yellow-400 font-bold text-sm uppercase block mb-1 border-b border-gray-600 pb-1">NƒÉm 2026</span>
                        <a href="#season/mua-xuan-2026" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa Xu√¢n</a>
                        <a href="#season/mua-he-2026" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa H√®</a>
                        <a href="#season/mua-thu-2026" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa Thu</a>
                        <a href="#season/mua-dong-2026" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa ƒê√¥ng</a>
                    </div>

                    <div>
                        <span class="text-yellow-400 font-bold text-sm uppercase block mb-1 border-b border-gray-600 pb-1">NƒÉm 2025</span>
                        <a href="#season/mua-xuan-2025" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa Xu√¢n</a>
                        <a href="#season/mua-he-2025" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa H√®</a>
                        <a href="#season/mua-thu-2025" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa Thu</a>
                        <a href="#season/mua-dong-2025" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa ƒê√¥ng</a>
                    </div>

                    <div>
                        <span class="text-yellow-400 font-bold text-sm uppercase block mb-1 border-b border-gray-600 pb-1">NƒÉm 2024</span>
                        <a href="#season/mua-xuan-2024" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa Xu√¢n</a>
                        <a href="#season/mua-he-2024" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa H√®</a>
                        <a href="#season/mua-thu-2024" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa Thu</a>
                        <a href="#season/mua-dong-2024" class="hover:bg-gray-600 rounded-md block px-1 py-1">M√πa ƒê√¥ng</a>
                    </div>

                </div>
            </div>

            <a href="#library" class="nav-link text-gray-300 hover:text-yellow-400 text-sm font-medium uppercase tracking-wider transition-colors">Th∆∞ Vi·ªán</a>
            <a href="#schedule" class="nav-link text-gray-300 hover:text-yellow-400 text-sm font-medium uppercase tracking-wider transition-colors">L·ªãch Chi·∫øu</a>
        </div>
    </nav>
</div>

<div class="lg:hidden hidden" id="mobile-menu">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
        <a href="#home" class="mobile-nav-link text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Trang Ch·ªß</a>

        <div>
            <button class="mobile-nav-link mobile-dropdown-toggle w-full flex justify-between items-center text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-base font-medium" data-hash-group="#genre">
                <span>D·∫°ng Anime</span>
                <svg class="dropdown-icon w-5 h-5 transition-transform" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </button>
            <div class="mobile-dropdown-content pl-4 mt-1 space-y-1 hidden">
                <a href="#genre/tv-series" class="block text-gray-400 hover:bg-gray-600 hover:text-white px-3 py-2 rounded-md text-sm">TV/Series</a>
                <a href="#genre/movie-ova" class="block text-gray-400 hover:bg-gray-600 hover:text-white px-3 py-2 rounded-md text-sm">Movie/OVA</a>
                <a href="#genre/hh-trung-quoc" class="block text-gray-400 hover:bg-gray-600 hover:text-white px-3 py-2 rounded-md text-sm">HH Trung Qu·ªëc</a>
                <a href="#genre/anime-tron-bo" class="block text-gray-400 hover:bg-gray-600 hover:text-white px-3 py-2 rounded-md text-sm">Anime Tr·ªçn B·ªô</a>
            </div>
        </div>


        <div>
            <button class="mobile-nav-link mobile-dropdown-toggle w-full flex justify-between items-center text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-base font-medium" data-hash-group="#genre">
                <span>Th·ªÉ Lo·∫°i Chi Ti·∫øt</span>
                <svg class="dropdown-icon w-5 h-5 transition-transform" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </button>
            <div id="genre-mobile-list" class="pl-4 mt-1 hidden">

            </div>
        </div>

        <div>
            <button class="mobile-nav-link mobile-dropdown-toggle w-full flex justify-between items-center text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-base font-medium" data-hash-group="#season">
                <span>Season</span>
                <svg class="dropdown-icon w-5 h-5 transition-transform" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </button>
            <div class="mobile-dropdown-content pl-4 mt-1 hidden grid-cols-2">

                <div class="col-span-full pt-1 pb-1 border-b border-gray-700">
                   <span class="text-yellow-400 font-bold text-xs uppercase block">NƒÉm 2026</span>
                   <a href="#season/mua-xuan-2026" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">Xu√¢n 2026</a>
                   <a href="#season/mua-he-2026" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">H√® 2026</a>
                   <a href="#season/mua-thu-2026" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">Thu 2026</a>
                   <a href="#season/mua-dong-2026" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">ƒê√¥ng 2026</a>
               </div>
               <div class="col-span-full pt-1 pb-1 border-b border-gray-700">
                   <span class="text-yellow-400 font-bold text-xs uppercase block">NƒÉm 2025</span>
                   <a href="#season/mua-xuan-2025" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">Xu√¢n 2025</a>
                   <a href="#season/mua-he-2025" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">H√® 2025</a>
                   <a href="#season/mua-thu-2025" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">Thu 2025</a>
                   <a href="#season/mua-dong-2025" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">ƒê√¥ng 2025</a>
               </div>
               <div class="col-span-full pt-1 pb-1 border-b border-gray-700">
                   <span class="text-yellow-400 font-bold text-xs uppercase block">NƒÉm 2024</span>
                   <a href="#season/mua-xuan-2024" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">Xu√¢n 2024</a>
                   <a href="#season/mua-he-2024" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">H√® 2024</a>
                   <a href="#season/mua-thu-2024" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">Thu 2024</a>
                   <a href="#season/mua-dong-2024" class="block text-gray-400 hover:bg-gray-600 hover:text-white py-1 text-sm">ƒê√¥ng 2024</a>
               </div>
           </div>
       </div>

       <a href="#library" class="mobile-nav-link text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Th∆∞ Vi·ªán</a>
       <a href="#schedule" class="mobile-nav-link text-gray-300 hover:bg-gray-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">L·ªãch Chi·∫øu</a>
   </div>
   <div class="px-5 pb-3">
    <form id="search-form-mobile">
        <input id="search-input-mobile" type="text" placeholder="T√¨m ki·∫øm anime ng√†y T·∫øt..." class="bg-gray-700 text-white px-4 py-2 rounded-full w-full focus:outline-none focus:ring-2 focus:ring-red-600 focus:bg-gray-600 transition-all" autocomplete="off">
    </form>
</div>
<div id="auth-button-mobile" class="px-5 pb-5 pt-3 border-t border-gray-700">
    <a href="#login" class="block w-full text-center text-white bg-red-600 hover:bg-red-700 px-4 py-2 rounded-md text-sm font-medium transition-colors">ƒêƒÉng Nh·∫≠p</a>
</div>
</div>
</header>

<main id="app" class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12 min-h-screen">
    <div class="flex justify-center items-center h-[50vh]">
        <svg class="animate-spin h-10 w-10 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
    </div>
</main>

<!-- Footer -->
<footer class="relative bg-gray-800 pt-16 pb-8 border-t border-red-900 mt-12 overflow-hidden">
    <!-- Hi·ªáu ·ª©ng n·ªÅn trang tr√≠ T·∫øt -->
    <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-full h-1 bg-gradient-to-r from-transparent via-red-500 to-transparent opacity-50"></div>
    <div class="absolute -top-24 left-1/4 w-96 h-96 bg-red-600/10 rounded-full blur-3xl pointer-events-none"></div>
    <div class="absolute -bottom-24 right-1/4 w-96 h-96 bg-yellow-500/10 rounded-full blur-3xl pointer-events-none"></div>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">

        <!-- PH·∫¶N 1: LOGO & NEWSLETTER -->
        <div class="flex flex-col lg:flex-row justify-between items-center mb-12 gap-8">
            <!-- Logo -->
            <div class="flex items-center space-x-4 group cursor-pointer">
                <div class="relative">
                    <div class="absolute inset-0 bg-red-600 blur opacity-20 group-hover:opacity-40 transition-opacity duration-300 rounded-lg"></div>
                    <img src="https://uploads.onecompiler.io/43u4wb3ft/44d7fqhzv/tet2005_n.png" 
                    alt="FOXANIME Logo" 
                    class="w-16 h-16 object-contain rounded-lg shadow-xl relative z-10">
                </div>
                <div>
                    <span class="text-4xl font-extrabold text-white tracking-wide block leading-none">
                        FOX<span class="text-red-600">ANIME</span>
                    </span>
                    <span class="text-sm text-yellow-500 tracking-wider">Xu√¢n 2026 - Anime C·ª±c Ph√™</span>
                </div>
            </div>

            <!-- Newsletter -->
            <div class="w-full max-w-md bg-gray-700/30 p-1.5 rounded-full border border-gray-600 flex items-center focus-within:border-red-600/70 focus-within:ring-2 focus-within:ring-red-600/20 transition-all">
                <input type="email" placeholder="Nh·∫≠p email ƒë·ªÉ nh·∫≠n l√¨ x√¨ Anime..." class="bg-transparent border-none outline-none text-white px-4 py-2 w-full placeholder-gray-500 text-sm">
                <button class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full transition-colors duration-300 whitespace-nowrap text-sm">
                    ƒêƒÉng k√Ω
                </button>
            </div>
        </div>

        <!-- PH·∫¶N DONATE (TET EDITION) -->
        <div class="mb-12 p-6 rounded-2xl bg-gradient-to-r from-red-900/40 to-yellow-900/20 border border-yellow-600/30 relative overflow-hidden group">
            <div class="absolute inset-0 bg-[url('https://uploads.onecompiler.io/43u4wb3ft/44d7fqhzv/donatetet.jpg')] bg-cover bg-center opacity-10 group-hover:opacity-20 transition-opacity duration-500 mix-blend-overlay"></div>
            <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="flex items-center gap-4">
                    <img src="https://uploads.onecompiler.io/43u4wb3ft/44d7fqhzv/donatetet.jpg" 
                    alt="DONATE Logo" 
                    class="w-20 h-20 object-cover rounded-full shadow-lg ring-4 ring-yellow-500/50 animate-pulse">
                    <div>
                        <h3 class="text-2xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-red-400">L√å X√å CHO TEAM PH√ÅT TRI·ªÇN!</h3>
                        <p class="text-gray-300 text-sm mt-1">·ª¶ng h·ªô FoxAnime ƒë·ªÉ ch√∫ng m√¨nh c√≥ b√°nh ch∆∞ng ƒÉn T·∫øt nh√©! ‚ô°</p>
                    </div>
                </div>
                <a href="donate.html" class="px-8 py-3 bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-red-900 font-bold rounded-full shadow-lg shadow-yellow-600/30 transform hover:scale-105 transition-all duration-300 flex items-center gap-2 border border-yellow-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                    </svg>
                    L√¨ X√¨ Ngay
                </a>
            </div>
        </div>

        <!-- PH·∫¶N 2: C√ÅC NH√ìM C·ªòNG ƒê·ªíNG (GRID) -->
        <div class="mb-4 text-sm font-semibold text-gray-400 uppercase tracking-wider text-center lg:text-left">Tham Gia C·ªông ƒë·ªìng c·ªßa ch√∫ng t√¥i</div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-12">

            <!-- FoxAnime - Fandom -->
            <a href="https://www.facebook.com/share/g/17PEyLkhgp/" target="_blank" class="group flex items-center p-3 rounded-xl bg-gray-700/40 border border-gray-600/50 hover:bg-gray-700 hover:border-red-600/50 transition-all duration-300">
                <img src="https://th.bing.com/th/id/ODF.FFsV6sq1f2tH6MPAliUvzw?w=32&h=32&qlt=90&pcl=fffffa&o=6&pid=1.2" alt="Fandom" class="w-10 h-10 rounded-full mr-3 ring-2 ring-transparent group-hover:ring-red-600 transition-all">
                <div>
                    <div class="font-bold text-gray-200 group-hover:text-red-600 text-sm">FoxAnime Fandom</div>
                    <div class="text-xs text-gray-400">Group Facebook</div>
                </div>
            </a>

            <!-- FoxStudioLive -->
            <a href="https://youtube.com/@foxstudio7556?si=4-JPjZZcvCJrUdKX" target="_blank" class="group flex items-center p-3 rounded-xl bg-gray-700/40 border border-gray-600/50 hover:bg-gray-700 hover:border-red-600/50 transition-all duration-300">
                <img src="https://th.bing.com/th/id/ODF.MrzzDTMlZsq_k5DWWmv7Hw?w=32&h=32&qlt=90&pcl=fffffc&o=6&pid=1.2" alt="Live" class="w-10 h-10 rounded-full mr-3 ring-2 ring-transparent group-hover:ring-red-600 transition-all">
                <div>
                    <div class="font-bold text-gray-200 group-hover:text-red-600 text-sm">FoxStudioLive</div>
                    <div class="text-xs text-gray-400">K√™nh YouTube</div>
                </div>
            </a>

            <!-- Discord -->
            <a href="https://discord.gg/89UxfT4V" target="_blank" class="group flex items-center p-3 rounded-xl bg-gray-700/40 border border-gray-600/50 hover:bg-gray-700 hover:border-red-600/50 transition-all duration-300">
                <img src="https://th.bing.com/th/id/ODF.xXp47-dBXlzjKRnoX3v0kQ?w=32&h=32&qlt=90&pcl=fffffa&o=6&pid=1.2" alt="Discord" class="w-10 h-10 rounded-full mr-3 ring-2 ring-transparent group-hover:ring-red-600 transition-all">
                <div>
                    <div class="font-bold text-gray-200 group-hover:text-red-600 text-sm">Discord Server</div>
                    <div class="text-xs text-gray-400">Tham gia ngay!</div>
                </div>
            </a>

            <!-- Li√™n h·ªá -->
            <a href="mailto:haistrem6792@gmail.com" class="group flex items-center p-3 rounded-xl bg-gray-700/40 border border-gray-600/50 hover:bg-gray-700 hover:border-red-600/50 transition-all duration-300">
                <img src="https://th.bing.com/th/id/ODF.bm0RV3rptAC68RsyIbn_wQ?w=32&h=32&qlt=90&pcl=fffffc&o=6&pid=1.2" alt="Contact" class="w-10 h-10 rounded-full mr-3 ring-2 ring-transparent group-hover:ring-red-600 transition-all">
                <div>
                    <div class="font-bold text-gray-200 group-hover:text-red-600 text-sm">Li√™n h·ªá Qu·∫£ng C√°o</div>
                    <div class="text-xs text-gray-400 truncate w-32">foxstudio299@...</div>
                </div>
            </a>
        </div>

        <!-- PH·∫¶N 3: BOTTOM FOOTER (Socials & Copyright) -->
        <div class="border-t border-gray-700 pt-8 flex flex-col md:flex-row justify-between items-center gap-6">

            <!-- Social Icons (ƒê√£ thay b·∫±ng SVG tr·ª±c ti·∫øp ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªÉn th·ªã) -->
            <div class="flex space-x-4">
                <!-- Facebook -->
                <a href="#" class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-gray-400 hover:bg-blue-600 hover:text-white transition-all transform hover:-translate-y-1">
                    <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                </a>

                <!-- Instagram -->
                <a href="#" class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-gray-400 hover:bg-pink-500 hover:text-white transition-all transform hover:-translate-y-1">
                    <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM12 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                    </svg>
                </a>

                <!-- YouTube -->
                <a href="#" class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-gray-400 hover:bg-red-600 hover:text-white transition-all transform hover:-translate-y-1">
                    <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                    </svg>
                </a>

                <!-- TikTok -->
                <a href="#" class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center text-gray-400 hover:bg-black hover:text-white border border-transparent hover:border-gray-600 transition-all transform hover:-translate-y-1">
                    <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93v6.16c0 3.13-2.47 5.67-5.59 5.67h-.1c-2.91-.18-5.32-2.48-5.53-5.38-.2-2.73 1.69-5.18 4.34-5.63.13-.02.26-.03.39-.03v4.19c-.33 0-.66.07-.97.2-.67.29-1.07 1-1.07 1.77 0 1.09.89 1.98 1.98 1.98 1.09 0 1.98-.89 1.98-1.98v-15.03z"/>
                    </svg>
                </a>
            </div>

            <!-- Copyright & Legal -->
            <div class="text-center md:text-right">
                <div class="text-gray-500 text-sm mb-2">
                    <a href="#" class="hover:text-yellow-400 transition-colors">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a>
                    <span class="mx-2">‚Ä¢</span>
                    <a href="#" class="hover:text-yellow-400 transition-colors">Ch√≠nh s√°ch b·∫£o m·∫≠t</a>
                    <span class="mx-2">‚Ä¢</span>
                    <a href="#" class="hover:text-yellow-400 transition-colors">DMCA</a>
                </div>
                <p class="text-gray-400 text-sm">
                    &copy; 2026. B·∫£n quy·ªÅn thu·ªôc v·ªÅ <span class="text-yellow-500 font-bold">Foxstudio.co.Ltd</span>.
                </p>
            </div>
        </div>
    </div>

</footer>

</body>
</html>

