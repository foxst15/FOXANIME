<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOXANIME - C√¥ng C·ª• Bot Giao D·ªãch ƒê·ªôc L·∫≠p (Unlimited Data)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } 
            from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        
        
        import { getAuth, signInWithCustomToken, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, setPersistence, browserLocalPersistence, signOut, signInAnonymously } 
            from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
            
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, collection, query, getDocs, serverTimestamp, writeBatch, increment, orderBy, limit } 
            from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // C·∫§U H√åNH FIREBASE V√Ä BI·∫æN TO√ÄN C·ª§C
        const FIREBASE_DEFAULT_CONFIG = {"apiKey": "AIzaSyDvI4bfJXh08biyFORz6X2xwBc19TERWEc", "authDomain": "foxanime-e77d4.firebaseapp.com","projectId": "foxanime-e77d4", "storageBucket": "foxanime-e77d4.firebasestorage.app", "messagingSenderId": "1025177423292", "appId": "1:1025177423292:web:14c200fbc905e79b3c6fb9"};
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfigFromCanvas = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null; 
        const finalConfig = firebaseConfigFromCanvas?.projectId ? firebaseConfigFromCanvas : FIREBASE_DEFAULT_CONFIG;

        let app, db, auth;
        let userId = null;
        let dataCollectionPath = `artifacts/${appId}/public/data/movies`;
        let globalMovieCache = [];
        let isAuthInitialised = false;
        let botInterval = null; 
        let isBotRunning = false;
        
        // --- C·∫§U H√åNH T·ªêC ƒê·ªò (Theo y√™u c·∫ßu c·ªßa User) ---
        const BOT_INTERVAL_ANON = 1000; // 1 gi√¢y cho Kh√°ch/·∫®n danh (View + Like)
        const BOT_INTERVAL_AUTH = 5000; // 5 gi√¢y cho Google Auth (Full t∆∞∆°ng t√°c)
        let currentBotInterval = BOT_INTERVAL_AUTH;
        
        // === DANH S√ÅCH URL ·∫¢NH M·ªöI B·ªî SUNG T·ª™ NG∆Ø·ªúI D√ôNG ===
        // B√â L√îI ƒë√£ th√™m c√°c URL ·∫£nh ch·ªß nh√¢n cung c·∫•p v√†o ƒë√¢y!
        const HARDCODED_AVATAR_URLS = [
            "https://sf-static.upanhlaylink.com/img/image_202511268263c3032c13307cb4b7010e72173901.jpg",
            "https://sf-static.upanhlaylink.com/img/image_2025112609d48a2bd056211f996ba11b851e48cd.jpg",
            "https://sf-static.upanhlaylink.com/img/image_202511265fc3f7d92280e6c36e300e5aab9e5a8f.jpg",
            "https://sf-static.upanhlaylink.com/img/image_202511260570774cff31676089a23585a910a867.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126f31a0cd5089ea4ae58ed8f0276a701dd.jpg",
            "https://sf-static.upanhlaylink.com/img/image_202511262c9d103f46c61153315d749bc07045c8.jpg",
            "https://sf-static.upanhlaylink.com/img/image_202511265e90710536bdce6803faa5b8be450678.jpg",
            "https://sf-static.upanhlaylink.com/img/image_202511261a8c2760ac23c19804ce51c1e8aac6b1.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126334ba75477da6519efdd09255a3b7831.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126dd1d7051d38602df29f4679f6d946d94.jpg",
            "https://sf-static.upanhlaylink.com/img/image_2025112675df3643864c4c362817c6f752172159.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126ed38c6e7093e3c7ca4920fa03973df71.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126ff139db3b14e86a7432a5b9b793027da.jpg",
            "https://sf-static.upanhlaylink.com/img/image_2025112637819c4c735802060083a867524661eb.jpg",
            "https://sf-static.upanhlaylink.com/img/image_2025112694fef41cf94752736303cea244af34d3.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126e3649e2b2739ea70fac57bce63f6c1eb.jpg",
            "https://sf-static.upanhlaylink.com/img/image_202511268f6d1ca651128949f038e9c0e90b03fa.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126d5dc29a581439de4952b2272f8c2f351.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126c075f4ee293b6856462af307ba4640a7.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126f8426c69685d36141cba20cca7ea71e5.jpg",
            "https://sf-static.upanhlaylink.com/img/image_2025112610e8162e63024f927fd27129bdc83687.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126ea45718224ff171e27db1acf45b0b18c.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126cba59768f7764ec3a8f565387e3cbd03.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126f63017b3b86b98c0255b46174955e9d1.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126ec804aaba0ffb32e94b146d47cfd5262.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126797c8b05ed70c81223489471ef046f58.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126a58a866251aa307e31e28f2c7150897f.jpg",
            "https://sf-static.upanhlaylink.com/img/image_202511268bf2230e588d2f35d6465288a055da69.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126fa3d2929f94b2fe5d0191d84d55c868d.jpg",
            "https://sf-static.upanhlaylink.com/img/image_20251126a008e3c1d75d545edfcbd955d9d24335.jpg",
            "https://sf-static.upanhlaylink.com/img/image_2025112666d27190308b22ec0e1a4f0432ab9d3a.jpg"
        ];
        // Loai bo cac URL trung lap de tranh lap lai anh qua nhieu
        const UNIQUE_AVATAR_URLS = [...new Set(HARDCODED_AVATAR_URLS)];

        // --- DANH S√ÅCH TEENCODE GEN Z (H∆°n 50 t·ª´, format m·ªõi) ---
        // S·ª¨ D·ª§NG FORMAT M·ªöI THEO Y√äU C·∫¶U C·ª¶A NG∆Ø·ªúI D√ôNG
        const GENZ_TEENCODES = [
            // Thay th·∫ø ch√≠nh
            { src: /kh√¥ng/gi, dest: ["ko", "hong", "k", "khong", "kg", "h√¥ng"] },
            { src: /ƒë∆∞·ª£c/gi, dest: ["dc", "ƒëc", "duoc"] },
            { src: /g√¨/gi, dest: ["j", "gi", "g√¨ z", "j z", "z√¨"] }, 
            { src: /bi·∫øt/gi, dest: ["b√≠t", "bik", "biet", "bt"] }, 
            { src: /y√™u/gi, dest: ["iu", "yeu"] },
            { src: /qu√°/gi, dest: ["qa", "q√°", "v√£i", "vcl", "qua", "qu√° tr·ªùi"] }, 
            { src: /lu√¥n/gi, dest: ["lun", "luon"] },
            { src: /r·ªìi/gi, dest: ["r", "roi", "r√πi", "√≤y"] }, 
            { src: /nhi·ªÅu/gi, dest: ["nh√¨u", "nhieu", "nhiu"] },
            { src: /v·∫≠y/gi, dest: ["z", "vay", "zay", "d·∫°y", "v"] }, 
            { src: /b√¢y gi·ªù/gi, dest: ["h", "bi h", "bay h", "jo", "bh"] },
            { src: /c·ªßa/gi, dest: ["cua"] },
            { src: /m√¨nh/gi, dest: ["mik", "minh", "tui", "t"] },
            { src: /b·∫°n/gi, dest: ["bn", "ban", "b"] },
            { src: /th·ª±c s·ª±/gi, dest: ["that su", "thuc su", "real", "tht s·ª±"] }, 
            { src: /xem/gi, dest: ["coi", "xem", "x"] }, 
            { src: /t·∫≠p/gi, dest: ["ep", "tap"] },
            { src: /anh/gi, dest: ["a"] }, { src: /em/gi, dest: ["e"] }, { src: /ch·ªã/gi, dest: ["c", "cj"] },
            { src: /ng∆∞·ªùi y√™u/gi, dest: ["ny", "gau"] }, { src: /v·ª£/gi, dest: ["vk"] }, { src: /ch·ªìng/gi, dest: ["ck"] },
            { src: /nh∆∞ng/gi, dest: ["nma", "nhung", "nhg"] }, { src: /th√¥i/gi, dest: ["thui", "thoi", "thoy"] },
            { src: /m·ªõi/gi, dest: ["ms", "moi"] }, { src: /tr∆∞·ªõc/gi, dest: ["trc", "tr∆∞∆°c"] }, { src: /v·ªõi/gi, dest: ["vs", "voi"] },
            { src: /th·∫ø n√†o/gi, dest: ["ntn", "the nao"] }, { src: /c≈©ng/gi, dest: ["cx", "cug"] },
            
            // C√°c t·ª´ b·ªï sung theo y√™u c·∫ßu (ƒë√£ ƒë∆∞·ª£c l√†m gi√†u)
            { src: /oke/gi, dest: ["ok", "k", "oke", "oki"] }, { src: /t·∫°i sao/gi, dest: ["tsao", "tai sao"] },
            { src: /v√¨/gi, dest: ["vi"] }, { src: /l√†/gi, dest: ["la"] }, { src: /ng∆∞·ªùi/gi, dest: ["ng", "nguoi"] },
            { src: /n√†y/gi, dest: ["n√¨", "ne", "nay"] }, { src: /ƒëi/gi, dest: ["di", "ƒëii"] }, { src: /l√†m/gi, dest: ["lm", "lam"] },
            { src: /n√≥i/gi, dest: ["noi"] }, { src: /bu·ªìn/gi, dest: ["b√πn", "buon", "bu·ªìnn"] }, { src: /th√≠ch/gi, dest: ["thik", "thich"] },
            { src: /gh√™/gi, dest: ["ghe"] }, { src: /tr·ªùi ∆°i/gi, dest: ["tr oi", "troi oi", "omg"] },
            { src: /xin l·ªói/gi, dest: ["xl", "xin loi"] }, { src: /c·∫£m ∆°n/gi, dest: ["tks", "cam on", "thanks", "cmon"] },
            { src: /b√¨nh lu·∫≠n/gi, dest: ["cmt", "comment"] }, { src: /nh·∫Øn tin/gi, dest: ["ib", "inbox"] },
            { src: /facebook/gi, dest: ["fb"] }, { src: /ƒë·∫πp/gi, dest: ["dep", "ƒë·∫πpp"] }, { src: /h√¥m nay/gi, dest: ["hnay", "hom nay"] },
            { src: /th·∫ø/gi, dest: ["the", "th·∫ø"] }, { src: /ƒë√¢u/gi, dest: ["dau"] }, { src: /mu·ªën/gi, dest: ["mun"] },
            { src: /ng·ªß/gi, dest: ["ngu"] }, { src: /ch√∫c/gi, dest: ["chuc", "ch√∫c"] }, { src: /ph·∫£i/gi, dest: ["fai", "phai"] }, 
            { src: /ƒë√∫ng/gi, dest: ["dung"] }, { src: /r·∫•t/gi, dest: ["rat", "rt"] },
            
            // C√°c t·ª´ ng·ªØ √≠t d√πng teencode nh∆∞ng gi·ªØ l·∫°i ƒë·ªÉ thay ƒë·ªïi ki·ªÉu g√µ
            { src: /nh∆∞ v·∫≠y/gi, dest: ["nv"] }, { src: /b√¨nh th∆∞·ªùng/gi, dest: ["bth"] }, { src: /ch·ª©/gi, dest: ["ch·ªõ", "ch∆∞"] }, 
            { src: /th·∫≠t/gi, dest: ["tht"] }, { src: /c√≤n/gi, dest: ["cn"] }, { src: /t·ªët/gi, dest: ["tot"] }, 
            { src: /tuy·ªát/gi, dest: ["tuy·ªát"] }, { src: /xinh/gi, dest: ["xink"] }, { src: /h·∫°nh ph√∫c/gi, dest: ["hp"] },
            { src: /l·∫°i/gi, dest: ["lai"] }, { src: /ng∆∞·ªùi ta/gi, dest: ["nt"] }, { src: /y√™u r·ªìi/gi, dest: ["iu √≤y"] },
        ];
        const TEENCODE_RATE = 0.7; // TƒÉng t·ªâ l·ªá √°p d·ª•ng teencode l√™n 70%

        const applyTeencode = (text) => {
            let result = text;
            if (Math.random() < TEENCODE_RATE) {
                // √Åp d·ª•ng ng·∫´u nhi√™n 1 ƒë·∫øn 5 teencode ƒë·ªÉ l·ªùi n√≥i ƒë∆∞·ª£c "real" h∆°n
                const numToApply = Math.floor(Math.random() * 5) + 1; 
                // X√°o tr·ªôn danh s√°ch Teencode ƒë·ªÉ ch·ªçn ng·∫´u nhi√™n c√°c quy t·∫Øc ƒë·ªÉ √°p d·ª•ng
                const shuffledTeencodes = [...GENZ_TEENCODES].sort(() => 0.5 - Math.random());

                for (let i = 0; i < numToApply && i < shuffledTeencodes.length; i++) {
                    const rule = shuffledTeencodes[i];
                    // Ch·ªçn ng·∫´u nhi√™n 1 t·ª´ thay th·∫ø t·ª´ danh s√°ch dest
                    const replacement = rule.dest[Math.floor(Math.random() * rule.dest.length)];
                    // Th·ª±c hi·ªán thay th·∫ø
                    result = result.replace(rule.src, replacement);
                }
            }
            return result;
        };

        // --- H√ÄM R√öT G·ªåN T√äN PHIM (Tr√°nh l·ªô l√† Bot) ---
        const getShortTitle = (title) => {
            const parts = title.split(':');
            let cleanTitle = parts[parts.length - 1].trim(); 

            // Lo·∫°i b·ªè c√°c ph·∫ßn trong ngo·∫∑c ƒë∆°n/vu√¥ng (th∆∞·ªùng l√† season, part...)
            cleanTitle = cleanTitle.replace(/ *\([^)]*\) */g, "");
            cleanTitle = cleanTitle.replace(/ *\[[^\]]*\] */g, "");

            const words = cleanTitle.split(/\s+/).filter(w => w.length > 0);

            // N·∫øu t√™n phim ƒë√£ ng·∫Øn (<= 3 t·ª´) th√¨ gi·ªØ nguy√™n
            if (words.length <= 3) {
                return cleanTitle;
            }

            // R√∫t g·ªçn th√†nh 2-4 t·ª´ ƒë·∫ßu ti√™n
            const numWords = Math.floor(Math.random() * 3) + 2; 
            const shortTitle = words.slice(0, numWords).join(' ');

            // Th√™m "..." ƒë·ªÉ tr√¥ng t·ª± nhi√™n h∆°n
            if (shortTitle.length < cleanTitle.length && Math.random() < 0.7) {
                return shortTitle + '...';
            }

            return shortTitle;
        };
        
        // --- H·ªÜ TH·ªêNG T·∫†O T√äN "V≈® TR·ª§ WIBU" (MASSIVE & MIXED) ---
        const getBotDisplayName = () => {
            const prefixes = [
                "Ch√∫a T·ªÉ", "√îng Tr√πm", "S√°t Th·ªß", "Th√°nh", "Gi√°o Ch·ªß", "Huy·ªÅn Tho·∫°i", "K·∫ª H·ªßy Di·ªát", "Ng∆∞·ªùi Ch∆°i H·ªá", 
                "Tr√πm Cu·ªëi", "Vua L√¨ ƒê√≤n", "Thanh Ni√™n", "Hot Boy", "Hot Girl", "Idol T√≥p T√≥p", "Ph√°p S∆∞", 
                "Chuy√™n Gia", "T√†i ƒê·∫°t", "Boy", "Girl", "M√®o B√©o", "ƒê·ªá T·ª≠", "V·ª£ C·ªßa", "Ch·ªìng C·ªßa", "Fan C·ª©ng",
                "ƒê·∫°i Ca", "Ti·ªÉu Mu·ªôi", "C√¥ng Ch√∫a", "Ho√†ng T·ª≠", "So√°i Ca", "Th·∫ßn ƒê·ªìng", "K·∫ª Lang Thang", 
                "T·ªôc Tr∆∞·ªüng", "Th·ªß Lƒ©nh", "Chi·∫øn Th·∫ßn", "Ma V∆∞∆°ng", "ƒê·∫°i ƒê·∫ø", "Ng∆∞·ªùi Qua ƒê∆∞·ªùng", "Th√°m T·ª≠",
                "Ti√™n T√¥n", "Y·∫øu Sinh L√Ω", "C·ª•c N·ª£", "Ch·ªß H·ªôi", "Th·∫ßn B√†i", "ƒê·∫°o T·∫∑c", "Chi·∫øn T∆∞·ªõng", "M·∫´u H·∫≠u",
                "Ho√†ng H·∫≠u", "Th·ªï D√¢n", "Thanh Long", "Ph∆∞·ª£ng Ho√†ng", "V√¥ Danh", "Ti·ªÉu T·ª≠", "L√£o ƒê·∫°i",
                "ƒê·ªôc C√¥", "Thi√™n H·∫°", "ƒê·ªá Nh·∫•t", "Minh Ch·ªß", "Ti·ªÉu Ca", "V√µ Th√°nh", "Si√™u C·∫•p", "B·∫≠c Th·∫ßy",
                "Ph∆∞·ª£t Th·ªß", "C√¢y Kh·∫ø", "Ng∆∞·ªùi Y√™u C≈©", "L·ªõp Tr∆∞·ªüng", "B√† Tr√πm", "K·∫ª Thao T√∫ng", "Ng√¥i Sao",
                "Anh Hai", "Ch·ªã ƒê·∫°i", "T·ªïng Bi√™n T·∫≠p", "Admin", "Mod", "Chi·∫øn L∆∞·ª£c", "Th·ª£ SƒÉn", "Ph√° ƒê·∫£o", 
                "ƒê·∫°o Sƒ©", "Thi·∫øu Gia", "Th·∫ø T·ª≠", "C·ª• T·ªï", "Th√°nh N·ªØ", "N·ªØ Th·∫ßn", "Nam Th·∫ßn", "B√° Ch·ªß", "H·ªçc B√°",
                "H·ªçc Tra", "K·∫ª Si T√¨nh", "Ng∆∞·ªùi √Çm Ph·ªß", "Th√°nh Ph·ªìng", "Vua Tr√≤ Ch∆°i", "Th√°nh Gi√≥ng", "Ho√†ng ƒê·∫ø",
                "T∆∞·ªõng Qu√¢n", "Hi·ªáp Sƒ©", "L√£ng Kh√°ch", "Ph·∫£n Di·ªán", "Nh√¢n V·∫≠t Ch√≠nh", "Ng∆∞·ªùi Qua ƒê∆∞·ªùng A",
                "B√©", "Nh√≥c", "C·∫≠u", "C√¥", "M·ª£", "D√¨", "Ch√∫", "B√°c", "√îng", "B√†", "Th√≠m", "Cu", "H·∫Øn", "Y",
                "K·∫ª", "Ng∆∞·ªùi", "Th·∫±ng", "Con", "ƒê·ª©a", "V·ªã", "B·∫≠c", "ƒê·∫•ng", "Ch√∫a", "Th·∫ßn", "Ma", "Qu·ª∑",
                "Si√™u Nh√¢n", "Ng∆∞·ªùi D∆°i", "Ng∆∞·ªùi Nh·ªán", "Th·ª£ S·ª≠a ·ªêng N∆∞·ªõc", "H·∫£i T·∫∑c", "Ninja", "Th·∫ßn Ch·∫øt"
            ];
            
            const nouns = [
                "Wibu", "Gacha", "Simp", "Meme", "Waifu", "Drama", "Spoil", "Net", "Wifi", "Deadline", 
                "Yasuo", "Flop", "N·ª£ M√¥n", "M√¨ T√¥m", "Tr√† S·ªØa", "B√°nh Tr√°ng", "Tiktok", "Facebook", "Discord", 
                "Youtube", "Anime", "Manga", "Hent...", "Tu Ti√™n", "Xuy√™n Kh√¥ng", "B√°ch Khoa", "Saitama", "Levi", 
                "Goku", "Naruto", "Luffy", "Zoro", "Kirito", "Asuna", "Rem", "ZeroTwo", "Makima", "Anya",
                "Husky", "Mochi", "Cosplay", "Fandom", "OTP", "Check Var", "Keo Ly", "M√£i M·∫≠n", "X√† L∆°", 
                "Overthinking", "T·∫•u H√†i", "Thao T√∫ng", "ƒê∆°n Ph∆∞∆°ng", "H·∫Øc √Åm", "V√¥ C·ª±c", "√Ånh S√°ng", "H·∫Øc H√≥a", 
                "S∆∞ Ph·ª•", "V·∫°n Ki·∫øm", "C·∫©m Nang", "L∆∞∆°ng Th√°ng", "Tr∆∞·ªüng Khoa", "ƒê·ªì √Ån", "T·∫•m Chi·∫øu", 
                "Ng√°o Ng∆°", "B√© Ba", "Ti·ªÉu Tam", "H·ªçc Sinh", "Gi√°o Vi√™n", "ƒê·∫ßu B·∫øp", "S√°t Th·ªß", "Ti·ªÅn T·ªá",
                "Th·ªß Kho", "T∆∞ B·∫£n", "ƒê·∫ø V∆∞∆°ng", "C·∫©u L∆∞∆°ng", "ƒê·ªôc Gi·∫£", "Kh√°n Gi·∫£", "Phim R√°c",
                "Trai Th·∫≥ng", "G√°i Xinh", "ƒê·∫ßu G·∫•u", "L√≤ Luy·ªán", "C√† Kh·ªãa", "C∆°m Tr√≥", "V∆∞∆°ng Gi·∫£", "ƒê·∫°i Th·∫ßn",
                "K·ª≥ L√¢n", "R·ªìng", "Ph∆∞·ª£ng", "Ng√¢n H√†", "V≈© Tr·ª•", "Qu·ªπ ƒê·∫°o", "B√£o", "S·∫•m S√©t", "Kim C∆∞∆°ng",
                "Ph·ªü", "B√≥ng ƒê√°", "Crypto", "C·ªông ƒê·ªìng", "Game", "L√¥ ƒê·ªÅ", "Ch·ª©ng Kho√°n", "√î T√¥", "M√°y Bay",
                "Nh√¢n V·∫≠t Ph·ª•", "ƒê·∫°o C·ª•", "M√†u S·∫Øc", "Ph·∫£n Di·ªán", "Ph√¢n T√≠ch", "ƒêam M√™", "H·∫£i Quay Xe",
                "D√¢n T·ªï", "Racing Boy", "Sadboy", "Goodboy", "Badboy", "Ch√∫a H·ªÅ", "Th√°nh M√µm", "Vua L∆∞·ªùi",
                "H·ªçc D·ªët", "Nh√† Gi√†u", "ƒê·∫°i Gia", "Thi·∫øu Gia", "Ti·ªÉu Th∆∞", "C√¥ng T·ª≠", "Th∆∞ Sinh", "S√°t G√°i",
                "FA", "·∫æ B·ªÅn V·ªØng", "S·ª£ V·ª£", "N·ªÉ V·ª£", "S·ª£ Ma", "Y·∫øu Tim", "M√™ G√°i", "M√™ Trai",
                "Eren", "Mikasa", "Armin", "Levi", "Erwin", "Hange", "Reiner", "Zeke", "Annie", "Historia",
                "Light", "L", "Ryuk", "Misa", "Near", "Mello", "Rem", "Soichiro", "Matsuda", "Aizawa",
                "Gojo", "Itadori", "Megumi", "Nobara", "Sukuna", "Maki", "Toge", "Panda", "Nanami", "Mahito",
                "Denji", "Power", "Makima", "Aki", "Pochita", "Kobeni", "Himeno", "Kishibe", "Reze", "Quanxi",
                "Anya", "Loid", "Yor", "Bond", "Damian", "Becky", "Yuri", "Fiona", "Franky", "Sylvia",
                "Wibu", "Meme", "Fan", "Otaku", "Simp", "Waifu", "Husbando", "Senpai", "Kouhai", "Sensei",
                "Admin", "Mod", "Vip", "Pro", "Noob", "Gamer", "Streamer", "Youtuber", "Tiktoker", "Facebook",
                "Anime", "Manga", "LightNovel", "Game", "Music", "Movie", "Cosplay", "Figure", "Art", "Design"
            ];
            
            const suffixes = [
                "Gaming", "TV", "Official", "Vlog", "V√≠p Pro", "No1", "99", "2k", "Chan", "Sama", "Kun", 
                "Senpai", "D·∫°o", "Ch√∫a", "Slayer", "Master", "Legend", "God", "King", "Fa", "C√¥ ƒê∆°n", 
                "L·∫°nh L√πng", "H√†i H∆∞·ªõc", "Vui T√≠nh", "Y√™u ƒê·ªùi", "Tr·∫ßm C·∫£m", "Suy", "Keo L·ª≥",
                "X·ªâu", "Xinh", "Xinh ƒê·∫πp", "Ngoan", "Nh√¢y", "B·ª±a", "Th·∫≥ng Th·∫Øn", "Nh·∫•t", "Nh√¨", "Tam", 
                "X·∫°o L...", "T·ªânh", "·ªú M√¢y Zing", "G√∫t Ch√≥p", "G·∫Øt", "Kh√©t", "Ch·∫•t", "Real", "Fake", 
                "Th√¢m Ni√™n", "H·ª•t H·∫´ng", "S·∫ßu", "Th√†nh C√¥ng", "Th·∫•t B·∫°i", "Ch√≠nh Hi·ªáu",
                "Tu·ªïi", "ƒê·ªùi", "Ngh√®o", "Gi√†u", "Qu√°", "M·ªõi", "C≈©", "ƒê·∫πp Trai", "Xinh G√°i", "H·∫øt",
                "Ch·ªù", "Th·ªü", "Lu√¥n", "ƒê·∫•y", "Nh√≥c", "T√≠", "M·∫≠p", "G·∫ßy", "T√°o B·∫°o", "Th·∫ßn Tho·∫°i",
                "Huy·ªÅn ·∫¢o", "M·ªông M∆°", "ƒê·∫≥ng C·∫•p", "B√¨nh D√¢n", "Ph√° S·∫£n", "Th·∫ßn T√†i", "D≈©ng C·∫£m", "G√≥c Ph·ªë",
                "Online", "Mobile", "PC", "Console", "Max Ping", "Lag", "Disconnect", "AFK", "Feed", "Carry",
                "Tanker", "Support", "Mid", "Top", "Ad", "R·ª´ng", "Gank", "Farm", "Ks",
                "Solo", "Squad", "Team", "Clan", "Guild", "Party", "Room", "Lobby", "Rank", "Bot",
                "Hack", "Cheat", "Mod", "Bug", "Glitch", "Lag", "Ping", "FPS", "Drop", "Crash",
                "Win", "Lose", "Draw", "GG", "WP", "EZ", "Noob", "Pro", "Hacker", "Cheater",
                "S1", "S2", "S3", "V1", "V2", "V3", "X", "Y", "Z", "Alpha", "Beta", "Omega"
            ];

            // T√™n ng∆∞·ªùi Vi·ªát b√¨nh th∆∞·ªùng (M·ªü r·ªông th√™m)
            const normalNames = [
                "H·∫£i", "My", "Tu·∫•n", "Linh", "H√πng", "Trang", "Nam", "Huy·ªÅn", "Long", "Nga", "ƒê·∫°t", "V√¢n",
                "T√¢m", "Th·∫£o", "H∆∞∆°ng", "Lan", "Mai", "C√∫c", "Tr√∫c", "ƒê√†o", "M·∫≠n", "L√™", "T√°o", "·ªîi"
            ];

            const type = Math.random();
            let name;
            
            if (type < 0.3) { 
                // 30% T√™n Th∆∞·ªùng + H·∫≠u T·ªë
                const baseName = normalNames[Math.floor(Math.random() * normalNames.length)];
                const firstName = baseName.split(" ").pop(); 
                const cleanName = firstName.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/ƒë/g, 'd').replace(/ƒê/g, 'D');
                const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
                
                if (Math.random() < 0.5) {
                     name = cleanName + suffix.toLowerCase(); 
                } else {
                     name = `${cleanName} ${suffix}`; 
                }

            } else if (type < 0.5) { 
                 // 20% Danh hi·ªáu + Danh t·ª´
                name = `${prefixes[Math.floor(Math.random() * prefixes.length)]} ${nouns[Math.floor(Math.random() * nouns.length)]}`;
            } else if (type < 0.8) {
                 // 30% Danh t·ª´ + H·∫≠u t·ªë
                name = `${nouns[Math.floor(Math.random() * nouns.length)]} ${suffixes[Math.floor(Math.random() * suffixes.length)]}`;
            } else {
                 // 20% Full Option
                name = `${prefixes[Math.floor(Math.random() * prefixes.length)]} ${nouns[Math.floor(Math.random() * nouns.length)]} ${suffixes[Math.floor(Math.random() * suffixes.length)]}`;
            }
            
            if (!name.includes(" ")) {
                 return name.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/ƒë/g, 'd').replace(/ƒê/g, 'D').replace(/[^a-zA-Z0-9]/g, "");
            }
            
            return name; 
        };

        // --- H·ªÜ TH·ªêNG AVATAR "V≈® TR·ª§" (T·ª∞ ƒê·ªòNG T·∫†O + KHO ·∫¢NH KH·ªîNG L·ªí) ---
        const getBotAvatar = (botName) => {
            const rand = Math.random();
            
            // 1. T·ª∑ l·ªá d√πng Avatar t·ª´ URL Hardcoded (60%) - TƒÉng c∆∞·ªùng s·ª± "th·∫≠t"
            if (rand < 0.6) {
                 return UNIQUE_AVATAR_URLS[Math.floor(Math.random() * UNIQUE_AVATAR_URLS.length)];
            }

            // 2. T·ª∑ l·ªá d√πng Avatar Art x·ªãn (DiceBear - Lorelei/Notionists) (20%)
            if (rand < 0.8) {
                const style = Math.random() < 0.5 ? 'lorelei' : 'notionists';
                return `https://api.dicebear.com/9.x/${style}/png?seed=${encodeURIComponent(botName)}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffdfbf,ffd5dc`;
            }

            // 3. T·ª∑ l·ªá d√πng Avatar "Ng∆∞·ªùi d√πng m·ªõi/Ch·ªØ c√°i" (10%) - R·∫•t ph·ªï bi·∫øn ·ªü web phim
            if (rand < 0.9) {
                 return `https://ui-avatars.com/api/?name=${encodeURIComponent(botName)}&background=random&color=fff&size=128`;
            }

            // 4. T·ª∑ l·ªá d√πng Avatar "Fan C·ª©ng" (Logo/Nh√¢n v·∫≠t - Placeholder) (10%)
            const keywords = [
                "Luffy", "Goku", "Naruto", "Tanjiro", "Deku", "Saitama", "Rimuru", "Eren", "Light", "Gojo",
                "Anya", "Wibu", "Meme", "Fan", "Otaku", "Admin", "Mod", "Vip", "Pro", "Anime"
            ];
            const keyword = keywords[Math.floor(Math.random() * keywords.length)];
            // T·∫°o m√†u ng·∫´u nhi√™n
            const bg = Math.floor(Math.random()*16777215).toString(16);
            const fg = "ffffff";
            return `https://placehold.co/100x100/${bg}/${fg}/png?text=${keyword}`;
        };

        const getEl = (selector) => document.querySelector(selector);
        const log = (message, type = 'info') => {
            const logsEl = getEl('#bot-logs');
            if (logsEl) {
                const color = type === 'error' ? 'text-red-400' : (type === 'success' ? 'text-lime-400' : 'text-gray-400');
                const time = new Date().toLocaleTimeString('vi-VN');
                logsEl.innerHTML = `<div class="p-2 border-b border-gray-700 ${color} flex items-start space-x-2">
                    <span>${time} | [${type.toUpperCase()}]</span>
                    <span>${message}</span>
                </div>` + logsEl.innerHTML;
            }
        };

        const isGoogleAuth = (user) => user && user.providerData.some(p => p.providerId === 'google.com');

        // Utility: T√≠nh ƒëi·ªÉm trung b√¨nh
        const calculatePerceivedScore = (movie) => {
            const total = movie.reviewTotal || 0;
            const count = movie.reviewCount || 0;
            if (count === 0) return 4.0; 
            return total / count;
        };
        
        // Utility: L·∫•y Comment cu·ªëi c√πng
        const fetchLastComment = async (movieId) => {
            try {
                const commentsColRef = collection(db, dataCollectionPath, movieId, 'comments');
                const q = query(commentsColRef, orderBy('createdAt', 'desc'), limit(1));
                const snapshot = await getDocs(q);
                if (!snapshot.empty && (Date.now() - snapshot.docs[0].data().createdAt.toDate().getTime() < 600000)) { 
                    return { id: snapshot.docs[0].id, ...snapshot.docs[0].data() };
                }
            } catch (e) {}
            return null;
        };

        // === KHO B√åNH LU·∫¨N KH·ªîNG L·ªí (MASSIVE & TRENDY) ===
        // L∆∞u √Ω: ƒê√£ thay th·∫ø {title} b·∫±ng {shortTitle} ƒë·ªÉ d√πng t√™n phim r√∫t g·ªçn
        const COMMENT_POOLS = {
            ACTION: [ 
                `Combat t·∫≠p n√†y c·ªßa {shortTitle} ch√°y kh√©t l·∫πt lu√¥n üî•`, `Animation m∆∞·ª£t nh∆∞ sunsilk, xem ƒë√£ con m·∫Øt!`,
                `Main b√° ƒë·∫°o qu√°, c√¢n c·∫£ map lu√¥n r·ªìi!`, `ƒêo·∫°n ƒë√°nh nhau cu·ªëi phim ƒë√∫ng ƒë·ªânh cao, out tr√¨nh!`,
                `S·ª©c m·∫°nh t√¨nh b·∫°n l·∫°i chi·∫øn th·∫Øng trong {shortTitle} √†? üòÇ`, `H√≥ng main show skill m·ªõi trong {shortTitle} qu√°!`,
                `Studio ƒë·∫ßu t∆∞ {shortTitle} √°c th·∫≠t, hi·ªáu ·ª©ng ch√°y m√°y.`, `Nh·∫°c n·ªÅn l√∫c combat n·ªïi da g√† lu√¥n.`,
                `{shortTitle} ƒë√∫ng l√† si√™u ph·∫©m h√†nh ƒë·ªông m√πa n√†y.`, `Coi {shortTitle} m√† tim ƒë·∫≠p b·ªãch b·ªãch, h·ªìi h·ªôp x·ªâu.`,
                `Nh√¨n main m√∫a ki·∫øm trong {shortTitle} m√† s∆∞·ªõng r∆°n ng∆∞·ªùi.`, `Map {shortTitle} r·ªông th·∫ø n√†y ƒë√°nh nhau m·ªõi ƒë√£.`,
                `ƒê√°nh ƒë·∫•m th·∫ø n√†y m·ªõi l√† anime ch·ª©! 10 ƒëi·ªÉm!`, `Ch√°y qu√° anh em ∆°i! Xem m√† mu·ªën lao v√†o m√†n h√¨nh.`,
                `Main gi·∫•u ngh·ªÅ k·ªπ qu√°, bung l·ª•a c√°i l√† h·∫øt n∆∞·ªõc ch·∫•m.`, `Phim n√†y ƒë√°nh nhau √≠t n√≥i ƒë·∫°o l√Ω, ∆∞ng c√°i b·ª•ng.`,
                `Skill ƒë·∫πp, √¢m thanh ch·∫•t, {shortTitle} ƒë√∫ng l√† bom t·∫•n.`, `ƒêo·∫°n n√†y hype v√£i, xem ƒëi xem l·∫°i ch·ª•c l·∫ßn.`,
                `Th·∫±ng ph·∫£n di·ªán trong {shortTitle} c≈©ng ng·∫ßu kh√¥ng k√©m main.`, `Coi combat m√† n√≠n th·ªü, k·ªãch t√≠nh v√£i.`,
                `T·∫≠p n√†y ƒë·ªët kinh ph√≠ √°c, studio ch·∫Øc b√°n th·∫≠n l√†m phim.`, `Chuy·ªÉn c·∫£nh m∆∞·ª£t h∆°n c·∫£ Crush t·ª´ ch·ªëi t√¥i.`,
                `M·ªôt ch·ªØ th√¥i: PH√ä!`, `Xem xong mu·ªën ƒëi h·ªçc v√µ lu√¥n :)))`, `Coi m√† mu·ªën g√£y c√°i gh·∫ø v√¨ qu√° s∆∞·ªõng!`,
                `M√†n solo n√†y ƒëi v√†o l·ªãch s·ª≠ anime r·ªìi!`, `Top 1 server l√† ƒë√¢y ch·ª© ƒë√¢u!`,
                `Nh√¨n thanh m√°u t·ª•t kh√¥ng phanh m√† s∆∞·ªõng.`, `Combo ƒë·∫πp m·∫Øt qu√°, h·ªçc h·ªèi ngay!`,
                `ƒê√∫ng l√† si√™u ph·∫©m shounen, kh√¥ng u·ªïng c√¥ng c√†y.`, `Main ng·∫ßu l√≤i, v·ª£ tui ∆°i!`,
                `C·∫£nh n√†y ph·∫£i tua l·∫°i 10 l·∫ßn m·ªõi ƒë√£ n∆∞.`, `ƒê·ªânh cao c·ªßa ngh·ªá thu·∫≠t ƒë√°nh ƒë·∫•m.`,
                `Hi·ªáu ·ª©ng ch√°y n·ªï l√†m tui ch√≥i c·∫£ m·∫Øt.`, `√Çm thanh s·ªëng ƒë·ªông nh∆∞ ƒëang ·ªü chi·∫øn tr∆∞·ªùng.`
            ],
            ROMANCE: [ 
                `C∆°m tr√≥ ng·∫≠p m·ªìm, F.A nh∆∞ tui t·ª©c √°! üê∂`, `Ng·ªçt s√¢u rƒÉng lu√¥n r·ªìi, c·ª©u tui v·ªõi!`,
                `C·∫∑p ƒë√¥i ch√≠nh trong {shortTitle} d·ªÖ th∆∞∆°ng x·ªâu up x·ªâu down.`, `Thuy·ªÅn n√†y bao real, kh√¥ng l√™n thuy·ªÅn l√† ph√≠!`,
                `Xem {shortTitle} m√† qu·∫Øn qu√©o h·∫øt c·∫£ ng∆∞·ªùi.`, `ƒê·ª´ng drama n·ªØa m√†, cho h·ªç h·∫°nh ph√∫c ƒëi! üò≠`,
                `T√¨nh y√™u trong {shortTitle} ƒë·∫πp qu√°, ∆∞·ªõc g√¨ m√¨nh ƒë∆∞·ª£c nh∆∞ v·∫≠y.`, `Nh√¨n √°nh m·∫Øt nam ch√≠nh nh√¨n n·ªØ ch√≠nh k√¨a, soft x·ªâu!`,
                `K·∫øt th√∫c {shortTitle} m√† kh√¥ng HE l√† tui ƒë·ªët nh√† t√°c gi·∫£ √°!`, `Chu·∫©n b·ªã khƒÉn gi·∫•y tr∆∞·ªõc khi xem {shortTitle} nha m·∫•y b√†.`,
                `{shortTitle} t·∫≠p n√†y l√†m tui nh·ªõ ng∆∞·ªùi y√™u c≈© qu√°...`, `Tr·ªùi ∆°i chemistry c·ªßa 2 ƒë·ª©a trong {shortTitle} ƒë·ªânh v√£i.`,
                `Tui mu·ªën c√≥ ng∆∞·ªùi y√™u ngay l·∫≠p t·ª©c sau khi xem {shortTitle}!`, `Ng·ªçt nh∆∞ ƒë∆∞·ªùng ph√®n, xem m√† c∆∞·ªùi t·ªßm t·ªâm.`,
                `C·∫©u l∆∞∆°ng ch·∫•t l∆∞·ª£ng cao, ƒÉn m√£i kh√¥ng ch√°n.`, `Nam ph·ª• trong {shortTitle} c≈©ng ngon trai, ti·∫øc l√† friendzone.`,
                `T√¨nh ti·∫øt nh·∫π nh√†ng, ch·ªØa l√†nh t√¢m h·ªìn F.A.`, `Xem xong mu·ªën y√™u ƒë∆∞∆°ng li·ªÅn, phim h·∫°i ng∆∞·ªùi qu√° :))`,
                `C·ª©u t√¥i, t√¥i ƒëang ch√¨m trong s·ª± ng·ªçt ng√†o n√†y.`, `M√°u m≈©i t√¥i tu√¥n r∆°i v√¨ s·ª± cute n√†y.`,
                `H√¥n nhau ƒëi, h√¥n nhau ƒëi!`, `T·ªè t√¨nh ƒëi tr·ªùi ∆°i, s·ªët ru·ªôt qu√°!`,
                `Sao m√† c·ª© v·ªùn nhau m√£i th·∫ø n√†y, tui ƒëau tim qu√°.`, `Th√≠ch th√¨ nh√≠ch ƒëi, ng·∫°i ng√πng g√¨ n·ªØa!`,
                `OTP n√†y m√† kh√¥ng real tui ƒëi ƒë·∫ßu xu·ªëng ƒë·∫•t.`, `D·ªÖ th∆∞∆°ng mu·ªën x·ªâu, tim tui tan ch·∫£y r·ªìi.`,
                `∆Ø·ªõc g√¨ c√≥ anh ng∆∞·ªùi y√™u nh∆∞ nam ch√≠nh.`, `N·ªØ ch√≠nh xinh qu√°, mu·ªën b·∫Øt v·ªÅ nu√¥i.`,
                `Phim n√†y kh√¥ng d√†nh cho ng∆∞·ªùi c√¥ ƒë∆°n.`, `Tui ƒëang GATO v·ªõi nh√¢n v·∫≠t ch√≠nh ƒë√¢y n√†y.`
            ],
            ISEKAI: [ 
                `L·∫°i l√† xe t·∫£i-kun l√†m vi·ªác nƒÉng su·∫•t trong {shortTitle} :))`, `Main {shortTitle} hack game √†? Sao m·∫°nh v√¥ l√Ω v·∫≠y?`,
                `∆Ø·ªõc g√¨ ƒë∆∞·ª£c isekai v√†o th·∫ø gi·ªõi {shortTitle} l√†m slime c≈©ng ch·ªãu.`, `Harem c·ªßa main trong {shortTitle} ch·∫•t l∆∞·ª£ng qu√°!`,
                `Th·∫ø gi·ªõi trong {shortTitle} x√¢y d·ª±ng ƒë·ªânh gh√™.`, `Skill c·ªßa main ·∫£o ma canada qu√°.`,
                `Ma v∆∞∆°ng trong {shortTitle} nh√¨n hi·ªÅn kh√¥ v·∫≠y?`, `B·ªô {shortTitle} n√†y ƒë√∫ng chu·∫©n power fantasy, xem gi·∫£i tr√≠ t·ªët.`,
                `Chuy·ªÉn sinh th√†nh c√°i g√¨ kh√¥ng th√†nh, l·∫°i th√†nh... trong {shortTitle} üòÇ`, `Ti·ªÅn t·ªá trong {shortTitle} l·∫°m ph√°t qu√° :))`,
                `Main b√° ƒë·∫°o tr√™n t·ª´ng h·∫°t g·∫°o, xem s∆∞·ªõng m·∫Øt.`, `Th·∫ø gi·ªõi game trong {shortTitle} chi ti·∫øt ph·∫øt.`,
                `Isekai gi·ªù b√£o h√≤a r·ªìi m√† {shortTitle} v·∫´n cu·ªën l·∫° th∆∞·ªùng.`, `Main kh√¥ng c·∫ßn c√†y cu·ªëc c≈©ng m·∫°nh, ∆∞·ªõc g√¨ m√¨nh ƒë∆∞·ª£c v·∫≠y.`,
                `M·∫•y em elf trong {shortTitle} xinh x·ªâu.`, `H√≥ng main x√¢y d·ª±ng v∆∞∆°ng qu·ªëc ri√™ng.`,
                `Truck-kun is MVP.`, `Cu·ªôc s·ªëng m·ªõi ·ªü d·ªã gi·ªõi s∆∞·ªõng th·∫ø n√†y th√¨ ai ch·∫£ mu·ªën.`,
                `Main n√†y s·ªë h∆∞·ªüng v√£i, to√†n g√°i xinh v√¢y quanh.`, `Skill n√†y b√° ƒë·∫°o qu√°, c√¢n c·∫£ server.`,
                `Th·∫ø gi·ªõi n√†y th√∫ v·ªã ph·∫øt, mu·ªën v√†o ch∆°i th·ª≠.`, `H·ªá th·ªëng game trong phim l√†m tui nh·ªõ ƒë·∫øn...`,
                `ƒê√∫ng ch·∫•t isekai m√¨ ƒÉn li·ªÅn, nh∆∞ng m√† ngon.`, `Xem gi·∫£i tr√≠, kh√¥ng c·∫ßn n√£o nhi·ªÅu.`,
                `Main gi·∫•u ngh·ªÅ, gi·∫£ heo ƒÉn th·ªãt h·ªï kinh v√£i.`, `Khi n√†o main m·ªõi l·ªô s·ª©c m·∫°nh th·∫≠t ƒë√¢y?`
            ],
            HORROR: [ 
                `Xem {shortTitle} l√∫c n·ª≠a ƒë√™m ƒë√∫ng l√† sai l·∫ßm, s·ª£ v√£i linh h·ªìn üò±`, `Plot twist c·ªßa {shortTitle} l√†m tui tr·∫ßm c·∫£m lu√¥n.`,
                `Kh√¥ng kh√≠ trong {shortTitle} u √°m gh√™, l·∫°nh s·ªëng l∆∞ng.`, `C√°i k·∫øt c·ªßa {shortTitle} dark qu√°, √°m ·∫£nh th·ª±c s·ª±.`,
                `Ai y·∫øu tim ƒë·ª´ng xem {shortTitle} nha, c·∫£nh b√°o tr∆∞·ªõc!`, `Nh·∫°c phim {shortTitle} nghe r·ª£n ng∆∞·ªùi.`,
                `T√°c gi·∫£ {shortTitle} n√£o to th·∫≠t, hack n√£o ng∆∞·ªùi xem.`, `Thao t√∫ng t√¢m l√Ω c·ª±c m·∫°nh, {shortTitle} qu√° ƒë·ªânh.`,
                `M√°u me be b√©t, {shortTitle} kh√¥ng d√†nh cho tr·∫ª em ƒë√¢u.`, `T·ªëi nay m·∫•t ng·ªß v√¨ {shortTitle} r·ªìi...`,
                `Jump scare t·∫≠p n√†y l√†m tui r·ªõt ƒëi·ªán tho·∫°i.`, `C·ªët truy·ªán {shortTitle} b·ªánh ho·∫°n th·∫≠t s·ª±, nh∆∞ng m√† cu·ªën.`,
                `Nh√¨n con qu√°i trong {shortTitle} m√† n·ªïi da g√†.`, `Phim n√†y xem xong kh√¥ng d√°m ƒëi v·ªá sinh m·ªôt m√¨nh.`,
                `ƒêang xem th√¨ con m√®o nh·∫£y l√™n, x√©m x·ªâu.`, `C·∫£m gi√°c nh∆∞ c√≥ ai ƒëang nh√¨n m√¨nh khi xem {shortTitle}.`,
                `T·ªüm l·ª£m nh∆∞ng m√† hay.`, `T√¢m l√Ω nh√¢n v·∫≠t m√©o m√≥ v√£i.`,
                `C√°i k·∫øt l√†m tui ƒë·ª©ng h√¨nh 5 gi√¢y.`, `Kh√¥ng d√°m t·∫Øt ƒë√®n ƒëi ng·ªß lu√¥n.`,
                `Phim n√†y √°m ·∫£nh qu√°, ch·∫Øc ph·∫£i xem phim h√†i ƒë·ªÉ t·∫©y n√£o.`, `Gh√™ r·ª£n nh∆∞ng kh√¥ng th·ªÉ ng·ª´ng xem.`,
                `T√°c gi·∫£ ch·∫Øc c√≥ v·∫•n ƒë·ªÅ t√¢m l√Ω m·ªõi nghƒ© ra ƒë∆∞·ª£c c√°i n√†y.`, `S·ª£ qu√° m√† v·∫´n mu·ªën xem ti·∫øp.`
            ],
            COMEDY: [ 
                `C∆∞·ªùi ·ªâa v·ªõi {shortTitle}, t·∫•u h√†i c·ª±c m·∫°nh üòÇ`, `ƒêang ƒÉn c∆°m xem {shortTitle} m√† s·∫∑c m·∫•y l·∫ßn.`,
                `Th√°nh meme m·ªõi l√† ƒë√¢y ch·ª© ƒë√¢u!`, `Xem {shortTitle} x·∫£ stress hi·ªáu qu·∫£ l·∫Øm nha.`,
                `ƒê·ªô l·∫ßy c·ªßa main trong {shortTitle} l√† v√¥ ƒë·ªëi.`, `C∆∞·ªùi mu·ªën n·ªôi th∆∞∆°ng v·ªõi t·∫≠p n√†y c·ªßa {shortTitle}.`,
                `Nh√¢n v·∫≠t ph·ª• trong {shortTitle} c√≤n m·∫∑n h∆°n c·∫£ main.`, `B·ªô n√†y anti-stress c·ª±c m·∫°nh, khuy·∫øn kh√≠ch xem.`,
                `M·∫∑t √¥ng main l√∫c ƒë√≥ nh√¨n b·ª±a v√£i ch∆∞·ªüng.`, `H√†i ·∫ª, t√°c gi·∫£ ch·∫Øc c≈©ng h√∫t c·∫ßn m·ªõi v·∫Ω ƒë∆∞·ª£c nh∆∞ n√†y.`,
                `C∆∞·ªùi kh√¥ng nh·∫∑t ƒë∆∞·ª£c m·ªìm lu√¥n √° tr·ªùi.`, `Phim g√¨ m√† l·∫ßy l·ªôi d·ªØ th·∫ßn.`,
                `C∆∞·ªùi ƒëau c·∫£ b·ª•ng, ai ƒë·ªÅn cho tui ƒëi.`, `Xem phim m√† c∆∞·ªùi nh∆∞ ƒëi√™n, ng∆∞·ªùi nh√† t∆∞·ªüng b·ªã g√¨.`
            ],
            GENERAL: [ // Chung chung, Meme, Trend (R·∫§T NHI·ªÄU)
                `{shortTitle} m√£i ƒë·ªânh! M√£i m·∫≠n xo√†i c√≥c ·ªïi!`, `Keo l·ª≥ t√°i ch√¢u lu√¥n √°!`,
                `Xem {shortTitle} xong tui b·ªã "suy" lu√¥n r·ªìi... ü•Ä`, `Flex nh·∫π c√°i acc ƒë√£ c√†y {shortTitle} 3 l·∫ßn üòé`,
                `Ai r·ªìi c≈©ng ph·∫£i xem {shortTitle} th√¥i, quy lu·∫≠t v≈© tr·ª• r·ªìi.`, `Check var g·∫•p ƒëo·∫°n cu·ªëi {shortTitle} anh em ∆°i!`,
                `{shortTitle} l√†m tui overthinking m·∫•t 3 ng√†y.`, `Th√† nh·ªãn ƒÉn ch·ª© kh√¥ng nh·ªãn xem {shortTitle}!!!`,
                `H√≥ng t·∫≠p sau qu√° ad ∆°i!`, `Phim hay v√£i ch∆∞·ªüng.`, `10 ƒëi·ªÉm v·ªÅ ch·ªó!`,
                `M·∫•y √¥ng ch√™ {shortTitle} ch·∫Øc ch∆∞a xem h·∫øt t·∫≠p 1 r·ªìi.`, `Si√™u ph·∫©m {shortTitle} n√†y m√† kh√¥ng n·ªïi th√¨ h∆°i ph√≠.`,
                `Web xem m∆∞·ª£t qu√°, c·∫£m ∆°n ad!`, `Subteam d·ªãch {shortTitle} c√≥ t√¢m gh√™.`,
                `H·∫£o anime!`, `Tuy·ªát v·ªùi √¥ng m·∫∑t tr·ªùi.`, `Qu√° ƒë√£ pepsi ∆°i.`,
                `ƒê·ªânh c·ªßa ch√≥p!`, `Kh√©t l·∫πt!`, `Ch·∫•t l∆∞·ª£ng!`,
                `Ai spoil {shortTitle} tui block r√°ng ch·ªãu nha.`, `T·∫≠p n√†y xem xong l√∫ lu√¥n.`,
                `C·∫ßn t√¨m info b√†i h√°t ƒëo·∫°n gi·ªØa phim {shortTitle}.`, `Xem {shortTitle} ·ªü ƒë√¢y l√† chu·∫©n b√†i r·ªìi.`,
                `M·ªçi ng∆∞·ªùi ∆°i, {shortTitle} c√≥ manga kh√¥ng?`, `Ad ∆°i, ra t·∫≠p m·ªõi nhanh l√™n!`,
                `Phim n√†y cu·ªën h∆°n b√°nh cu·ªën b√† T√¢n.`, `Nh√¨n visual nh√¢n v·∫≠t m√† mu·ªën r·ª•ng tim.`,
                `Tui l√† ng∆∞·ªùi ƒë∆°n gi·∫£n, th·∫•y {shortTitle} l√† tui click.`, `U l√† tr·ªùi, c√°i ƒëo·∫°n ƒë√≥ hay x·ªâu.`,
                `M√™ ch·ªØ √™ k√©o d√†i nha.`, `ƒêang h·ªçc b√†i m√† ph·∫£i l√©n xem {shortTitle} n√®.`,
                `Phim n√†y ai kh√¥ng xem l√† ph√≠ n·ª≠a ƒë·ªùi ng∆∞·ªùi.`, `Ch·∫•m h√≥ng!`,
                `Xin l·ªãch chi·∫øu {shortTitle} v·ªõi ad ∆°i.`, `C√≥ ai bi·∫øt phim n√†o gi·ªëng {shortTitle} kh√¥ng?`,
                `Xem {shortTitle} xong th·∫•y y√™u ƒë·ªùi h·∫≥n.`, `C√†y l·∫°i l·∫ßn N v·∫´n th·∫•y hay.`,
                `Kh√¥ng xem {shortTitle} l√† m·ªôt thi·∫øu s√≥t l·ªõn.`, `Phim hay th·∫ø n√†y m√† gi·ªù m·ªõi bi·∫øt.`,
                `Ai ch∆∞a xem th√¨ xem ƒëi nh√©, kh√¥ng h·ªëi h·∫≠n ƒë√¢u.`, `Si√™u ph·∫©m trong l√≤ng t√¥i.`,
                `Tri·ªáu like cho {shortTitle}!`, `C·∫£m x√∫c d√¢ng tr√†o, tuy·ªát v·ªùi!`,
                `Kh√¥ng u·ªïng c√¥ng th·ª©c ƒë√™m c√†y {shortTitle}.`, `Ch·∫•m 100 ƒëi·ªÉm cho s·ª± n·ªó l·ª±c c·ªßa studio.`,
                `Phim n√†y m√† kh√¥ng top trending th√¨ h∆°i l·∫°.`, `Fan {shortTitle} ƒëi·ªÉm danh n√†o!`,
                `Nh√¨n d√†n harem m√† th√®m.`, `Main ng·∫ßu l√≤i, kh√¥ng n√≥i nhi·ªÅu.`,
                `Waifu qu·ªëc d√¢n ƒë√¢y r·ªìi!`, `Husband c·ªßa emmm!`,
                `T√¨nh ti·∫øt phim nhanh, g·ªçn, l·∫π.`, `Kh√¥ng c√≥ m·ªôt gi√¢y n√†o th·ª´a th·∫£i.`,
                `L·∫ßn ƒë·∫ßu xem anime m√† cu·ªën th·∫ø n√†y.`, `Gi·ªõi thi·ªáu cho c·∫£ l·ªõp xem lu√¥n.`,
                `Phim hay, nh·∫°c hay, nh√¢n v·∫≠t ƒë·∫πp. Combo h·ªßy di·ªát.`, `Xem xong mu·ªën mua figure li·ªÅn.`,
                `Ad c·∫≠p nh·∫≠t nhanh qu√°, y√™u ad!`, `Web x·ªãn, kh√¥ng qu·∫£ng c√°o, 10 ƒëi·ªÉm.`
            ],
            NEGATIVE: [ // Ch√™ bai, Th·∫•t v·ªçng (R·∫§T NHI·ªÄU)
                `{shortTitle} ƒë√∫ng l√† phim r√°c, ph√≠ th·ªùi gian.`, `Art {shortTitle} x·∫•u ƒëau ƒë·ªõn, x√∫c ph·∫°m ng∆∞·ªùi nh√¨n.`,
                `C·ªët truy·ªán {shortTitle} nh·∫°t nh∆∞ n∆∞·ªõc ·ªëc. Drop g·∫•p!`, `Di·ªÖn bi·∫øn t√¢m l√Ω nh√¢n v·∫≠t trong {shortTitle} v√¥ l√Ω ƒë√πng ƒë√πng.`,
                `Th·∫•t v·ªçng tr√†n tr·ªÅ v·ªÅ {shortTitle}.`, `Ai cho tui xin l·∫°i th·ªùi gian xem {shortTitle} ƒëi. Refund!!!`,
                `Anh Hai n√≥i th·∫≥ng, {shortTitle} l√† phim r√°c.`, `Th√¥i xong {shortTitle} r·ªìi, ch·∫•t l∆∞·ª£ng nh∆∞ Ph·ªü b·ªã ngu·ªôi.`,
                `ƒê·ª´ng xem {shortTitle}, h·ªëi h·∫≠n ƒë·∫•y.`, `2 sao cho s·ª± c·ªë g·∫Øng, c√≤n l·∫°i th√¨ t·ªá.`,
                `Xem ƒë∆∞·ª£c n·ª≠a t·∫≠p {shortTitle} t·∫Øt lu√¥n, kh√¥ng nu·ªët n·ªïi.`, `Buff b·∫©n cho main qu√° ƒë√†, xem ch√°n.`,
                `Logic phim {shortTitle} ƒë·ªÉ ƒë√¢u r·ªìi?`, `Th√† xem qu·∫£ng c√°o c√≤n h∆°n xem {shortTitle}.`,
                `Sub d·ªü, phim d·ªü, combo h·ªßy di·ªát.`, `Ph√≠ ti·ªÅn m·∫°ng xem {shortTitle}.`,
                `N·ªôi dung s√°o r·ªóng, to√†n fan service r·∫ª ti·ªÅn.`, `Main ph·∫ø v·∫≠t, xem m√† ·ª©c ch·∫ø.`,
                `K·∫øt th√∫c {shortTitle} l√£ng x·∫πt, ƒë·∫ßu voi ƒëu√¥i chu·ªôt.`, `ƒê·ª´ng ai tin m·∫•y c√°i review khen l·∫•y khen ƒë·ªÉ, to√†n seeding ƒë·∫•y.`,
                `Phim n√†y flop l√† ƒë√∫ng r·ªìi, ch·∫£ c√≥ g√¨ ƒë·∫∑c s·∫Øc.`, `T·∫©y chay {shortTitle} v√¨ n·ªôi dung xuy√™n t·∫°c.`,
                `Xem {shortTitle} bu·ªìn ng·ªß kinh kh·ªßng.`, `Nh√¢n v·∫≠t n·ªØ trong {shortTitle} b√°nh b√®o v√¥ d·ª•ng v√£i.`,
                `Ch√°n ch·∫≥ng bu·ªìn n√≥i.`, `C·ªët truy·ªán r·ªùi r·∫°c, ch·∫£ hi·ªÉu g√¨.`,
                `ƒê·ªì h·ªça nh∆∞ phim ho·∫°t h√¨nh nh·ªØng nƒÉm 2000.`, `Th·∫•t v·ªçng to√†n t·∫≠p.`,
                `Kh√¥ng hi·ªÉu sao {shortTitle} l·∫°i ƒë∆∞·ª£c khen, tui th·∫•y d·ªü t·ªá.`, `ƒê·∫°o di·ªÖn ch·∫Øc ƒëang ng·ªß g·∫≠t l√∫c l√†m phim n√†y.`,
                `K·ªãch b·∫£n nh∆∞ vi·∫øt cho tr·∫ª con xem.`, `Nh√¢n v·∫≠t ph·ª• c√≤n c√≥ n√£o h∆°n nh√¢n v·∫≠t ch√≠nh.`,
                `Xem m√† t·ª©c c√°i l·ªìng ng·ª±c.`, `Phim g√¨ m√† dark deep n·ª≠a m√πa.`,
                `C·ªë t·ªè ra nguy hi·ªÉm nh∆∞ng th·ª±c ch·∫•t r·ªóng tu·∫øch.`, `Ph√≠ ph·∫°m t√†i nguy√™n.`,
                `Th√¥i d·∫πp, ngh·ªâ kh·ªèe.`, `Kh√¥ng bao gi·ªù xem l·∫°i l·∫ßn 2.`,
                `Phim r√°c r∆∞·ªüi, ƒë·ª´ng ai xem.`, `T·ªá h·∫°i, kh√¥ng c√≤n t·ª´ g√¨ ƒë·ªÉ di·ªÖn t·∫£.`,
                `L√†m phim ki·ªÉu g√¨ v·∫≠y tr·ªùi?`, `C√†ng xem c√†ng th·∫•y ch√°n.`,
                `Drop t·ª´ t·∫≠p 1, bye.`, `ƒê·ª´ng ƒë·ªÉ c√°i poster l·ª´a t√¨nh.`
            ]
        };

        const getCommentContentByGenre = (movie) => {
            const genres = (movie.genre || "").toLowerCase();
            let pool = [...COMMENT_POOLS.GENERAL]; 

            if (genres.includes("h√†nh ƒë·ªông") || genres.includes("action")) pool = pool.concat(COMMENT_POOLS.ACTION);
            if (genres.includes("t√¨nh c·∫£m") || genres.includes("romance")) pool = pool.concat(COMMENT_POOLS.ROMANCE);
            if (genres.includes("chuy·ªÉn sinh") || genres.includes("isekai")) pool = pool.concat(COMMENT_POOLS.ISEKAI);
            if (genres.includes("kinh d·ªã") || genres.includes("horror")) pool = pool.concat(COMMENT_POOLS.HORROR);
            if (genres.includes("h√†i") || genres.includes("comedy")) pool = pool.concat(COMMENT_POOLS.COMEDY);

            // T·ª∑ l·ªá ch√™ bai (15%)
            if (Math.random() < 0.15) pool = COMMENT_POOLS.NEGATIVE;

            const shortTitle = getShortTitle(movie.title);
            const template = pool[Math.floor(Math.random() * pool.length)];
            let content = template.replace(/{shortTitle}/g, shortTitle);

            // √Åp d·ª•ng Teencode
            content = applyTeencode(content);
            return content;
        };

        // --- REVIEW THEO TH·ªÇ LO·∫†I & ƒêI·ªÇM S·ªê (LOGIC M·ªöI - B·ªî SUNG NHI·ªÄU) ---
        const getReviewContentByGenre = (movie, rating) => {
            const genres = (movie.genre || "").toLowerCase();
            const shortTitle = getShortTitle(movie.title);
            
            // 5 SAO & 4 SAO (KHEN)
            let content;
            if (rating >= 4) {
                if (genres.includes("h√†nh ƒë·ªông")) content = `Combat trong ${shortTitle} q√° m√£n nh√£n, 10/10 animation! ƒê·ªânh c·ªßa ch√≥p! ƒê√£ m·∫Øt tht s·ª±.`;
                else if (genres.includes("t√¨nh c·∫£m")) content = `${shortTitle} lm tui kh√≥c h·∫øt n∆∞·ªõc m·∫Øt, nma hay. C∆°m tr√≥ ch·∫•t l∆∞·ª£ng! ƒê·ªÅ c·ª≠.`;
                else if (genres.includes("isekai")) content = `M√™ th·∫ø gi·ªõi fantasy trong ${shortTitle} q√°, mun ƒëc chuy·ªÉn sinh ngay vs lun! X√¢y d·ª±ng world ngon.`;
                else if (genres.includes("kinh d·ªã")) content = `${shortTitle} √°m ·∫£nh tht s·ª±, c·ªët truy·ªán hack n√£o. ƒê·ªÅ c·ª≠ m·∫°nh cho ai gan d·∫°!`;
                else if (genres.includes("h√†i")) content = `C∆∞·ªùi x·ªâuu vs ${shortTitle}, gi·∫£i tr√≠ c·ª±c t·ªët. M√£i m·∫≠n! C∆∞·ªùi mun r·ªõt h√†m.`;
                else {
                    const generalPraise = [
                        `${shortTitle} q√° xu·∫•t s·∫Øc, k xem ph√≠ ƒë·ªùi. Fan c·ª©ng ƒëi·ªÉm danh! Web load nhanh, phim hay. ƒê·ªì h·ªça ƒë·∫πp, √¢m thanh s·ªëng ƒë·ªông.`,
                        `Tuy·ªát ph·∫©m! ${shortTitle} ƒë√£ ch·∫°m ƒë·∫øn tr√°i tim tui. M·ªçi th·ª© ƒë·ªÅu ho√†n h·∫£o.`,
                        `K th·ªÉ r·ªùi m·∫Øt kh·ªèi m√†n h√¨nh. ${shortTitle} l√¥i cu·ªën t·ª´ ƒë·∫ßu ƒë·∫øn cu·ªëi.`,
                        `M·ªôt b·ªô anime ƒë√°ng ƒë·ªìng ti·ªÅn b√°t g·∫°o. ${shortTitle} m√£i ƒë·ªânh!`,
                        `T√¥i s·∫Ω gi·ªõi thi·ªáu ${shortTitle} cho t·∫•t c·∫£ bn c·ªßa tui. Q√° hay!`,
                        `K c√≥ ƒëi·ªÉm tr·ª´ n√†o cho ${shortTitle}. M·ªôt tr·∫£i nghi·ªám tuy·ªát v·ªùi.`,
                        `Ch·∫Øc ch·∫Øn s·∫Ω xem l·∫°i ${shortTitle} nh√¨u l·∫ßn n·ªØa. Q√° hay!`,
                        `T·ª´ng chi ti·∫øt trong ${shortTitle} ƒë·ªÅu ƒëc chƒÉm ch√∫t k·ªπ l∆∞·ª°ng. 10 ƒëi·ªÉm!`,
                        `C·∫£m ∆°n v√¨ ƒë√£ t·∫°o ra ${shortTitle}. N√≥ ƒë√£ c·ª©u r·ªói t√¢m h·ªìn tui.`,
                        `M·ªôt trong nhg b·ªô anime hay nh·∫•t mik t·ª´ng xem. R·∫•t ƒë√°ng xem!`
                    ];
                    content = generalPraise[Math.floor(Math.random() * generalPraise.length)];
                }
            }
            
            // 3 SAO (TRUNG B√åNH)
            else if (rating === 3) {
                if (genres.includes("h√†nh ƒë·ªông")) content = `Combat t·∫°m ƒëc nma c·ªët truy·ªán ${shortTitle} h∆°i lo√£ng. C·∫ßn c·∫£i thi·ªán th√™m.`;
                else if (genres.includes("t√¨nh c·∫£m")) content = `${shortTitle} h∆°i s·∫øn, nh√¨u ƒëo·∫°n t√¨nh ti·∫øt b·ªã g∆∞·ª£ng √©p. Xem gi·∫£i tr√≠ th√¨ ·ªïn.`;
                else content = `${shortTitle} xem t·∫°m ·ªïn, nma ƒëo·∫°n gi·ªØa h∆°i d√†i d√≤ng. C·∫ßn c·∫£i thi·ªán nh·ªãp phim. K q√° ƒë·∫∑c s·∫Øc.`;
            }
            
            // 2 SAO (CH√ä)
            else if (rating === 2) {
                if (genres.includes("h√†nh ƒë·ªông")) content = `Animation c·ªßa ${shortTitle} c·ª©ng ƒë∆°, combat nh∆∞ m√∫a r·ªëi. Th·∫•t v·ªçng! PowerPoint √†?`;
                else if (genres.includes("t√¨nh c·∫£m")) content = `N·ªôi dung ${shortTitle} s·∫øn s√∫a, t√¨nh ti·∫øt c·∫©u huy·∫øt v√¥ l√Ω. Ch√™!`;
                else {
                    const generalHate = [
                        `Phim ${shortTitle} n√†y ch√°n nh∆∞ Ph·ªü, a hai th·∫•y k ·ªïn ch√∫t n√†o. Drop! Ph√≠ th·ªùi gian q√°.`,
                        `Th·ª±c s·ª± th·∫•t v·ªçng vs ${shortTitle}. K hi·ªÉu sao l·∫°i n·ªïi ƒëc.`,
                        `K·ªãch b·∫£n ${shortTitle} q√° t·ªá, ƒë·∫ßy l·ªó h·ªïng. K nu·ªët tr√¥i.`,
                        `ƒê·ª´ng xem ${shortTitle}, ph√≠ th·ªùi gian lm.`,
                        `${shortTitle} l√† m·ªôt s·ª± s·ªâ nh·ª•c ƒë·ªëi vs nguy√™n t√°c.`,
                        `K th·ªÉ xem n·ªïi q√° 3 ep. ${shortTitle} q√° ch√°n.`,
                        `Ng ch√≠nh trong ${shortTitle} q√° ngu ng·ªëc, xem m√† ·ª©c ch·∫ø.`,
                        `ƒê·ªì h·ªça x·∫•u, n·ªôi dung d·ªü, √¢m thanh t·ªá. Combo h·ªßy di·ªát c·ªßa ${shortTitle}.`,
                        `Ti·∫øc cho th·ªùi gian ƒë√£ b·ªè ra ƒë·ªÉ xem ${shortTitle}.`,
                        `T·∫©y chay ${shortTitle}, lm h·ªèng c·∫£ m·ªôt th∆∞∆°ng hi·ªáu.`
                    ];
                    content = generalHate[Math.floor(Math.random() * generalHate.length)];
                }
            }
            else content = `${shortTitle} flop q√°. K ƒë√°ng xem.`;

            // √Åp d·ª•ng Teencode
            content = applyTeencode(content);
            return content;
        };

        const getRandomReplyContent = (movieTitle, lastComment) => {
             const shortTitle = getShortTitle(movieTitle);
             const lastCommentContent = (lastComment.content || "").toLowerCase();
             
             let replyContent;
             if (lastCommentContent.includes("phim r√°c") || lastCommentContent.includes("d·ªü") || lastCommentContent.includes("t·ªá")) {
                 replyContent = `Sao bn l·∫°i ch√™ ${shortTitle} gh√™ z? Tui th·∫•y cx ·ªïn m√†! ü§î Gu m·ªói ng m·ªói kh√°c thui.`;
             }
             else if (lastCommentContent.includes("ƒë·ªânh") || lastCommentContent.includes("hay") || lastCommentContent.includes("tuy·ªát")) {
                 replyContent = `Chu·∫©n lun! ${shortTitle} l√† si√™u ph·∫©m m√πa n√†y r√πi! üî• C√†y n√°t m√°y lun.`;
             }
             else if (lastCommentContent.includes("h√≥ng") || lastCommentContent.includes("khi n√†o") || lastCommentContent.includes("bao gi·ªù")) {
                 replyContent = `Tui cx ƒëang h√≥ng ${shortTitle} m√≤n m·ªèi ƒë√¢y n√¨! C√πng c·∫£nh ng·ªô T.T`;
             } else {
                 const REPLY_TEMPLATES = [
                    `ƒê·ªìng quan ƒëi·ªÉm v·ªÅ ${shortTitle}!`, `Tui cx nghƒ© y chang bn lun.`,
                    `K th·ªÉ ƒë·ªìng √Ω h∆°n! ${shortTitle} m√£i ƒë·ªânh.`, `B√°c n√≥i chu·∫©n v√£i.`,
                    `Rep cmt d·∫°o: ${shortTitle} hay tht s·ª±.`, `Chu·∫©n c∆°m m·∫π n·∫•u!`,
                    `Bn n√≥i ch√≠ fai.`, `Comment ch·∫•t l∆∞·ª£ng q√°!`,
                    `Like m·∫°nh cho cmt n√¨.`, `K·∫øt bn giao l∆∞u ƒëi √¥ng ∆°i.`,
                    `+1 Respect.`, `Chu·∫©n k c·∫ßn ch·ªânh.`,
                    `B√°c n√≥i h·ªô l√≤ng tui.`, `Q√° ƒë√∫ng lun!`
                 ];
                 replyContent = REPLY_TEMPLATES[Math.floor(Math.random() * REPLY_TEMPLATES.length)];
             }

             // √Åp d·ª•ng Teencode
             return applyTeencode(replyContent);
        };

        const getRandomReviewContentAiring = (movieTitle) => {
            const shortTitle = getShortTitle(movieTitle);
            const AIRING_REVIEW_TEMPLATES = [
                `ƒê√£ set l·ªãch xem ${shortTitle} ngay khi ra m·∫Øt! Trailer q√° cu·ªën, h·ª©a h·∫πn si√™u ph·∫©m.`,
                `5 sao cho ${shortTitle} v√¨ d√†n seiyuu kh·ªßng vs art tuy·ªát v·ªùi. H√≥ng t·ª´ng ng√†y!`,
                `${shortTitle} ch·∫Øc ch·∫Øn s·∫Ω l√† anime of the season. ƒê·∫∑t g·∫°ch h√≥ng ep 1.`,
                `Nghe ƒë·ªìn ${shortTitle} c√≥ c·ªët truy·ªán si√™u hack n√£o, tui ƒë√£ chu·∫©n b·ªã tinh th·∫ßn ƒë·ªÉ overthinking r√πi!`,
                `Ch·ªù ƒë·ª£i ${shortTitle} t·ª´ nƒÉm ngo√°i r√πi! Fai ch·∫•m 5 sao ·ªßng h·ªô s·ª± tr·ªü l·∫°i n√¨.`,
                `${shortTitle} l√† hy v·ªçng cu·ªëi c√πng c·ªßa tui trong nƒÉm nay. K ƒëc flop nha!`,
                `Phim ${shortTitle} n√†y fai g·ªçi l√† 'm√£i m·∫≠n', h√≥ng ng√†y ra m·∫Øt ƒë·ªÉ c√†y view.`,
                `Tuy·ªát ƒë·ªëi k th·ªÉ b·ªè qua ${shortTitle}! ƒê√£ l∆∞u v√†o list Must Watch.`,
                `Nh√¨n poster ${shortTitle} l√† th·∫•y uy t√≠n r√πi.`, `H√≥ng ${shortTitle} ra m·∫Øt ƒë·ªÉ c√†y xuy√™n ƒë√™m.`,
                `Mong l√† ${shortTitle} k lm tui th·∫•t v·ªçng.`, `Trailer ƒë·ªânh q√°, 10 ƒëi·ªÉm visual!`,
                `ƒê·∫øm ng∆∞·ª£c t·ª´ng ng√†y ƒë·ªÉ ƒëc xem ${shortTitle}.`, `Hy v·ªçng ${shortTitle} s·∫Ω b√πng n·ªï.`
            ];
            let content = AIRING_REVIEW_TEMPLATES[Math.floor(Math.random() * AIRING_REVIEW_TEMPLATES.length)];

            // √Åp d·ª•ng Teencode
            content = applyTeencode(content);
            return content;
        };
        
        // === H√ÄM X·ª¨ L√ù H√ÄNH ƒê·ªòNG BOT ===
        
        const simulateView = (movie) => {
            if (movie.status === 'sap-chieu') return;
            const movieDocRef = doc(db, dataCollectionPath, movie.id);
            updateDoc(movieDocRef, { viewCount: increment(1) })
                .then(() => log(`[VIEW] ƒê√£ xem: "${getShortTitle(movie.title)}"`, 'success'))
                .catch(e => log(`L·ªói View: ${e.message}`, 'error'));
        };

        const simulateLike = (movie) => {
            // TƒÉng t·ª∑ l·ªá like l√™n 98% (G·∫ßn nh∆∞ lu√¥n like)
            if (Math.random() < 0.98) { 
                const movieDocRef = doc(db, dataCollectionPath, movie.id);
                updateDoc(movieDocRef, { likeCount: increment(1) })
                    .then(() => log(`[LIKE] ƒê√£ b√£o like cho: "${getShortTitle(movie.title)}"`, 'success'))
                    .catch(e => log(`L·ªói Like: ${e.message}`, 'error'));
            }
        };
        
        const simulateComment = (movie, user) => {
             // KH√îNG C√ÄY COMMENT CHO PHIM S·∫ÆP CHI·∫æU
            if (movie.status === 'sap-chieu') return;

            if (!user || !user.uid || Math.random() < 0.5) return; // 50% chance to comment
            
            const commentsColRef = collection(db, dataCollectionPath, movie.id, 'comments');
            // S·ª¨ D·ª§NG LOGIC COMMENT THEO NG·ªÆ C·∫¢NH
            const content = getCommentContentByGenre(movie); 
            const botName = getBotDisplayName();
            const botAvatar = getBotAvatar(botName); // Pass name as seed for consistency if needed
            
            addDoc(commentsColRef, {
                content: content,
                userId: user.uid,
                email: user.email,
                displayName: botName, 
                photoURL: botAvatar, 
                createdAt: serverTimestamp()
            }).then(() => {
                 const imgTag = `<img src="${botAvatar}" class="w-5 h-5 rounded-full inline mr-1" onerror="this.src='https://placehold.co/20x20/6B7280/ffffff?text=U'">`;
                 log(`[COMMENT] ${imgTag} <b>${botName}</b>: "${content}"`, 'success');
            }).catch(e => log(`L·ªói Comment: ${e.message}`, 'error'));
        };

        const simulateReply = async (movie, user) => {
            // KH√îNG C√ÄY REPLY CHO PHIM S·∫ÆP CHI·∫æU
            if (movie.status === 'sap-chieu') return false; 
            
            if (!user || !user.uid) return false;
            const lastComment = await fetchLastComment(movie.id);

            // 30% c∆° h·ªôi tr·∫£ l·ªùi n·∫øu comment cu·ªëi l√† c·ªßa ng∆∞·ªùi kh√°c v√† comment ƒë√≥ m·ªõi (d∆∞·ªõi 10 ph√∫t)
            if (lastComment && lastComment.displayName !== getBotDisplayName() && Math.random() < 0.3) {
                const commentsColRef = collection(db, dataCollectionPath, movie.id, 'comments');
                const content = getRandomReplyContent(movie.title, lastComment);
                const botName = getBotDisplayName();
                const botAvatar = getBotAvatar(botName);

                addDoc(commentsColRef, {
                    content: content,
                    userId: user.uid,
                    email: user.email,
                    displayName: botName,
                    photoURL: botAvatar,
                    createdAt: serverTimestamp(),
                    replyTo: lastComment.id // Th√™m ID comment cha
                }).then(() => {
                    const imgTag = `<img src="${botAvatar}" class="w-5 h-5 rounded-full inline mr-1" onerror="this.src='https://placehold.co/20x20/6B7280/ffffff?text=U'">`;
                    log(`[REPLY] ${imgTag} <b>${botName}</b> @${lastComment.displayName}: "${content}"`, 'success');
                }).catch(e => log(`L·ªói Reply: ${e.message}`, 'error'));
                return true;
            }
            return false;
        };

        const simulateReview = (movie, user) => {
            if (!user || !user.uid || Math.random() < 0.5) return; 
            
            let rating;
            let content;

            if (movie.status === 'sap-chieu') {
                // Phim s·∫Øp chi·∫øu: Ch·ªâ ƒë√°nh gi√° 4 ho·∫∑c 5 sao (Hype)
                rating = Math.random() < 0.5 ? 5 : 4; 
                content = getRandomReviewContentAiring(movie.title);
            } else {
                 // Phim ƒë√£/ƒëang chi·∫øu: Logic ch·∫•m ƒëi·ªÉm 2-5 sao
                const rand = Math.random();
                if (rand < 0.5) rating = 5;
                else if (rand < 0.8) rating = 4;
                else if (rand < 0.9) rating = 3;
                else rating = 2;
                // S·ª¨ D·ª§NG LOGIC REVIEW THEO TH·ªÇ LO·∫†I & ƒêI·ªÇM S·ªê
                content = getReviewContentByGenre(movie, rating);
            }

            const reviewDocRef = doc(db, dataCollectionPath, movie.id, 'reviews', user.uid);
            const movieDocRef = doc(db, dataCollectionPath, movie.id);
            const botName = getBotDisplayName();
            const botAvatar = getBotAvatar(botName);

            const batch = writeBatch(db);
            
            batch.set(reviewDocRef, {
                userId: user.uid,
                rating: rating,
                content: content,
                displayName: botName,
                photoURL: botAvatar, 
                updatedAt: serverTimestamp()
            }, { merge: true });

            batch.update(movieDocRef, {
                reviewTotal: increment(rating),
                reviewCount: increment(1) 
            });
            
            batch.commit()
                .then(() => {
                     const imgTag = `<img src="${botAvatar}" class="w-5 h-5 rounded-full inline mr-1" onerror="this.src='https://placehold.co/20x20/6B7280/ffffff?text=U'">`;
                     log(`[REVIEW] ${imgTag} <b>${botName}</b> ƒë√°nh gi√° ${rating}‚≠ê: "${content}"`, 'success');
                }).catch(e => log(`L·ªói Review: ${e.message}`, 'error'));
        };

        // === LOGIC CH·∫†Y BOT ===
        const botLoop = async () => { 
             if (!isBotRunning || globalMovieCache.length === 0) { stopBotActivity(); return; }
            const randomMovie = globalMovieCache[Math.floor(Math.random() * globalMovieCache.length)];
            
            const isAuthUser = auth.currentUser && isGoogleAuth(auth.currentUser);
            
            if (randomMovie.status === 'sap-chieu') {
                simulateLike(randomMovie);
                if (isAuthUser) {
                    simulateReview(randomMovie, auth.currentUser);
                }
                return;
            }
            
            // M·ªçi ng∆∞·ªùi d√πng ƒë·ªÅu th·ª±c hi·ªán View v√† Like
            simulateView(randomMovie); 
            simulateLike(randomMovie);
            
            // Ch·ªâ ng∆∞·ªùi d√πng Login Google m·ªõi th·ª±c hi·ªán t∆∞∆°ng t√°c ph·ª©c t·∫°p (Comment, Review, Reply)
            if (isAuthUser) {
                const replied = await simulateReply(randomMovie, auth.currentUser);
                if (replied) return;
                simulateComment(randomMovie, auth.currentUser);
                simulateReview(randomMovie, auth.currentUser);
            } else {
                 log("Bot c·∫ßn ƒëƒÉng nh·∫≠p Google ƒë·ªÉ Comment/Review/Reply (Kh√°ch ch·ªâ c√†y View/Like).", 'info');
            }
        };

        const startBotActivity = () => {
            if (isBotRunning || globalMovieCache.length === 0) {
                 log(globalMovieCache.length === 0 ? "Ch∆∞a t·∫£i d·ªØ li·ªáu phim..." : "Bot ƒëang ch·∫°y.", 'error');
                 return;
            }
            // Logic t·ªëc ƒë·ªô m·ªõi: 1s cho Kh√°ch/·∫®n danh, 5s cho Google Auth
            const isAuthUser = auth.currentUser && isGoogleAuth(auth.currentUser);
            currentBotInterval = isAuthUser ? BOT_INTERVAL_AUTH : BOT_INTERVAL_ANON;

            isBotRunning = true;
            const btn = getEl('#bot-control-btn');
            const status = getEl('#bot-status-display');
            btn.textContent = 'ƒêANG C√ÄY VIEW/COMMENT... (D·ª´ng)';
            btn.classList.replace('bg-lime-500', 'bg-red-500');
            btn.classList.replace('hover:bg-lime-600', 'hover:bg-red-600');
            status.textContent = 'ƒêANG CH·∫†Y üöÄ';
            status.classList.replace('text-lime-400', 'text-red-400');
            
            // X√≥a interval c≈© n·∫øu c√≥ (ƒë·ªÉ ph√≤ng h·ªù khi auth state thay ƒë·ªïi)
            if (botInterval) clearInterval(botInterval); 

            botInterval = setInterval(botLoop, currentBotInterval);
            log(`üöÄ Bot ƒë√£ k√≠ch ho·∫°t! T·ªëc ƒë·ªô hi·ªán t·∫°i: ${currentBotInterval/1000}s/l·∫ßn.`, 'success');
            botLoop();
        };

        const stopBotActivity = () => {
            if (!isBotRunning) return;
            clearInterval(botInterval);
            isBotRunning = false;
            const btn = getEl('#bot-control-btn');
            const status = getEl('#bot-status-display');
            btn.textContent = 'B·∫ÆT ƒê·∫¶U C√ÄY';
            btn.classList.replace('bg-red-500', 'bg-lime-500');
            btn.classList.replace('hover:bg-red-600', 'hover:bg-lime-600');
            status.textContent = 'ƒê√É D·ª™NG üõë';
            status.classList.replace('text-red-400', 'text-lime-400');
            log("üõë Bot ƒë√£ d·ª´ng ho·∫°t ƒë·ªông.", 'info');
        };

        const handleBotToggle = () => {
            if (isBotRunning) { stopBotActivity(); } else { startBotActivity(); }
        };

        const handleGoogleLogin = async () => {
            try {
                // D·ª´ng bot tr∆∞·ªõc khi login ƒë·ªÉ c·∫≠p nh·∫≠t t·ªëc ƒë·ªô
                if (isBotRunning) stopBotActivity(); 
                await setPersistence(auth, browserLocalPersistence);
                await signInWithPopup(auth, new GoogleAuthProvider()); 
                log("ƒêƒÉng nh·∫≠p Google th√†nh c√¥ng! ‚úÖ", 'success');
            } catch (error) { log(`L·ªói Login: ${error.message}`, 'error'); }
        };

        const handleLogout = () => { 
            // D·ª´ng bot tr∆∞·ªõc khi logout ƒë·ªÉ c·∫≠p nh·∫≠t t·ªëc ƒë·ªô
            if (isBotRunning) stopBotActivity(); 
            signOut(auth).then(() => log("ƒê√£ ƒëƒÉng xu·∫•t.", 'info')); 
        };
        
        const loadInitialMovieCache = () => {
             if (!db) return;
             log("ƒêang t·∫£i kho phim...", 'info');
             const q = query(collection(db, dataCollectionPath), orderBy('title'), limit(100)); 
             getDocs(q).then(snapshot => {
                    globalMovieCache = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    log(`‚úÖ ƒê√£ t·∫£i xong ${globalMovieCache.length} phim. S·∫µn s√†ng!`, 'success');
             }).catch(e => log(`L·ªói t·∫£i phim: ${e.message}`, 'error'));
        };

        const setupFirebase = async () => {
            try {
                app = initializeApp(finalConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                await setPersistence(auth, browserLocalPersistence);
                if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken).catch(e => console.log(e));
                onAuthStateChanged(auth, (user) => {
                    userId = user ? user.uid : null;
                    updateAuthUI(user);
                    if (!isAuthInitialised) { isAuthInitialised = true; loadInitialMovieCache(); }
                });
                if (!auth.currentUser) signInAnonymously(auth).catch(e => console.log(e));
            } catch (error) { log(`L·ªói setup: ${error.message}`, 'error'); }
        };

       const updateAuthUI = (user) => {
            const authContainer = getEl('#auth-control');
            // Th√™m d√≤ng n√†y ƒë·ªÉ l·∫•y c√°i n√∫t
            const botBtn = getEl('#bot-control-btn');
            
            if (!authContainer) return;

            // --- QUAN TR·ªåNG: M·ªû KH√ìA N√öT CHO T·∫§T C·∫¢ M·ªåI NG∆Ø·ªúI (K·ªÇ C·∫¢ KH√ÅCH) ---
            // B√© L√¥i ƒë√£ ƒë∆∞a ƒëo·∫°n n√†y ra ngo√†i ƒë·ªÉ ai c≈©ng b·∫•m ƒë∆∞·ª£c n√®:
            if (botBtn) {
                botBtn.disabled = false;
                botBtn.textContent = "B·∫ÆT ƒê·∫¶U C√ÄY"; // Reset ch·ªØ
                botBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
            // -------------------------------------------------------------------

            if (user && isGoogleAuth(user)) {
                const displayName = user.displayName || user.email;
                authContainer.innerHTML = `
                    <div class="flex items-center justify-between bg-gray-700 p-3 rounded-lg">
                        <span class="text-lime-400 font-bold">üë§ ${displayName} (ƒê√£ Login Google)</span>
                        <button id="logout-btn" class="text-red-300 hover:text-red-100 text-xs underline">ƒêƒÉng Xu·∫•t</button>
                    </div>`;
                getEl('#logout-btn')?.addEventListener('click', handleLogout);
            } else {
                authContainer.innerHTML = `
                    <div class="flex items-center justify-between bg-gray-700 p-3 rounded-lg">
                        <span class="text-gray-400 text-sm">ƒêang ·ªü ch·∫ø ƒë·ªô Kh√°ch (Ch·ªâ c√†y View/Like)</span>
                        <button id="google-login-btn" class="bg-white text-gray-900 font-bold py-1 px-3 rounded text-xs hover:bg-gray-200">Login Google (Full T√≠nh NƒÉng)</button>
                    </div>`;
                getEl('#google-login-btn')?.addEventListener('click', handleGoogleLogin);
            }
        };
        
        document.addEventListener('DOMContentLoaded', setupFirebase);
        document.addEventListener('DOMContentLoaded', () => { getEl('#bot-control-btn')?.addEventListener('click', handleBotToggle); });
    </script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen p-4 md:p-8 font-sans">
    <div class="max-w-3xl mx-auto">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-lime-400 to-green-600">FOXANIME BOT TOOL ü§ñ</h1>
            <p class="text-gray-500 text-sm mt-2">H·ªá th·ªëng "C√†y View" & "Seeding" T·ª± ƒê·ªông H√≥a (C·∫≠p nh·∫≠t Gen Z)</p>
        </header>

        <!-- Auth Section -->
        <div id="auth-control" class="mb-6">Loading Auth...</div>

        <!-- Main Control -->
        <section class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden border border-gray-700">
            <div class="p-6 flex flex-col items-center justify-center">
                <div class="mb-4 text-center">
                    <p class="text-gray-400 text-sm uppercase tracking-wider mb-1">TR·∫†NG TH√ÅI</p>
                    <p id="bot-status-display" class="text-3xl font-black text-lime-400">S·∫¥N S√ÄNG</p>
                </div>
                
                <button id="bot-control-btn" 
                    class="w-full md:w-auto bg-lime-500 hover:bg-lime-600 text-gray-900 font-bold py-4 px-12 rounded-full text-xl shadow-lg transform transition hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    disabled>
                    B·∫ÆT ƒê·∫¶U C√ÄY
                </button>
                
                <p class="text-gray-500 text-xs mt-4 text-center px-4">
                    ‚ö†Ô∏è T·ªëc ƒë·ªô Bot: 1s (Kh√°ch/·∫®n danh - View/Like) / 5s (Google Auth - Full T∆∞∆°ng T√°c). Vui l√≤ng gi·ªØ tab n√†y m·ªü ƒë·ªÉ Bot ho·∫°t ƒë·ªông.
                </p>
            </div>
            
            <!-- Logs Terminal -->
            <div class="bg-black p-4 border-t border-gray-700">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs text-gray-500 font-mono">TERMINAL LOGS</span>
                    <span class="flex h-2 w-2 relative">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-lime-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-lime-500"></span>
                    </span>
                </div>
                <div id="bot-logs" class="h-64 overflow-y-auto font-mono text-xs text-gray-300 space-y-1 scrollbar-hide">
                    <div class="text-gray-600 italic"> > Ch·ªù l·ªánh kh·ªüi ƒë·ªông...</div>
                </div>
            </div>
        </section>
    </div>
</body>
</html>